


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

	
		<!-- Google Tag Manager -->
	<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
	<!-- End Google Tag Manager -->
	
        <!-- Google Tag Manager -->
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
        <!-- End Google Tag Manager -->	

  
  
  
  

  
      <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../_static/js/Searchbox.min.js"></script>
    <script type="text/javascript" src="../../_static/js/header-footer.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/pro.min.css" media="all" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="VVAS Meta Data Structures" href="vvas_meta_data_structures.html" />
    <link rel="prev" title="Vitis Video Analytics SDK Release V2.0" href="../release_notes.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
 <div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">

    
    

    



<div class="xf-content-height">
    

<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
    
    <div class="header parbase aem-GridColumn aem-GridColumn--default--12"><noindex>
	<header data-component="header" class="site-header">
		<nav class="navbar navbar-default">
			<div class="container-fluid main-nav">
				<div class="row">
					<div class="navbar-column col-xs-4 col-sm-5">
						<ul class="nav navbar-nav hidden-xs">
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
								</li>
							</ul>
							
						<ul class="nav navbar-nav hidden-sm hidden-md hidden-lg">
							<li>
									<button data-target="#header-container-0" data-function="toggle">Solutions</button>
								</li>
							<li>
									<button data-target="#header-container-1" data-function="toggle">Products</button>
								</li>
							<li>
									<button data-target="#header-container-2" data-function="toggle">Company</button>
								</li>
							</ul>
							
						<div id="header-container-0" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-1" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-2" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							</div>
					<div class="logo-column col-xs-4 col-sm-2">
						<div class="logo">
							<a target="_blank" href="https://www.xilinx.com/">
								<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
							</a>
						</div>
					</div>

				</div>
			</div>
			</nav></header></noindex></div>
		
	
</div>

    
</div>
</div>

<div class="calloutBanner parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><div class="callout-banner">
    Xilinx is now a part of <a target="_blank" href="https://www.amd.com/en/corporate/xilinx-acquisition">AMD</a> |  <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Learn More</a>
</div>
</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis™ Video Analytics SDK
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Base Infrastructure</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#custom-plug-ins">Custom Plug-ins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xmetaaffixer">vvas_xmetaaffixer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#input-and-output">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#control-parameters-and-plug-in-properties">Control Parameters and Plug-in Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pad-naming-syntax">Pad naming syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-pipelines">Example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xabrscaler">vvas_xabrscaler</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisite">Prerequisite</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">Control Parameters and Plug-in Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">Example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xinfer">vvas_xinfer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#control-parameters">Control Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#infer-config-json-members">infer-config json members</a></li>
<li class="toctree-l4"><a class="reference internal" href="#infer-config-kernel-json-members">infer-config::kernel json members</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preprocess-config-json-members">preprocess-config json members</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preprocess-config-kernel-json-members">preprocess-config::kernel json members</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xoptflow">vvas_xoptflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">Prerequisite</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plug-in-properties">Plug-in Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xoverlay">vvas_xoverlay</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#supported-features">Supported features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">Control Parameters and Plug-in Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">Example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xtracker">vvas_xtracker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id17">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">Control Parameters and Plug-in Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">Example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xmetaconvert">vvas_xmetaconvert</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#json-file-for-vvas-xmetaconvert">JSON File for vvas_xmetaconvert</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">Example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xfunnel">vvas_xfunnel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id23">Control Parameters and Plug-in Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id24">Example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xdefunnel">vvas_xdefunnel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#control-parameters-and-plug-in-signals">Control Parameters and Plug-in Signals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id26">Example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xmulticrop">vvas_xmulticrop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id29">Prerequisite</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id30">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id32">Control Parameters and Plug-in Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id33">Example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xcompositor">vvas_xcompositor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id35">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#individual-parameters-for-each-input-stream-can-be-configured-on-the-gstcompositorpad">Individual parameters for each input stream can be configured on the GstCompositorPad:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plugin-properties">Plugin properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vvas-xcompositor-pad-properties">vvas_xcompositor pad properties</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#infrastructure-plug-ins-and-acceleration-software-libraries">Infrastructure Plug-ins and Acceleration Software Libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xfilter">vvas_xfilter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id38">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id39">Control Parameters and Plug-in Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#json-format-for-vvas-xfilter-plug-in">JSON Format for vvas_xfilter Plug-in</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-json-configuration-files">Example JSON Configuration Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id40">Example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-xmultisrc">vvas_xmultisrc</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id43">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id44">Control Parameters and Plug-in Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#json-format-for-vvas-xmultisrc">JSON format for vvas_xmultisrc</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id45">Example Pipelines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gstvvasbufferpool">GstVvasBufferPool</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gstvvasallocator">GstVvasAllocator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#allocator-apis">Allocator APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#json-schema">JSON Schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-inference-meta-data">VVAS Inference Meta Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overlay-meta-data">Overlay Meta Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vvas_meta_data_structures.html">Meta Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="for_developers.html">For Advanced Developers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Embedded</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Embedded/platforms_and_applications.html">Platforms &amp; Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Embedded/embedded-plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Embedded/Tutorials/Tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Center</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../DC/platforms_and_applications.html">Platforms &amp; Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DC/DC_plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DC/Tutorials/Tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../freq_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/VVAS/1.1/build/html/index.html">1.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/VVAS/1.0/build/html/index.html">1.0</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../_sources/docs/common/common_plugins.rst.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Vitis™ Video Analytics SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Plug-ins</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/docs/common/common_plugins.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="plug-ins">
<h1>Plug-ins<a class="headerlink" href="#plug-ins" title="Permalink to this heading">¶</a></h1>
<p>VVAS is based on the GStreamer framework. This section describes the VVAS GStreamer plug-ins, their input, outputs, and control parameters. The plug-ins source code is available in the <code class="docutils literal notranslate"><span class="pre">vvas-gst-plugins</span></code> folder of the VVAS source tree. The two types of VVAS GStreamer plug-ins are custom plug-ins and infrastructure plug-ins. Infrastructure plug-ins are developed to enable developers to integrate their kernel into GStreamer based applications without having understanding about GStreamer framework. Infrastructure plug-ins encapsulates most of the basic GStreamer plug-in requirements/features, like memory management, kernel configuration, caps negotiation etc. Same Infrastructure plug-ins can be used for integrating different kernels to realize different functionalities. Custom plug-ins implement a specific functionality, like encode, decode, overlay etc. that can’t be implemented using Infrastructure plug-ins in an optimized way.</p>
<p>This section covers the plug-in that are common for Edge (Embedded) as well as cloud (PCI basede) solutions. There are few plug-ins that are specific to Edge/Embedded platforms and are covered in <a class="reference internal" href="../Embedded/embedded-plugins.html"><span class="doc">Plugins for Embedded platforms</span></a>. Similarly there are few plug-ins that are specific to Cloud/Data Center platforms and these are covered in <a class="reference internal" href="../DC/DC_plugins.html"><span class="doc">Plugins for Data Center Platform</span></a>. The following table lists the VVAS GStreamer plug-ins.</p>
<p>Table 1: GStreamer Plug-ins</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Plug-in Name</p></th>
<th class="head"><p>Functionality</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#vvas-xmetaaffixer"><span class="std std-ref">vvas_xmetaaffixer</span></a></p></td>
<td><p>Plug-in to scale and attach metadata to the frame of different resolutions.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#vvas-xabrscaler"><span class="std std-ref">vvas_xabrscaler</span></a></p></td>
<td><p>Hardware accelerated scaling and color space conversion.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#vvas-xmultisrc"><span class="std std-ref">vvas_xmultisrc</span></a></p></td>
<td><p>A generic infrastructure plug-in: 1 input, N output, supporting transform processing.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#vvas-xfilter"><span class="std std-ref">vvas_xfilter</span></a></p></td>
<td><p>A generic infrastructure plug-in: 1 input, 1 output, supporting pass-through, in-place, and transform processing.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#vvas-xinfer"><span class="std std-ref">vvas_xinfer</span></a></p></td>
<td><p>An inference plug-in using vvas_xdpuinfer acceleration software library and attaches inference output as GstInferenceMeta to input buffer. Also, this plug-in does optional pre-processing required for inference using vvas_xpreprocess acceleration software library.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#vvas-xoptflow"><span class="std std-ref">vvas_xoptflow</span></a></p></td>
<td><p>Plug-in to estimate optical flow using previous and current frame.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#vvas-xoverlay"><span class="std std-ref">vvas_xoverlay</span></a></p></td>
<td><p>Plug-in to draw text, boxes, lines, arrows, circles, polygons, and time stamp on frames.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#vvas-xtracker"><span class="std std-ref">vvas_xtracker</span></a></p></td>
<td><p>Plug-in to track objects of interest detected during infer.  This plug-in tracks the previously detected objects during the time interval when infer information is not available.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#vvas-xmetaconvert"><span class="std std-ref">vvas_xmetaconvert</span></a></p></td>
<td><p>Plugin to convert VVAS ML inference metadata (GstInferenceMeta) into overlay metadata</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#vvas-xfunnel"><span class="std std-ref">vvas_xfunnel</span></a></p></td>
<td><p>Plug-in to serialize data on its sink pads in round robin order</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#vvas-xdefunnel"><span class="std std-ref">vvas_xdefunnel</span></a></p></td>
<td><p>Plug-in to de-serialize data serialized using <cite>vvas_xfunnel</cite> plug-in</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#vvas-xmulticrop"><span class="std std-ref">vvas_xmulticrop</span></a></p></td>
<td><p>Hardware accelerated plug-in for doing static and dynamic cropping, pre-processing, scaling, and color space conversion.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#vvas-xcompositor"><span class="std std-ref">vvas_xcompositor</span></a></p></td>
<td><p>Hardware accelerated N input, 1 output plug-in that combines two or more video frames into a single frame.</p></td>
</tr>
</tbody>
</table>
<section id="custom-plug-ins">
<span id="custom-plugins-label"></span><h2>Custom Plug-ins<a class="headerlink" href="#custom-plug-ins" title="Permalink to this heading">¶</a></h2>
<p>There are specific functions, like video decoder, encoder, and meta-affixer where the requirements are difficult to implement in an optimized way using highly simplified and generic infrastructure plug-ins framework. Hence, these functions are implemented using custom GStreamer plug-ins. This section covers details about the custom plug-ins.</p>
<section id="vvas-xmetaaffixer">
<span id="id1"></span><h3>vvas_xmetaaffixer<a class="headerlink" href="#vvas-xmetaaffixer" title="Permalink to this heading">¶</a></h3>
<p>The metaaffixer plug-in, <code class="docutils literal notranslate"><span class="pre">vvas_xmetaaffixer</span></code>, is used to scale the incoming metadata information for the different resolutions. A machine learning (ML) operation can be performed on a different frame resolution and color format than the original frame, but the metadata might be associated with the full resolution, original frame. The vvas_metaaffixer has two types of pads, master pads and slave pads. Input pads are pads on request; the number of input pads can be created based on the number of input sources. There is one mandatory master input pad (sink pad) that receives the original/reference metadata. Other input pads are referred to as slave pads. Metadata received on the master sink pad is scaled in relation to the resolution of each of the slave sink pads. The scaled metadata is attached to the buffer going out of the output (source) slave pads. There can be up to 16 slave pads created as required. For implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/gst/metaaffixer">vvas_xmetaaffixer source code</a></p>
<figure class="align-default">
<img alt="../../_images/image5.png" src="../../_images/image5.png" />
</figure>
<section id="input-and-output">
<h4>Input and Output<a class="headerlink" href="#input-and-output" title="Permalink to this heading">¶</a></h4>
<p>This plug-in is format agnostic and can accept any input format. It operates only on the metadata. The vvas_xmetaaffixer plug-in supports the GstInferenceMeta data structure. For details about this structure, refer to the <a class="reference internal" href="vvas_meta_data_structures.html"><span class="doc">VVAS Inference Metadata</span></a> section.</p>
</section>
<section id="control-parameters-and-plug-in-properties">
<h4>Control Parameters and Plug-in Properties<a class="headerlink" href="#control-parameters-and-plug-in-properties" title="Permalink to this heading">¶</a></h4>
<p>Table 2: vvas_xmetaaffixer Plug-in Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 11%" />
<col style="width: 15%" />
<col style="width: 11%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sync</p></td>
<td><p>Boolean</p></td>
<td><p>True/False</p></td>
<td><p>True</p></td>
<td><p>This property is to enable the synchronization
between master and slave pads buffers.
If sync=true is set, then the metadata is scaled
and attached to buffers on slave pads that have
matching PTS or PTS falls within frame duration of the
buffer on the master sink pad.
If sync=false is set on the element, then the
metadata is scaled and attached to all the
buffers on the slave pads. If this option is used,
there is possibility that the metadata is not
suitable for the frames/buffers that are not
corresponding to the frames/buffers on the master
pad.</p></td>
</tr>
<tr class="row-odd"><td><p>timeout</p></td>
<td><p>Int64</p></td>
<td><p>-1 to
9223372036854</p></td>
<td><p>2000</p></td>
<td><p>Timeout in millisec. Plug-in will wait for “timeout”
duration for a buffer on other pads before pushing
buffer on output pad. This is to avoid hang in case
buffers are arriving at different frame rates and
slave pad buffer is waiting for another buffer at
master pad (which may not arrive as there is no more
buffers available).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pad-naming-syntax">
<h4>Pad naming syntax<a class="headerlink" href="#pad-naming-syntax" title="Permalink to this heading">¶</a></h4>
<p>The pad naming syntax is listed, and the following image shows the syntax:</p>
<ul class="simple">
<li><p>MetaAffixer master input pad should be named sink_master.</p></li>
<li><p>MetaAffixer master output pad should be named src_master.</p></li>
<li><p>MetaAffixer slave input pad should be named sink_slave_0, sink_slave_1.</p></li>
<li><p>MetaAffixer slave output pad should be named src_slave_0, src_slave_1, src_slave_2.</p></li>
</ul>
<figure class="align-default">
<img alt="../../_images/image6.png" src="../../_images/image6.png" />
</figure>
</section>
<section id="example-pipelines">
<h4>Example Pipelines<a class="headerlink" href="#example-pipelines" title="Permalink to this heading">¶</a></h4>
<p>This section covers the example pipelines using the metaaffixer plug-in.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 videotestsrc num-buffers=1 \
! video/x-raw, width=1920, height=1080, format=NV12 \
! queue \
! videoconvert \
! queue \
! ima.sink_master vvas_xmetaaffixer name=ima ima.src_master \
! queue \
! fakesink videotestsrc num-buffers=1 \
! video/x-raw, width=1920, height=1080, format=NV12 \
! queue \
! videoconvert \
! video/x-raw, width=1920, height=1080, format=YUY2 \
! ima.sink_slave_0 ima.src_slave_0 \
! queue \
! fakesink -v
</pre></div>
</div>
</section>
</section>
<section id="vvas-xabrscaler">
<span id="id2"></span><h3>vvas_xabrscaler<a class="headerlink" href="#vvas-xabrscaler" title="Permalink to this heading">¶</a></h3>
<p>There are severa use cases where the available frame resolution and color formats may not be suitable for the consumption by the next component. For example, in case of Machine Learning applications, input can be from different sources, resolutions, but ML models work on a fixed resolution. In such cases, the input image needs to be re-sized to a different resolution. Also, the input image color format may be YUV/NV12, but the ML models require image to be in BGR format. In this case we need to do the color space conversion as well. ML model may also require some pre-processing, like Mean Subtraction, Normalization etc. on the input image.</p>
<p>In adaptive bit rate (ABR) use cases, one video is encoded at different bit rates so that it can be streamed in different network bandwidth conditions without any artifacts. To achieve this, input frame is decoded, resized to different resolutions and then re-encoded. vvas_xabrscaler is a plug-in that takes one input frame and can produce several outputs frames having different resolutions and color formats. The <code class="docutils literal notranslate"><span class="pre">vvas_xabrscaler</span></code> is a GStreamer plug-in developed to accelerate the resize and color space conversion, Mean Subtraction, Normalization, and cropping. For more implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/sys/abrscaler">vvas_xabrscaler source code</a>.</p>
<p>This plug-in supports:</p>
<ul class="simple">
<li><p>Single input, multiple output pads</p></li>
<li><p>Color space conversion</p></li>
<li><p>Resize</p></li>
<li><p>Each output pad has independent resolution and color space conversion capability.</p></li>
<li><p>Crop of input buffer</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <cite>vvas_xabrscaler</cite> plug-in controls the multiscaler kernel. If your application uses this plug-in, then make sure that multi-scaler kernel is included in your hardware design.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure that the multi-scaler hardware kernel supports maximum resolution required by your application.</p>
</div>
<p>As a reference, maximum resolution supported by multi-scaler kernel in <code class="docutils literal notranslate"><span class="pre">Smart</span> <span class="pre">Model</span> <span class="pre">Select</span></code> example design can be found in <a class="reference external" href="https://github.com/Xilinx/VVAS/blob/master/vvas-examples/Embedded/smart_model_select/v_multi_scaler_config.h#L33">multi-scaler kernel config</a></p>
<section id="prerequisite">
<h4>Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this heading">¶</a></h4>
<p>This plug-in requires the multiscaler kernel to be available in the hardware design and the required color formats are enabled. See <a class="reference internal" href="Acceleration-Hardware.html#multiscaler-kernel"><span class="std std-ref">Multiscaler Kernel</span></a></p>
</section>
<section id="id3">
<h4>Input and Output<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h4>
<p>This plug-in accepts buffers with the following color format standards:</p>
<ul class="simple">
<li><p>RGBx</p></li>
<li><p>YUY2</p></li>
<li><p>r210</p></li>
<li><p>Y410</p></li>
<li><p>NV16</p></li>
<li><p>NV12</p></li>
<li><p>RGB</p></li>
<li><p>v308</p></li>
<li><p>I422_10LE</p></li>
<li><p>GRAY8</p></li>
<li><p>NV12_10LE32</p></li>
<li><p>BGRx</p></li>
<li><p>GRAY10_LE32</p></li>
<li><p>BGRx</p></li>
<li><p>UYVY</p></li>
<li><p>BGR</p></li>
<li><p>RGBA</p></li>
<li><p>BGRA</p></li>
<li><p>I420</p></li>
<li><p>GBR</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure that the color formats needed for your application are supported by the multi-scaler hardware kernel.</p>
</div>
<p>As a reference, multi-scaler configuration for <code class="docutils literal notranslate"><span class="pre">smart</span> <span class="pre">model</span> <span class="pre">select</span></code> example design can be found in <a class="reference external" href="https://github.com/Xilinx/VVAS/blob/master/vvas-examples/Embedded/smart_model_select/v_multi_scaler_config.h">multi-scaler configuration</a></p>
</section>
<section id="id4">
<h4>Control Parameters and Plug-in Properties<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h4>
<p>The following table lists the GStreamer plug-in properties supported by the vvas_xabrscaler plug-in.</p>
<p>Table 3: vvas_xabrscaler Plug-in Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 14%" />
<col style="width: 17%" />
<col style="width: 27%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>avoid-output-copy</p></td>
<td><p>Boolean</p></td>
<td><p>true/false</p></td>
<td><p>False</p></td>
<td><p>Avoid output
frames copy on
all source pads
even when
downstream does
not support
GstVideoMeta
metadata</p></td>
</tr>
<tr class="row-odd"><td><p>enable-pipeline</p></td>
<td><p>Boolean</p></td>
<td><p>true/false</p></td>
<td><p>false</p></td>
<td><p>Enable buffer
pipelining to
improve
performance in
non zero-copy
use cases</p></td>
</tr>
<tr class="row-even"><td><p>in-mem-bank</p></td>
<td><p>Unsigned int</p></td>
<td><p>0 - 65535</p></td>
<td><p>0</p></td>
<td><p>VVAS input memory
bank to allocate
memory</p></td>
</tr>
<tr class="row-odd"><td><p>out-mem-bank</p></td>
<td><p>Unsigned int</p></td>
<td><p>0 - 65535</p></td>
<td><p>0</p></td>
<td><p>VVAS o/p memory
bank to allocate
memory</p></td>
</tr>
<tr class="row-even"><td><p>xclbin-location</p></td>
<td><p>string</p></td>
<td><p>N/A</p></td>
<td><p>./binary_container_1
xclbin</p></td>
<td><p>The
location of
xclbin.</p></td>
</tr>
<tr class="row-odd"><td><p>kernel-name</p></td>
<td><p>string</p></td>
<td><p>N/A</p></td>
<td><p>v_multi_scaler:
multi_scaler_1</p></td>
<td><p>Kernel name
and
instance
separated
by a colon.</p></td>
</tr>
<tr class="row-even"><td><p>dev-idx</p></td>
<td><p>integer</p></td>
<td><p>0 to 31</p></td>
<td><p>0</p></td>
<td><p>Device index
This is valid
only in PCIe/
Data Center
platforms.</p></td>
</tr>
<tr class="row-odd"><td><p>ppc</p></td>
<td><p>integer</p></td>
<td><p>1, 2, 4</p></td>
<td><p>2</p></td>
<td><p>Pixel per
clock
supported
by a multi-
scaler
kernel</p></td>
</tr>
<tr class="row-even"><td><p>scale-mode</p></td>
<td><p>integer</p></td>
<td><p>0, 1, 2</p></td>
<td><p>0</p></td>
<td><p>Scale algorithm
to use:
0:BILINEAR
1:BICUBIC
2:POLYPHASE</p></td>
</tr>
<tr class="row-odd"><td><p>coef-load-type</p></td>
<td><p>integer</p></td>
<td><p>0 =&gt; Fixed
1 =&gt; Auto</p></td>
<td><p>1</p></td>
<td><p>Type of filter
Coefficients to
be used: Fixed
or Auto
generated</p></td>
</tr>
<tr class="row-even"><td><p>num-taps</p></td>
<td><p>integer</p></td>
<td><p>6=&gt;6 taps
8=&gt;8 taps
10=&gt;10 taps
12=&gt;12 taps</p></td>
<td><p>1</p></td>
<td><p>Number of filter
taps to be used
for scaling</p></td>
</tr>
<tr class="row-odd"><td><p>alpha-b</p></td>
<td><p>float</p></td>
<td><p>0 to 128</p></td>
<td><p>0</p></td>
<td><p>Mean subtraction
for blue channel
, needed for PPE</p></td>
</tr>
<tr class="row-even"><td><p>alpha-g</p></td>
<td><p>float</p></td>
<td><p>0 to 128</p></td>
<td><p>0</p></td>
<td><p>Mean subtraction
for green channel
, needed for PPE</p></td>
</tr>
<tr class="row-odd"><td><p>alpha-r</p></td>
<td><p>float</p></td>
<td><p>0 to 128</p></td>
<td><p>0</p></td>
<td><p>Mean subtraction
for red  channel
, needed for PPE</p></td>
</tr>
<tr class="row-even"><td><p>beta-b</p></td>
<td><p>float</p></td>
<td><p>0 to 1</p></td>
<td><p>1</p></td>
<td><p>Scaling for blue
channel, needed
for PPE</p></td>
</tr>
<tr class="row-odd"><td><p>beta-g</p></td>
<td><p>float</p></td>
<td><p>0 to 1</p></td>
<td><p>1</p></td>
<td><p>scaling for green
channel, needed
for PPE</p></td>
</tr>
<tr class="row-even"><td><p>beta-r</p></td>
<td><p>float</p></td>
<td><p>0 to 1</p></td>
<td><p>1</p></td>
<td><p>scaling for red
channel, needed
for PPE</p></td>
</tr>
<tr class="row-odd"><td><p>crop-x</p></td>
<td><p>unsigned
integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>0</p></td>
<td><p>Crop X
coordinate</p></td>
</tr>
<tr class="row-even"><td><p>crop-y</p></td>
<td><p>unsigned
integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>0</p></td>
<td><p>Crop Y
coordinate</p></td>
</tr>
<tr class="row-odd"><td><p>crop-width</p></td>
<td><p>unsigned
integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>0</p></td>
<td><p>Crop width (
minimum: 64), if
this is 0 or not
set, it will be
calculated as
input width -
<cite>crop-x</cite></p></td>
</tr>
<tr class="row-even"><td><p>crop-height</p></td>
<td><p>unsigned
integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>0</p></td>
<td><p>Crop height (
minimum: 64), if
this is 0 or not
set, it will be
calculated as
input height -
<cite>crop-y</cite></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MultiScaler IP has some alignment requirement, hence user given parameters for crop are aligned as per the IP requirement, alignment ensures that it covers the region of crop specified by user, hence final cropped image may have extra pixels cropped.</p>
</div>
</section>
<section id="id5">
<h4>Example Pipelines<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h4>
<section id="one-input-one-output">
<h5>One input one output<a class="headerlink" href="#one-input-one-output" title="Permalink to this heading">¶</a></h5>
<p>The following example configures vvas_xabrscaler in one input and one output mode. The input to the scaler is 1280 x 720, NV12 frames that are resized to 640 x 360 resolution, and the color format is changed from NV12 to BGR.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 videotestsrc num-buffers=100 \
! &quot;video/x-raw, width=1280, height=720, format=NV12&quot; \
! vvas_xabrscaler xclbin-location=&quot;/usr/lib/dpu.xclbin&quot; kernel-name=v_multi_scaler:{v_multi_scaler_1} \
! &quot;video/x-raw, width=640, height=360, format=BGR&quot; ! fakesink -v
</pre></div>
</div>
</section>
<section id="one-input-multiple-output">
<h5>One input multiple output<a class="headerlink" href="#one-input-multiple-output" title="Permalink to this heading">¶</a></h5>
<p>The following example configures vvas_xabrscaler for one input and three outputs. The input is 1920 x 1080 resolution in NV12 format. There are three output formats:</p>
<ul class="simple">
<li><p>1280 x 720 in BGR format</p></li>
<li><p>300 x 300 in RGB format</p></li>
<li><p>640 x 480 in NV12 format</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 videotestsrc num-buffers=100 \
! &quot;video/x-raw, width=1920, height=1080, format=NV12, framerate=60/1&quot; \
! vvas_xabrscaler xclbin-location=&quot;/usr/lib/dpu.xclbin&quot; kernel-name=v_multi_scaler:{v_multi_scaler_1} name=sc sc.src_0 \
! queue \
! &quot;video/x-raw, width=1280, height=720, format=BGR&quot; \
! fakesink sc.src_1 \
! queue \
! &quot;video/x-raw, width=300, height=300, format=RGB&quot; \
! fakesink sc.src_2 \
! queue \
! &quot;video/x-raw, width=640, height=480, format=NV12&quot; \
! fakesink -v
</pre></div>
</div>
</section>
<section id="crop-with-multiple-output">
<h5>Crop with multiple output:<a class="headerlink" href="#crop-with-multiple-output" title="Permalink to this heading">¶</a></h5>
<p>The following example configures <code class="docutils literal notranslate"><span class="pre">vvas_xabrscaler</span></code> for one input and three outputs. The input is 1920 x 1080 resolution in NV12 format.
This input is cropped at X:140, Y:300, Width:640, Height:480.</p>
<p>Cropped input is scaled and converted to below format:</p>
<ul class="simple">
<li><p>640 * 480 in RGB format</p></li>
<li><p>320 * 240 in RGB format</p></li>
<li><p>256 * 256 in NV12 format</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 -v \
videotestsrc num-buffers=10 ! video/x-raw,format=NV12,width=1920,height=1080 \
! vvas_xabrscaler name=sc dev-idx=0 crop-x=140 crop-y=300 crop-width=640 crop-height=480 \
sc.src_0 ! queue ! video/x-raw,format=RGB,width=640,height=480 ! filesink location=480p.yuv \
sc.src_1 ! queue ! video/x-raw,format=RGB,width=320,height=240 ! filesink location=240p.yuv \
sc.src_2 ! queue ! video/x-raw,format=NV12,width=256,height=256 ! filesink location=256p.yuv -v
</pre></div>
</div>
</section>
</section>
</section>
<section id="vvas-xinfer">
<span id="id6"></span><h3>vvas_xinfer<a class="headerlink" href="#vvas-xinfer" title="Permalink to this heading">¶</a></h3>
<p>GStreamer inference plug-in, <code class="docutils literal notranslate"><span class="pre">vvas_xinfer</span></code>, performs inferencing on video frames/images with the help of <code class="docutils literal notranslate"><span class="pre">Vitis</span> <span class="pre">AI</span></code> library and prepares tree like metadata in <code class="docutils literal notranslate"><span class="pre">GstInferenceMeta</span></code> object and attaches the same to input GstBuffer. This plug-in triggers optional preprocessing (scale/crop &amp; etc.) operations with the help of <code class="docutils literal notranslate"><span class="pre">vvas_xpreprocessor</span></code>  kernel library (which is on top of Xilinx’s multiscaler IP) on incoming video frames before calling <code class="docutils literal notranslate"><span class="pre">vvas_xdpuinfer</span></code> kernel library. vvas_xinfer plug-in’s input capabilities are influenced by vvas_xpreprocessor library input capabilities and Vitis AI library capabilities (Vitis-AI does software scaling). If preprocessing is enabled and vvas_xinfer plug-in is receiving non-CMA memory frames, then data copy will be made to ensure CMA frames goes to preprocessing engine. The main advantage of this plug-in is users/customers can realize inference cascading use cases with ease.
For implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/sys/infer">vvas_xinfer source code</a></p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vvas_xinfer_blockdiagram.png"><img alt="../../_images/vvas_xinfer_blockdiagram.png" src="../../_images/vvas_xinfer_blockdiagram.png" style="width: 927.2px; height: 592.8000000000001px;" /></a>
</figure>
<section id="id7">
<h4>Input and Output<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>Accepts buffers with GRAY8/ NV12/ BGR/ RGB/ YUY2/ r210/ v308/ GRAY10_LE32/ ABGR/ ARGB color formats on input GstPad &amp; output GstPad. Make sure HW supports the required format.</p></li>
<li><p>Attaches <code class="docutils literal notranslate"><span class="pre">GstInferenceMeta</span></code> metadata to output GstBuffer. For details about meta data, refer to <a class="reference internal" href="vvas_meta_data_structures.html#vvas-inference-metadata"><span class="std std-ref">VVAS Inference Metadata</span></a></p></li>
</ul>
</section>
<section id="control-parameters">
<h4>Control Parameters<a class="headerlink" href="#control-parameters" title="Permalink to this heading">¶</a></h4>
<table class="colwidths-given docutils align-default" id="id46">
<caption><span class="caption-text">Control Parameters</span><a class="headerlink" href="#id46" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Range</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>dynamic-config</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>Null</p></td>
<td><p>String contains dynamic json configuration of inference accelration library</p></td>
</tr>
<tr class="row-odd"><td><p>infer-config</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>Null</p></td>
<td><p>location of the inference kernel library configuration file in json format</p></td>
</tr>
<tr class="row-even"><td><p>preprocess-config</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>Null</p></td>
<td><p>location of the scaler kernels config file in json format</p></td>
</tr>
</tbody>
</table>
</section>
<section id="infer-config-json-members">
<h4>infer-config json members<a class="headerlink" href="#infer-config-json-members" title="Permalink to this heading">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 10%" />
<col style="width: 79%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Json key</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>Item description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p>vvas-library-repo</p></td>
<td><p>Description</p></td>
<td><p>VVAS libraries repository path to look for kernel libraries by VVAS GStreamer plug-in</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>/usr/lib in Embedded platforms
/opt/xilinx/vvas/lib in PCIe platforms</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>inference-level</p></td>
<td><p>Description</p></td>
<td><p>Inference level in cascaded inference use case. e.g. Object detection ML (level-1) followed by object classification (level-2) on detected objects</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>Integer</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>low-latency</p></td>
<td><p>Description</p></td>
<td><p>Parameter to enable/disable low-latency mode in vvas_xinfer and it is useful only when inference-level &gt; 1.
If enabled, then vvas_xinfer plug-in will not wait for batch-size frames to be accumulated to reduce latency.
If disabled, inference engine can work at maximum throughput.</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>Boolean</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>inference-max-queue</p></td>
<td><p>Description</p></td>
<td><p>Maximum number of input frames those can be queued inside the plug-in.
When low-latency is disabled, vvas_xinfer plug-in will wait for inference-max-queue buffers until batch-size is accumulated</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>Integer</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>batch-size</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>attach-ppe-outbuf</p></td>
<td><p>Description</p></td>
<td><p>Attaches output of preprocessing library to GstInferenceMeta to avoid redoing of the preprocessing if required.</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>Boolean</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>False</p></td>
</tr>
<tr class="row-even"><td rowspan="5"><p>kernel</p></td>
<td><p>Description</p></td>
<td><p>Kernel object provides information about an VVAS kernel library configuration and kernel library name</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>JSON Object</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Object Members</p></td>
<td><p>members of kernel JSON object are mentioned below</p></td>
</tr>
</tbody>
</table>
</section>
<section id="infer-config-kernel-json-members">
<h4>infer-config::kernel json members<a class="headerlink" href="#infer-config-kernel-json-members" title="Permalink to this heading">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 13%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>JSON key</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p>library-name</p></td>
<td><p>Description</p></td>
<td><p>Name of inference kernel library to be loaded for inferencing</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-even"><td rowspan="5"><p>config</p></td>
<td><p>Description</p></td>
<td><p>Inference kernel specific configuration</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>JSON object</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Object members</p></td>
<td><p>Contains members specific to inference kernel library. See vvas_xdpuinfer acceleration library for more information</p></td>
</tr>
</tbody>
</table>
</section>
<section id="preprocess-config-json-members">
<h4>preprocess-config json members<a class="headerlink" href="#preprocess-config-json-members" title="Permalink to this heading">¶</a></h4>
<p>Table 4 preprocess-config json members</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 14%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Json key</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>Item description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p>xclbin-location</p></td>
<td><p>Description</p></td>
<td><p>Location of xclbin which contains scaler IP to program FPGA device based on device-index property</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>vvas-library-repo</p></td>
<td><p>Description</p></td>
<td><p>VVAS libraries repository path to look for kernel libraries by VVAS GStreamer plug-in</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>/usr/lib in Embedded platforms
/opt/xilinx/vvas/lib in PCIe platforms</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>device-index</p></td>
<td><p>Description</p></td>
<td><p>Device index on which scaler IP is present</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>Integer</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Mandatory in PCIe platforms
In embedded platforms, device-index is not an applicable option as it is always zero</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>-1 in PCIe platforms
0 in Embedded platforms</p></td>
</tr>
<tr class="row-even"><td rowspan="5"><p>kernel</p></td>
<td><p>Description</p></td>
<td><p>Kernel object provides information about an VVAS kernel library configuration and kernel library name</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>JSON Object</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Object Members</p></td>
<td><p>members of kernel JSON object are mentioned below</p></td>
</tr>
</tbody>
</table>
</section>
<section id="preprocess-config-kernel-json-members">
<h4>preprocess-config::kernel json members<a class="headerlink" href="#preprocess-config-kernel-json-members" title="Permalink to this heading">¶</a></h4>
<p>Table 5: preprocess-config::kernel json members</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 18%" />
<col style="width: 69%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>JSON key</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="4"><p>library-name</p></td>
<td><p>Description</p></td>
<td><p>Name of kernel library to be loaded for inferencing</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-even"><td rowspan="4"><p>kernel-name</p></td>
<td><p>Description</p></td>
<td><p>Name of the preprocessing kernel. Syntax : “&lt;kernel_name&gt;:&lt;instance_name&gt;”</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-even"><td rowspan="5"><p>config</p></td>
<td><p>Description</p></td>
<td><p>preprocess kernel specific configuration</p></td>
</tr>
<tr class="row-odd"><td><p>Value type</p></td>
<td><p>JSON object</p></td>
</tr>
<tr class="row-even"><td><p>Mandatory/Optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>Default value</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>Object members</p></td>
<td><p>Contains members specific to preprocess kernel library</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Example infer-json file:</p></li>
</ul>
<p>This file is used to configure vvas_xdpuinfer library for Machine Learning.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;vvas-library-repo&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/lib/&quot;</span><span class="p">,</span>
   <span class="s2">&quot;inference-level&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
   <span class="s2">&quot;inference-max-queue&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
   <span class="s2">&quot;attach-ppe-outbuf&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
   <span class="s2">&quot;low-latency&quot;</span><span class="p">:</span><span class="n">false</span><span class="p">,</span>
   <span class="s2">&quot;kernel&quot;</span> <span class="p">:</span> <span class="p">{</span>
       <span class="s2">&quot;library-name&quot;</span><span class="p">:</span><span class="s2">&quot;libvvas_xdpuinfer.so&quot;</span><span class="p">,</span>
       <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
           <span class="s2">&quot;model-name&quot;</span> <span class="p">:</span> <span class="s2">&quot;yolov3_voc_tf&quot;</span><span class="p">,</span>
           <span class="s2">&quot;model-class&quot;</span> <span class="p">:</span> <span class="s2">&quot;YOLOV3&quot;</span><span class="p">,</span>
           <span class="s2">&quot;model-format&quot;</span> <span class="p">:</span> <span class="s2">&quot;RGB&quot;</span><span class="p">,</span>
           <span class="s2">&quot;batch-size&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
           <span class="s2">&quot;model-path&quot;</span> <span class="p">:</span> <span class="s2">&quot;/usr/share/vitis_ai_library/models/&quot;</span><span class="p">,</span>
           <span class="s2">&quot;run_time_model&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
           <span class="s2">&quot;need_preprocess&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
           <span class="s2">&quot;performance_test&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
           <span class="s2">&quot;debug_level&quot;</span> <span class="p">:</span> <span class="mi">0</span>
       <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Example preprocess-config json file:</p></li>
</ul>
<p>This json file captures the parameters for the pre-processing kernel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;xclbin-location&quot;</span><span class="p">:</span><span class="s2">&quot;/usr/lib/dpu.xclbin&quot;</span><span class="p">,</span>
   <span class="s2">&quot;vvas-library-repo&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/lib&quot;</span><span class="p">,</span>
   <span class="s2">&quot;device-index&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
   <span class="s2">&quot;kernels&quot;</span> <span class="p">:[</span>
       <span class="p">{</span>
           <span class="s2">&quot;kernel-name&quot;</span><span class="p">:</span> <span class="s2">&quot;v_multi_scaler:</span><span class="si">{v_multi_scaler_1}</span><span class="s2">&quot;</span><span class="p">,</span>
           <span class="s2">&quot;library-name&quot;</span><span class="p">:</span> <span class="s2">&quot;libvvas_xpreprocessor.so&quot;</span><span class="p">,</span>
           <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;alpha_r&quot;</span> <span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
              <span class="s2">&quot;alpha_g&quot;</span> <span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
              <span class="s2">&quot;alpha_b&quot;</span> <span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
              <span class="s2">&quot;beta_r&quot;</span> <span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
              <span class="s2">&quot;beta_g&quot;</span> <span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
              <span class="s2">&quot;beta_b&quot;</span> <span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
              <span class="s2">&quot;cascade&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;debug_level&quot;</span> <span class="p">:</span> <span class="mi">0</span>
           <span class="p">}</span>
       <span class="p">}</span>
   <span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When user wants to perform hardware accelerated pre-processing on input frame using <code class="docutils literal notranslate"><span class="pre">vvas_xinfer</span></code> plug-in, then the pre-processing parameters provided in <strong>preprocess-config</strong> json file must be checked for correctness. The pre-processing parameters for the models are provided in the prototxt file for the models. For few models these parameters need to be modified from what it is in the prototxt file. User must provide these modified values in the preprocess-config json file.
There are few steps mentioned below to know which models need changes.</p>
</div>
<p>To determine the pre-processing parameters for a model, follow the steps mentioned below:</p>
<ul class="simple">
<li><p>Get the algorithmic scale vector, i.e. “scale” fields for each channel R,G,B mentioned in the model prototxt file. If the model expects input image in RGB format, then the first field will corresponds to Channel R, next will correspond to Channel G, and the last one will be for Channel B. Example prototxt file contents are mentioned below:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;yolov3_voc_416&quot;</span>
        <span class="n">kernel</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;yolov3_voc_416&quot;</span>
            <span class="n">mean</span><span class="p">:</span> <span class="mf">0.0</span>
            <span class="n">mean</span><span class="p">:</span> <span class="mf">0.0</span>
            <span class="n">mean</span><span class="p">:</span> <span class="mf">0.0</span>
            <span class="n">scale</span><span class="p">:</span> <span class="mf">0.00390625</span>
            <span class="n">scale</span><span class="p">:</span> <span class="mf">0.00390625</span>
            <span class="n">scale</span><span class="p">:</span> <span class="mf">0.00390625</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Calculate the <code class="docutils literal notranslate"><span class="pre">inner</span> <span class="pre">scale</span></code> value from the “fixpos” field of the “input_tensor” by executing the command at command prompt on the target board in case of Embedded platform.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xdputil</span> <span class="n">xmodel</span> <span class="o">-</span><span class="n">l</span> <span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">xmodel</span><span class="o">.</span><span class="n">xmodel</span>

<span class="n">you</span> <span class="n">can</span> <span class="n">get</span> <span class="n">something</span> <span class="n">like</span><span class="p">:</span>

<span class="p">{</span>
 <span class="s2">&quot;subgraphs&quot;</span><span class="p">:[</span>
     <span class="p">{</span>
         <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;subgraph_data&quot;</span><span class="p">,</span>
         <span class="s2">&quot;device&quot;</span><span class="p">:</span><span class="s2">&quot;USER&quot;</span>
     <span class="p">},</span>
     <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;subgraph_conv1_1&quot;</span><span class="p">,</span>
         <span class="s2">&quot;device&quot;</span><span class="p">:</span><span class="s2">&quot;DPU&quot;</span><span class="p">,</span>
         <span class="s2">&quot;fingerprint&quot;</span><span class="p">:</span><span class="s2">&quot;0x1000020f6014407&quot;</span><span class="p">,</span>
         <span class="s2">&quot;DPU Arch&quot;</span><span class="p">:</span><span class="s2">&quot;DPUCZDX8G_ISA0_B4096_MAX_BG2&quot;</span><span class="p">,</span>
         <span class="s2">&quot;input_tensor&quot;</span><span class="p">:[</span>
             <span class="p">{</span>
                 <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;data_fixed&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;shape&quot;</span><span class="p">:</span><span class="s2">&quot;[1, 360, 480, 3]&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;fixpos&quot;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span>
             <span class="p">}</span>
         <span class="p">],</span>


 <span class="n">inner</span> <span class="n">scale</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="n">fixpos</span>
             <span class="o">=</span> <span class="mi">2</span><span class="o">^-</span><span class="mi">1</span>
             <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Multiply the “scale” vector values from prototxt file with the inner scale calculated above. Provide these values in the preprocess-config json file. User need to be careful while assigning the value to the correct channel field.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">If</span> <span class="n">the</span> <span class="n">model</span> <span class="n">expects</span> <span class="nb">input</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">RGB</span> <span class="nb">format</span><span class="p">,</span> <span class="n">then</span> <span class="n">the</span> <span class="n">first</span> <span class="n">scale</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">prototxt</span> <span class="n">file</span> <span class="n">will</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">channel</span> <span class="n">R</span><span class="o">.</span> <span class="n">So</span> <span class="n">after</span> <span class="n">multiplying</span> <span class="k">with</span> <span class="n">the</span> <span class="s2">&quot;inner scale&quot;</span> <span class="n">value</span><span class="p">,</span> <span class="n">assign</span> <span class="n">this</span> <span class="n">first</span> <span class="n">value</span> <span class="n">to</span> <span class="s2">&quot;beta_r&quot;</span> <span class="ow">in</span> <span class="n">preprocess</span><span class="o">-</span><span class="n">config</span> <span class="n">json</span> <span class="n">file</span><span class="o">.</span> <span class="n">Repeat</span> <span class="n">the</span> <span class="n">same</span> <span class="k">for</span> <span class="n">other</span> <span class="n">channels</span><span class="o">.</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Example Simple inference (YOLOv3) pipeline which takes NV12 YUV file (test.nv12) as input is described below:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=&lt;test.nv12&gt; ! videoparse width=1920 height=1080 format=nv12 ! \
vvas_xinfer preprocess-config=yolo_preproc.json infer-config=yolov3_voc.json ! fakesink -v
</pre></div>
</div>
<ul class="simple">
<li><p>Example cascade inference (YOLOv3+Resnet18) pipeline which takes NV12 YUV file (test.nv12) as input is described below:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=&lt;test.nv12&gt; ! videoparse width=1920 height=1080 format=nv12 ! \
vvas_xinfer preprocess-config=yolo_preproc.json infer-config=yolov3_voc.json ! queue ! \
vvas_xinfer preprocess-config=resnet_preproc.json infer-config=resnet18.json ! fakesink -v
</pre></div>
</div>
</section>
</section>
<section id="vvas-xoptflow">
<span id="id8"></span><h3>vvas_xoptflow<a class="headerlink" href="#vvas-xoptflow" title="Permalink to this heading">¶</a></h3>
<p>Optical flow is one of the key functions used in many image processing and computer vision applications like object tracking, motion based segmentation, depth estimation, stitching and video frame rate conversion etc. Optical flow is estimated using previous and current frame pixel information.</p>
<p>For optical flow estimation this plug-in uses hardware accelerator of xfopencv non-pyramid optical flow. This non-pyramid optical flow function takes current and previous frame as input and generates two floating point buffers of x and y direction displacements. Optical flow plug-in attaches these displacement buffers as <strong>gstvvasofmeta</strong>.
For implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/sys/optflow">vvas_xoptflow source code</a></p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vvas_optflow_blockdiagram.png"><img alt="../../_images/vvas_optflow_blockdiagram.png" src="../../_images/vvas_optflow_blockdiagram.png" style="width: 486.40000000000003px; height: 342.40000000000003px;" /></a>
</figure>
<section id="id9">
<h4>Prerequisite<a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h4>
<p>This plug-in uses <strong>dense_non_pyr_of_accel</strong> kernel. Make sure your xclbin has this kernel.</p>
</section>
<section id="id10">
<h4>Input and Output<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h4>
<p>Accepts buffer of NV12 format and generates two metadata buffers of type float and each size equal to the size of frame.
For details about the meta data structure, refer to <span class="xref std std-ref">optical_flow_metadata</span></p>
</section>
<section id="plug-in-properties">
<h4>Plug-in Properties<a class="headerlink" href="#plug-in-properties" title="Permalink to this heading">¶</a></h4>
<p>Table 6: vvas_xoptflow Plug-in Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 15%" />
<col style="width: 17%" />
<col style="width: 25%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xclbin-loc</p></td>
<td><p>String</p></td>
<td><p>NA</p></td>
<td><p>./binary_container_1
.xclbin</p></td>
<td><p>location of
xclbin</p></td>
</tr>
<tr class="row-odd"><td><p>dev-idx</p></td>
<td><p>Integer</p></td>
<td><p>0 to 31</p></td>
<td><p>0</p></td>
<td><p>device index</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id11">
<h4>example Pipelines<a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h4>
<p>The following example demonstrates use of vvas_xoptflow plug-in.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=$1 ! \
h264parse ! \
queue ! \
omxh264dec internal-entropy-buffers=2 ! \
videorate ! video/x-raw, framerate=10/1 ! \
queue ! \
vvas_xinfer preprocess-config=kernel_preprocessor_dev0_yolov3_voc_tf.json infer-config=kernel_yolov3_voc_tf.json name=infer ! \
vvas_xoptflow xclbin-location=&quot;/mnt/sd-mmcblk0p1/dpu.xclbin&quot; ! \
fakesink -v
</pre></div>
</div>
</section>
</section>
<section id="vvas-xoverlay">
<span id="id12"></span><h3>vvas_xoverlay<a class="headerlink" href="#vvas-xoverlay" title="Permalink to this heading">¶</a></h3>
<p>Overlay plug-in is used for drawing bounding boxes, text, lines, arrows, circles, and polygons on frames. Bounding boxes can be drawn by using hardware accelerator. By setting use-bbox-accel property of the plug-in user can use hardware accelerator for drawing bounding boxes. Using display-clock property user can display clock on any part of the frame.</p>
<p>Forr drawing objects like bounding box, lines, arrows etc., the information about these objects must be provided through overlay metadata structure attached to the buffer. For more information about this overlay meta data structure, refer to <a class="reference internal" href="vvas_meta_data_structures.html#vvas-overlay-metadata"><span class="std std-ref">VVAS Overlay Metadata</span></a>.</p>
<p>For converting metadata generated from upstream plug-in like infer, opticalflow, segmentation etc., to gstvvasoverlaymeta an intermediate plug-in, <a class="reference internal" href="#vvas-xmetaconvert"><span class="std std-ref">vvas_xmetaconvert</span></a> is to be used before <code class="docutils literal notranslate"><span class="pre">vvas_xoverlay</span></code> plug-in.</p>
<p>For implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/sys/overlay">vvas_xoverlay source code</a></p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vvas_overlay_blockdiagram.png"><img alt="../../_images/vvas_overlay_blockdiagram.png" src="../../_images/vvas_overlay_blockdiagram.png" style="width: 464.8px; height: 338.40000000000003px;" /></a>
</figure>
<section id="supported-features">
<h4>Supported features<a class="headerlink" href="#supported-features" title="Permalink to this heading">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 87%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Feature</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>boxes</p></td>
<td><p>Drawing bounding boxes with and without background color</p></td>
</tr>
<tr class="row-odd"><td><p>text</p></td>
<td><p>Overlaying of text with and without background color. Supports text fonts available in opencv</p></td>
</tr>
<tr class="row-even"><td><p>lines</p></td>
<td><p>For drawing lines with different thickness and color</p></td>
</tr>
<tr class="row-odd"><td><p>arrows</p></td>
<td><p>Drawing arrows on either side of line or both the sides</p></td>
</tr>
<tr class="row-even"><td><p>circle</p></td>
<td><p>For drawing circles of different radius and thickness without fill</p></td>
</tr>
<tr class="row-odd"><td><p>polygons</p></td>
<td><p>For drawing closed polygons without fill</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id13">
<h4>Input and Output<a class="headerlink" href="#id13" title="Permalink to this heading">¶</a></h4>
<p>Supported input buffer formats are RGB, NV12 and Grayscale. Required metadata in gstvvasoverlaymeta type for drawing.</p>
</section>
<section id="id14">
<h4>Control Parameters and Plug-in Properties<a class="headerlink" href="#id14" title="Permalink to this heading">¶</a></h4>
<p>The following table lists the GStreamer plug-in properties supported by the vvas_xoverlay plug-in.</p>
<p>Table 7: vvas_xoverlay Plug-in Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 25%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xclbin-loc</p></td>
<td><p>String</p></td>
<td><p>NA</p></td>
<td><p>./binary_container_1
.xclbin</p></td>
<td><p>location of xcllbin</p></td>
</tr>
<tr class="row-odd"><td><p>dev-idx</p></td>
<td><p>Integer</p></td>
<td><p>0 to 31</p></td>
<td><p>0</p></td>
<td><p>device index</p></td>
</tr>
<tr class="row-even"><td><p>display-clock</p></td>
<td><p>Boolean</p></td>
<td><p>0 or 1</p></td>
<td><p>0</p></td>
<td><p>flag for indicating
displaying clock</p></td>
</tr>
<tr class="row-odd"><td><p>use-bbox-accel</p></td>
<td><p>Boolean</p></td>
<td><p>0 or 1</p></td>
<td><p>0</p></td>
<td><p>flag to use
accelerator for
bounding boxes</p></td>
</tr>
<tr class="row-even"><td><p>clock-fontname</p></td>
<td><p>Integer</p></td>
<td><p>0 or 7</p></td>
<td><p>0</p></td>
<td><p>font number for clock
based on opencv</p></td>
</tr>
<tr class="row-odd"><td><p>clock-fontscale</p></td>
<td><p>float</p></td>
<td><p>0.1 to 1.0</p></td>
<td><p>0.5</p></td>
<td><p>font scale of
display clock</p></td>
</tr>
<tr class="row-even"><td><p>clock-fontcolor</p></td>
<td><p>Integer</p></td>
<td><p>0 to
4,294,967,295</p></td>
<td><p>0xff00</p></td>
<td><p>RGB color of display
clock as 0xRGB</p></td>
</tr>
<tr class="row-odd"><td><p>clock-xoffset</p></td>
<td><p>Integer</p></td>
<td><p>0 to
frame width</p></td>
<td><p>100</p></td>
<td><p>x starting position</p></td>
</tr>
<tr class="row-even"><td><p>clock-yoffset</p></td>
<td><p>Integer</p></td>
<td><p>0 to
frame height</p></td>
<td><p>50</p></td>
<td><p>y starting position</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id15">
<h4>Example Pipelines<a class="headerlink" href="#id15" title="Permalink to this heading">¶</a></h4>
<p>The following example demonstrates use of <code class="docutils literal notranslate"><span class="pre">vvas_xoverlay</span></code> plug-in with <code class="docutils literal notranslate"><span class="pre">vvas_xxinfer</span></code> and <code class="docutils literal notranslate"><span class="pre">vvas_xmetaconvert</span></code> plug-ins for drawing bounding boxes. <code class="docutils literal notranslate"><span class="pre">vvas_xinfer</span></code> plug-in produces inference result and stores in VVAS_GstInference data structure. This metadata is parsed and translated into a different metadata structure that understood by <code class="docutils literal notranslate"><span class="pre">vvas_xmetaconvert</span></code> plug-in to draw the bounding box. This translation of meta data is done by <code class="docutils literal notranslate"><span class="pre">vvas_xmetaconvert</span></code> plug-in.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=&quot;&lt;PATH&gt;/001.bgr&quot; blocksize=150528 numbuffers=1
! videoparse width=224 height=224 framerate=30/1 format=16
! vvas_xfilter name=&quot;kernel1&quot; kernels-config=&quot;&lt;PATH&gt;/kernel_resnet50.json&quot;
! vvas_xmetaconvert config-location=&quot;&lt;PATH&gt;/metaconvert.json&quot;
! vvas_xoverlay ! filesink location=output.bgr
</pre></div>
</div>
</section>
</section>
<section id="vvas-xtracker">
<span id="id16"></span><h3>vvas_xtracker<a class="headerlink" href="#vvas-xtracker" title="Permalink to this heading">¶</a></h3>
<p>The tracker plug-in tracks detected objects in a sequence of video frames. Because tracking is easier than detection, tracking algorithms can use fewer computational resources than running an object detector on every frame and hence finds many applications.</p>
<p>Each tracker element in the frame is given a unique ID and is initialized with the coordinates of the object detected by ML block. The object is snipped from the frame and taken as a template. Afterward, the tracker element updates the filter every time that there is an object hit, adapting itself to the possible changes which an object might have during the video.</p>
<p>The tracker plug-in supports three types of object tracking algorithms, namely <strong>Intersection-Over-Union (IOU), Kernelized Correlation Filters (KCF) and Minimum Output Sum of Squared Error (MOSSE)</strong>.  IOU algorithm is used when detection output is available for every frame.  Kernelized Correlation Filters (KCF) algorithm or Minimum Output Sum of Squared Error (MOSSE) filter algorithm implemented completely in software using optimizations for the host processor.
For implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/gst/tracker">vvas_xtracker source code</a></p>
<p>Tracker plug-in supports detecting 16 objects supporting tracker Id from 0 to 15. Beyond these, the tracker Ids restarts from 0.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../_images/vvas_tracker_blockdiagram.png"><img alt="../../_images/vvas_tracker_blockdiagram.png" src="../../_images/vvas_tracker_blockdiagram.png" style="width: 1004.0px; height: 340.0px;" /></a>
</figure>
<p>In the above pipeline, preprocessor generates two outputs, one in the resolution and color format required by the object detection model and the other one in the resolution required by the model in NV12 format. One output is provided to ML block to detect the object in the frame. Since the tracker is used in the pipeline, ML block can be run at lower framerate using <code class="docutils literal notranslate"><span class="pre">videorate</span></code> plug-in. The detection co-ordinates of the frames detected by the ML block are used by tracker plug-in to initialize the objects to track by tracker plug-in. For the frames that are skipped by ML block, tracker plug-in tracks and updates the tracked co-ordinates in the metadata for the next plug-in to draw the bounding boxes.</p>
<section id="id17">
<h4>Input and Output<a class="headerlink" href="#id17" title="Permalink to this heading">¶</a></h4>
<p>Accepts buffers with NV12 color formats on input GstPad &amp; output GstPad.</p>
</section>
<section id="id18">
<h4>Control Parameters and Plug-in Properties<a class="headerlink" href="#id18" title="Permalink to this heading">¶</a></h4>
<p>The following table lists the GStreamer plug-in properties supported by the vvas_xtracker plug-in.</p>
<p>Table 8: vvas_xtracker Plug-in Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 13%" />
<col style="width: 15%" />
<col style="width: 24%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>tracker-algo</p></td>
<td><p>Enum</p></td>
<td><p>0, 1, 2</p></td>
<td><p>0</p></td>
<td><p>Tracker algorithm to
use</p>
<p>0 - Tracker IOU
algorithm</p>
<p>1 - Tracker MOSSE
algorithm</p>
<p>2 - Tracker KCF
algorithm</p>
</td>
</tr>
<tr class="row-odd"><td><p>IOU-with-color</p></td>
<td><p>Boolean</p></td>
<td><p>0 or 1</p></td>
<td><p>0</p></td>
<td><p>To use color
information during
matching</p>
<p>0 - No color
information for
matching</p>
<p>1 - Use color
information for
matching</p>
</td>
</tr>
<tr class="row-even"><td><p>obj-match-color-space</p></td>
<td><p>Enum</p></td>
<td><p>0 or 1</p></td>
<td><p>1</p></td>
<td><p>Color space to use
for objects matching</p>
<p>0 - RGB color space
for object match</p>
<p>1 - HSV color space
for object match</p>
</td>
</tr>
<tr class="row-odd"><td><p>feature-length</p></td>
<td><p>Enum</p></td>
<td><p>22, 31</p></td>
<td><p>31</p></td>
<td><p>Object feature length
(required only for</p>
<blockquote>
<div><p>KCF algorithm)</p>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><p>search-scale</p></td>
<td><p>Enum</p></td>
<td><p>0, 1, 2</p></td>
<td><p>0</p></td>
<td><p>Scales to verify for
object localization</p>
<p>0 - Search all scales
(up, down and same
scale)</p>
<p>1 - Search up and
same scale</p>
<p>2 - Search down and
same scale</p>
</td>
</tr>
<tr class="row-odd"><td><p>detection-interval</p></td>
<td><p>Integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>5</p></td>
<td><p>Object detection
interval in number of
frames i.e frame
interval at which
objects are passed
via ML block for
detection.</p>
<p>If video framerate is
60fps and ML block
framerate is 12 fps
then set the
detection-interval
to 60/12 = 5</p>
<p>Please make sure this
field is set correctly
to get accurate
tracker resutls</p>
</td>
</tr>
<tr class="row-even"><td><p>inactive-wait-
interval</p></td>
<td><p>Integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>24</p></td>
<td><p>Number of frames
to wait before
stopping tracking of
inactive objects</p></td>
</tr>
<tr class="row-odd"><td><p>min-object-width</p></td>
<td><p>Integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>20</p></td>
<td><p>Minimum object width
in pixels to consider
for tracking</p></td>
</tr>
<tr class="row-even"><td><p>min-object-height</p></td>
<td><p>Integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>60</p></td>
<td><p>Minimum object height
in pixels to consider
for tracking</p></td>
</tr>
<tr class="row-odd"><td><p>max-object-width</p></td>
<td><p>Integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>200</p></td>
<td><p>Objects width above
maximum width are not
considered for
tracking</p></td>
</tr>
<tr class="row-even"><td><p>max-object-height</p></td>
<td><p>Integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>360</p></td>
<td><p>Objects height above
maximum height are
not considered for
tracking</p></td>
</tr>
<tr class="row-odd"><td><p>num-frames-confidence</p></td>
<td><p>Integer</p></td>
<td><p>0 to
4294967295</p></td>
<td><p>3</p></td>
<td><p>Number of times
object need to be
detected continuously
to consider for</p>
<blockquote>
<div><p>tracking</p>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><p>match-search-region</p></td>
<td><p>Float</p></td>
<td><p>1.0 to 2.0</p></td>
<td><p>1.0</p></td>
<td><p>Object search region
during detection for
IOU based matching</p></td>
</tr>
<tr class="row-odd"><td><p>relative-search-
region</p></td>
<td><p>Float</p></td>
<td><p>1.0 to 2.5</p></td>
<td><p>1.5</p></td>
<td><p>Object search region
with respect to
detection coordinates</p></td>
</tr>
<tr class="row-even"><td><p>correlation-threshold</p></td>
<td><p>Float</p></td>
<td><p>0.1 to 1.0</p></td>
<td><p>0.7</p></td>
<td><p>Object correlation
threshold value for
matching</p></td>
</tr>
<tr class="row-odd"><td><p>overlap-threshold</p></td>
<td><p>Float</p></td>
<td><p>0.0011 to 1.0</p></td>
<td><p>0.001</p></td>
<td><p>Object overlap
threshold to consider
for matching</p></td>
</tr>
<tr class="row-even"><td><p>scale-change-
threshold</p></td>
<td><p>Float</p></td>
<td><p>0.1 to 1.0</p></td>
<td><p>0.7</p></td>
<td><p>Maximum object scale
change threshold to
consider for matching.
Value of 1 means
double the scale</p></td>
</tr>
<tr class="row-odd"><td><p>correlation-weight</p></td>
<td><p>Float</p></td>
<td><p>0.0 to 1.0</p></td>
<td><p>0.6</p></td>
<td><p>Weightage for
correlation value</p></td>
</tr>
<tr class="row-even"><td><p>overlap-weight</p></td>
<td><p>Float</p></td>
<td><p>0.0 to 1.0</p></td>
<td><p>0.3</p></td>
<td><p>Weightage for
overlap value</p></td>
</tr>
<tr class="row-odd"><td><p>scale-change-weight</p></td>
<td><p>Float</p></td>
<td><p>0.0 to 1.0</p></td>
<td><p>0.1</p></td>
<td><p>Weightage for
change in scale</p></td>
</tr>
<tr class="row-even"><td><p>occlusion-threshold</p></td>
<td><p>Float</p></td>
<td><p>0.0 to 1.0</p></td>
<td><p>0.4</p></td>
<td><p>Threshold for
considering object as
occluded</p></td>
</tr>
<tr class="row-odd"><td><p>confidence-score-
threshold</p></td>
<td><p>Float</p></td>
<td><p>0.0 to 1.0</p></td>
<td><p>0.25</p></td>
<td><p>Confidence score of
tracker to be
consider for tracking
objects</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id19">
<h4>Example Pipelines<a class="headerlink" href="#id19" title="Permalink to this heading">¶</a></h4>
<p>The following example demonstrates use of vvas_xtracker plug-in along with detection from ML at interval of 5.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=$1 ! \
h264parse ! queue ! \
omxh264dec internal-entropy-buffers=3 ! \
queue ! \
tee name=t t. ! \
queue ! \
vvas_xabrscaler xclbin-location=&quot;/media/sd-mmcblk0p1/dpu.xclbin&quot; kernel-name=v_multi_scaler:{v_multi_scaler_1} name=sc sc.src_0 ! \
queue ! \
videorate ! \
video/x-raw, framerate=6/1 ! \
queue ! \
vvas_xinfer preprocess-config=kernel_preprocessor_refinedet_pruned_0_96.json infer-config=kernel_refinedet_pruned_0_96.json name=infer ! \
queue ! \
mftrack1.sink_master vvas_xmetaaffixer name=mftrack1 mftrack1.src_master ! \
queue  ! \
fakesink sc.src_1 ! \
queue ! \
mftrack1.sink_slave_0 mftrack1.src_slave_0 ! \
queue ! \
vvas_xtracker tracker-algo=2 ! \
queue max-size-bytes=0 min-threshold-buffers=1 max-size-buffers=2 max-size-time=0 ! \
mftrack2.sink_master vvas_xmetaaffixer name=mftrack2 mftrack2.src_master ! \
queue  ! \
fakesink t. ! \
queue ! \
mftrack2.sink_slave_0 mftrack2.src_slave_0 ! \
queue ! \
vvas_xmetaconvert config-location=metaconvert.json ! \
queue ! \
vvas_xoverlay ! \
queue ! \
kmssink driver-name=&quot;xlnx&quot; fullscreen-overlay=1 sync=false -v
</pre></div>
</div>
</section>
</section>
<section id="vvas-xmetaconvert">
<span id="id20"></span><h3>vvas_xmetaconvert<a class="headerlink" href="#vvas-xmetaconvert" title="Permalink to this heading">¶</a></h3>
<p>GStreamer vvas_xmetaconvert plug-in converts VVAS ML inference metadata (GstInferenceMeta) into overlay metadata structure needed by vvas_overlay plug-in. Configuration parameters which are frequently used are added as plug-in properties as well (Ex: “font”, “font-size”, “thickness” etc).
For implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/gst/metaconvert">vvas_xmetaconvert source code</a></p>
<section id="json-file-for-vvas-xmetaconvert">
<h4>JSON File for vvas_xmetaconvert<a class="headerlink" href="#json-file-for-vvas-xmetaconvert" title="Permalink to this heading">¶</a></h4>
<p>This section describes the JSON file format and configuration parameters for the vvas_xmetaconvert plug-in.</p>
<p>The following example is of a JSON file to pass to the vvas_xmetaconvert.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;font_size&quot;</span> <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="s2">&quot;font&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;thickness&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;mask_level&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;label_color&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;blue&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="s2">&quot;y_offset&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;label_filter&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;probability&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;classes&quot;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span>
        <span class="s2">&quot;blue&quot;</span> <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
        <span class="s2">&quot;green&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;red&quot;</span>  <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;masking&quot;</span>  <span class="p">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;person&quot;</span><span class="p">,</span>
        <span class="s2">&quot;blue&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;green&quot;</span> <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
        <span class="s2">&quot;red&quot;</span>  <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;masking&quot;</span>  <span class="p">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bus&quot;</span><span class="p">,</span>
        <span class="s2">&quot;blue&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;green&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;red&quot;</span>  <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
        <span class="s2">&quot;masking&quot;</span>  <span class="p">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;blue&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;green&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;red&quot;</span>  <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
        <span class="s2">&quot;masking&quot;</span>  <span class="p">:</span> <span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Various configuration parameters used by vvas_xmetaconvert are described in the following table.</p>
<p>Table 9: vvas_xmetaconvert Parameters</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Expected Values</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>font</p></td>
<td><p>0 to 7</p></td>
<td><blockquote>
<div><p>Font for the
label text.</p>
</div></blockquote>
<p>0: Hershey Simplex</p>
<blockquote>
<div><p>1: Hershey Plain</p>
<p>2: Hershey Duplex</p>
<p>3: Hershey
Complex</p>
<p>4: Hershey
Triplex</p>
<p>5: Hershey
Complex Small 6:
Hershey Script
Simplex 7:
Hershey Script
Complex</p>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td><p>font_size</p></td>
<td><p>0.5 to 1</p></td>
<td><p>Font fraction
scale factor that
is multiplied by
the font-specific
base size.</p></td>
</tr>
<tr class="row-even"><td><p>thickness</p></td>
<td><p>Integer 1 to 3</p></td>
<td><p>The thickness of the
line that makes up
the rectangle.
Negative values,
like -1, signify
that the function
draws a filled
rectangle.</p>
<p>The recommended
value is between 1
and 3.</p>
</td>
</tr>
<tr class="row-odd"><td><p>mask_level</p></td>
<td><p>Integer</p></td>
<td><p>In case of cascaded
ML pipeline, user can
use this field to
mask out the results
of a particular
level.
All bounding boxes in
that level will be
masked with black
color.
When set to 0, none
of the levels are
masked</p></td>
</tr>
<tr class="row-even"><td><p>label_color</p></td>
<td><p>{ “blue” : 0,
“green” : 0,
“red” : 0 }</p></td>
<td><p>The color of the
label is specified.</p></td>
</tr>
<tr class="row-odd"><td><p>label_filter</p></td>
<td><p>[ “class”,
“probability” ]</p></td>
<td><p>This field indicates
that all information
printed is the label
string. Using
“class” alone adds
the ML
classification name.
For example, car,
person, etc.</p>
<p>The addition of
“probability” in the
array adds the
probability of a
positive object
identification.</p>
</td>
</tr>
<tr class="row-even"><td><p>y_offset</p></td>
<td><p>Integer 0 to height</p></td>
<td><p>‘y’ offset to be
added along height
for label in case of
classification model</p></td>
</tr>
<tr class="row-odd"><td><p>classes</p></td>
<td><p>{ “name” : “car”,</p>
<p>“blue” : 255,
“green” :</p>
<p>0, “red” : 0,
“masking” : 0 }</p>
</td>
<td><p>This is a filtering
option when using
the
vvas_xboundingbox.
The bounding box is
only drawn for the
classes that are
listed in this
configuration. Other
classes are ignored.
For instance, if
“car”, “person”,
“bicycle” is
entered under
“classes”, then the
bounding box is only
drawn for these
three classes, and
other classes like
horse, motorbike,
etc. are ignored.</p>
<p>The expected value
columns show an
example of how each
class should be
described. All
objects in this
example, by class,
are drawn using the
color combination
listed.</p>
<p>The class names in
this list matches the
class names assigned
by the
vvas_xdpuinfer.
Otherwise, the
bounding box is not
drawn.</p>
<p>“masking” flag can be
used to mask all
objects of a class
Set it to 1 for
enabling masking.
This flag will
override “mask_level”
field.
For instance, if
“mask_level” is set 1
and “masking” for
“car” is set 1 and if
level 1 has cars and
busses, then only
cars are masked not
the entire level.</p>
<p>For face detect,
keep the “classes”
array empty.</p>
</td>
</tr>
<tr class="row-even"><td><p>display_level</p></td>
<td><p>Integer 0 to N
0 =&gt; all levels
N =&gt; specific level</p></td>
<td><p>display bounding box
of one particular
level or all levels</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id21">
<h4>Example Pipelines<a class="headerlink" href="#id21" title="Permalink to this heading">¶</a></h4>
<p>The following example demonstrates use of vvas_xmetaconvert with vvas_overlay plug-in for drawing bounding boxes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=&quot;&lt;PATH&gt;/001.bgr&quot; blocksize=150528 numbuffers=1
! videoparse width=224 height=224 framerate=30/1 format=16
! vvas_xfilter name=&quot;kernel1&quot; kernels-config=&quot;&lt;PATH&gt;/kernel_resnet50.json&quot;
! vvas_xmetaconvert config-location=&quot;&lt;PATH&gt;/metaconvert.json&quot;
! vvas_overlay ! filesink location=output.bgr
</pre></div>
</div>
</section>
</section>
<section id="vvas-xfunnel">
<span id="id22"></span><h3>vvas_xfunnel<a class="headerlink" href="#vvas-xfunnel" title="Permalink to this heading">¶</a></h3>
<p>vvas_xfunnel gstreamer plug-in serializes data on its sink pads, it iterates all the sink pads in round robin order, if sink pad has buffer available; it sends it on the output pad, else the plug-in will wait for preset (user configurable) time, by that time also if data is not available the plug-in will skip that sink pad and it will probe next sink pad.</p>
<p>Whenever new sink pad is added to or removed from this plug-in, it sends custom events to notify <code class="docutils literal notranslate"><span class="pre">vvas_xdefunnel</span></code> to create or destroy source pads.
Metadata on each buffer is attached to enable <code class="docutils literal notranslate"><span class="pre">vvas_xdefunnel</span></code> plug-in to decide the source pad to which that buffer has to be sent.</p>
<p><code class="docutils literal notranslate"><span class="pre">vvas_xfunnel</span></code> supports all caps.</p>
<p>Refer <code class="docutils literal notranslate"><span class="pre">vvas_xdefunnel</span></code> plug-in which de-serializes these serialized data and pushes them to the output pads.
For <code class="docutils literal notranslate"><span class="pre">vvas_xfunnel</span></code> implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/gst/funnel">vvas_xfunnel source code</a></p>
<p>This plug-in supports:</p>
<ul class="simple">
<li><p>Multiple input, single output pad</p></li>
<li><p>Sink pads are request pads and they can be added or removed dynamically.</p></li>
<li><p>Serialization of parallel data using round robin algorithm</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Caps of all the sink pads must be same, this is to avoid caps renegotiation always when sending buffer from the sink pad which has different caps.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>There are several custom events sent from this plugin for <code class="docutils literal notranslate"><span class="pre">vvas_xdefunnel</span></code> plug-in, intermediate plug-ins must pass these events.</p>
</div>
<section id="id23">
<h4>Control Parameters and Plug-in Properties<a class="headerlink" href="#id23" title="Permalink to this heading">¶</a></h4>
<p>The following table lists the GStreamer plug-in properties supported by the vvas_xfunnel plug-in.</p>
<p>Table 10: vvas_xfunnel Plug-in Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 15%" />
<col style="width: 18%" />
<col style="width: 17%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>queue-size</p></td>
<td><p>unsigned
integer</p></td>
<td><p>1 - 100</p></td>
<td><p>2</p></td>
<td><p>queue size for
each sink pad</p></td>
</tr>
<tr class="row-odd"><td><p>sink-wait-timeout</p></td>
<td><p>unsigned
integer</p></td>
<td><p>1 - 100</p></td>
<td><p>33</p></td>
<td><p>Time to wait before
switching to next
sink pad in mili
seconds, default
will be calculated
as 1/FPS</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id24">
<h4>Example Pipelines<a class="headerlink" href="#id24" title="Permalink to this heading">¶</a></h4>
<p>The pipeline mentioned below is using vvass_xvcudec and vvas_xvcuenc plug-ins that is supported on PCIe/Data center platform. To execute the similar pipeline on Embedded platform, use the decoder and encoder plug-ins supported on Embedded platform. For details, refer to <a class="reference internal" href="../Embedded/embedded-plugins.html#omx-encoder-decoder"><span class="std std-ref">OMX Encoder/Decoder Plug-in</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 \
filesrc location= video1.h264 ! h264parse ! vvas_xvcudec  dev-idx=0 ! fun.sink_0 \
filesrc location= video2.h264 ! h264parse ! vvas_xvcudec  dev-idx=0 ! fun.sink_1 \
filesrc location= video3.h264 ! h264parse ! vvas_xvcudec  dev-idx=0 ! fun.sink_2 \
vvas_xfunnel name=fun ! identity silent=false ! vvas_xdefunnel name=def \
def.src_0 ! queue ! vvas_xvcuenc  dev-idx=0 ! h264parse ! filesink async=false sync=false location= out1.h264 \
def.src_1 ! queue ! vvas_xvcuenc  dev-idx=0 ! h264parse ! filesink async=false sync=false location= out1.h264 \
def.src_2 ! queue ! vvas_xvcuenc  dev-idx=0 ! h264parse ! filesink async=false sync=false location= out1.h264 -v
</pre></div>
</div>
</section>
</section>
<section id="vvas-xdefunnel">
<span id="id25"></span><h3>vvas_xdefunnel<a class="headerlink" href="#vvas-xdefunnel" title="Permalink to this heading">¶</a></h3>
<p>vvas_xdefunnel gstreamer plug-in de-serializes data coming from <code class="docutils literal notranslate"><span class="pre">vvas_xfunnel</span></code> plug-in.
This plug-in creates and destroys source pads based on the events from the <code class="docutils literal notranslate"><span class="pre">vvas_xfunnel</span></code> plug-in.
For <code class="docutils literal notranslate"><span class="pre">vvas_xdefunnel</span></code> implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/gst/defunnel">vvas_xdefunnel source code</a></p>
<p>This plug-in supports:</p>
<ul class="simple">
<li><p>Single input, multiple output pad</p></li>
<li><p>Source pads are sometimes pad.</p></li>
<li><p>Source pads can be added and removed dynamically.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">vvas_xdefunnel</span></code> supports all caps.</p>
<section id="control-parameters-and-plug-in-signals">
<h4>Control Parameters and Plug-in Signals<a class="headerlink" href="#control-parameters-and-plug-in-signals" title="Permalink to this heading">¶</a></h4>
<p>The following table lists the GStreamer plug-in signals supported by the vvas_xdefunnel plug-in.</p>
<p>Table 11: vvas_xdefunnel Plug-in signals</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 30%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Signal Name</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
<th class="head"><p><strong>callback</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>pad-added</p></td>
<td><p>This signal will be
emitted when new source
pad is created.</p></td>
<td><p>void user_function (GstElement* object,
GstPad* arg0, gpointer user_data);</p></td>
</tr>
<tr class="row-odd"><td><p>pad-removed</p></td>
<td><p>This signal will be
emitted when a source
pad is removed.</p></td>
<td><p>void user_function (GstElement* object,
GstPad* arg0, gpointer user_data);</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="id26">
<h4>Example Pipelines<a class="headerlink" href="#id26" title="Permalink to this heading">¶</a></h4>
<p>The pipeline mentioned below is using vvass_xvcudec and vvas_xvcuenc plug-ins that is supported on PCIe/Data center platform. To execute the similar pipeline on Embedded platform, use the decoder and encoder plug-ins supported on Embedded platform. For details, refer to <a class="reference internal" href="../Embedded/embedded-plugins.html#omx-encoder-decoder"><span class="std std-ref">OMX Encoder/Decoder Plug-in</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 \
filesrc location= video1.h264 ! h264parse ! vvas_xvcudec  dev-idx=0 ! fun.sink_0 \
filesrc location= video2.h264 ! h264parse ! vvas_xvcudec  dev-idx=0 ! fun.sink_1 \
filesrc location= video3.h264 ! h264parse ! vvas_xvcudec  dev-idx=0 ! fun.sink_2 \
vvas_xfunnel name=fun ! identity silent=false ! vvas_xdefunnel name=def \
def.src_0 ! queue ! vvas_xvcuenc  dev-idx=0 ! h264parse ! filesink async=false sync=false location= out1.h264 \
def.src_1 ! queue ! vvas_xvcuenc  dev-idx=0 ! h264parse ! filesink async=false sync=false location= out1.h264 \
def.src_2 ! queue ! vvas_xvcuenc  dev-idx=0 ! h264parse ! filesink async=false sync=false location= out1.h264 -v
</pre></div>
</div>
</section>
</section>
<section id="vvas-xmulticrop">
<span id="id27"></span><h3>vvas_xmulticrop<a class="headerlink" href="#vvas-xmulticrop" title="Permalink to this heading">¶</a></h3>
<p>In ML applications we often need to crop the video frame for processing objects and number of objects per frame may differ. For ML we may also need preprocessing.</p>
<p><cite>vvas_xmulticrop</cite> is a Gstreamer plug-in to do scaling, color space conversion, preprocessing and to crop single or multiple objects.
It takes one input frame and can crop one or more objects from it. Scaling, color space conversion and preprocessing can be applied to all the cropped objects/buffers.
If user wants to get cropped buffer directly on the output pad, he can use static cropping, but with static cropping user can crop only one object.
If user wants to crop more than one objects, s/he must go with dynamic cropping, dynamically cropped objects/buffers will not be sent onto the output pad, they will be attached as metadata into the output buffer.
Both static and dynamic cropping can be performed simultaneously.</p>
<p>For more implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/sys/multicrop">vvas_xmulticrop source code</a>.</p>
<p>This plug-in supports:</p>
<ul class="simple">
<li><p>Single input, single output pad</p></li>
<li><p>Color space conversion</p></li>
<li><p>Resize</p></li>
<li><p>Pre-processing</p></li>
<li><p>Static and Dynamic cropping</p></li>
</ul>
<p>vvas_xmulticrop plug-in is similar to <code class="docutils literal notranslate"><span class="pre">vvas_xabrscaler</span></code> excepts below features:</p>
<ul class="simple">
<li><p>It has only one output pad</p></li>
<li><p>It supports dynamic cropping.</p></li>
</ul>
<p>Static Cropping: For cropping only one object. The cropped object/buffer will be sent to the output pad. <cite>s-crop-x</cite>, <cite>s-crop-y</cite>, <cite>s-crop-width</cite>, <cite>s-crop-height</cite> are the properties to set the crop parameters.</p>
<p>Dynamic Cropping: For cropping more than one objects from the input buffer. To use dynamic crop feature user must send crop coordinates attached to the buffer in GstVideoRegionOfInterestMeta metadata and GstVideoRegionOfInterestMeta-&gt;roi_type must be set to “roi-crop-meta”. One instance of GstVideoRegionOfInterestMeta in buffer represents one object for dynamic crop. <cite>vvas_xmulticrop</cite> will dynamically crop the object and attach the cropped objects/buffers to output buffer in GstVideoRegionOfInterestMeta-&gt;params. GstVideoRegionOfInterestMeta-&gt;params is a GList * of GstStructure. Dynamically cropped buffer is attached into this field, The name of GstStructure is “roi-buffer”, and this GstStructure has only one field “sub-buffer” of type GST_TYPE_BUFFER. User should extract this cropped buffer use it and unref it.
User can choose to resize these cropped buffers to one width and height by setting <cite>d-height</cite> and <cite>d-width</cite> properties. If these properties are not set, then cropped buffers will not be resized.</p>
<p>If user wants cropped buffers to be of different format than the input format, he can specify this by setting <cite>d-format</cite> gstreamer property. If this property is not set all cropped buffers will have format same as input buffer.</p>
<p>User specified pre-processing will be applied to dynamically cropped buffers only, if user wants it to be applied on output buffer/static crop buffers also, he can set <cite>ppe-on-main buffer</cite> gstreamer property.</p>
<p>Static and dynamic cropping both is possible simultaneously. As explained statically cropped buffer will be sent on the output pad and dynamically cropped buffers will be attached into that output buffer.</p>
<p><cite>vvas_xmulticrop</cite> supports at max 39 dynamic crops.
Memory for dynamically cropped buffers is allocated from a Gstreamer buffer pool, there is no upper limit on this buffer pool. So, if buffers are not freed, new buffers will be allocated which may lead to more memory consumption.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <cite>vvas_xmulticrop</cite> plug-in controls the multiscaler kernel. If your application uses this plug-in, then make sure that multi-scaler kernel is included in your hardware design.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure that the multi-scaler hardware kernel supports maximum resolution required by your application.</p>
</div>
<p>As a reference, maximum resolution supported by multi-scaler kernel in <code class="docutils literal notranslate"><span class="pre">Smart</span> <span class="pre">Model</span> <span class="pre">Select</span></code> example design can be found in  <a class="reference external" href="https://github.com/Xilinx/VVAS/blob/master/vvas-examples/Embedded/smart_model_select/v_multi_scaler_user_config.h#L33">multi-scaler kernel config</a></p>
<section id="id29">
<h4>Prerequisite<a class="headerlink" href="#id29" title="Permalink to this heading">¶</a></h4>
<p>This plug-in requires the multiscaler kernel to be available in the hardware design. See <a class="reference internal" href="Acceleration-Hardware.html#multiscaler-kernel"><span class="std std-ref">Multiscaler Kernel</span></a></p>
</section>
<section id="id30">
<h4>Input and Output<a class="headerlink" href="#id30" title="Permalink to this heading">¶</a></h4>
<p>This plug-in accepts buffers with the following color format standards:</p>
<ul class="simple">
<li><p>RGBx</p></li>
<li><p>YUY2</p></li>
<li><p>r210</p></li>
<li><p>Y410</p></li>
<li><p>NV16</p></li>
<li><p>NV12</p></li>
<li><p>RGB</p></li>
<li><p>v308</p></li>
<li><p>I422_10LE</p></li>
<li><p>GRAY8</p></li>
<li><p>NV12_10LE32</p></li>
<li><p>BGRx</p></li>
<li><p>GRAY10_LE32</p></li>
<li><p>BGRx</p></li>
<li><p>UYVY</p></li>
<li><p>BGR</p></li>
<li><p>RGBA</p></li>
<li><p>BGRA</p></li>
<li><p>I420</p></li>
<li><p>GBR</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure that the color formats needed for your application are supported by the multi-scaler hardware kernel.</p>
</div>
<p>As a reference, multi-scaler configuration for <code class="docutils literal notranslate"><span class="pre">smart</span> <span class="pre">model</span> <span class="pre">select</span></code> example design can be found in <a class="reference external" href="https://github.com/Xilinx/VVAS/blob/master/vvas-examples/Embedded/smart_model_select/v_multi_scaler_user_config.h">multi-scaler configuration</a></p>
</section>
<section id="id32">
<h4>Control Parameters and Plug-in Properties<a class="headerlink" href="#id32" title="Permalink to this heading">¶</a></h4>
<p>The following table lists the GStreamer plug-in properties supported by the vvas_xmulticrop plug-in.</p>
<p>Table 12: vvas_xmulticrop Plug-in Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 15%" />
<col style="width: 16%" />
<col style="width: 26%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>avoid-output-copy</p></td>
<td><p>Boolean</p></td>
<td><p>true/false</p></td>
<td><p>False</p></td>
<td><p>Avoid output
frames copy even
when downstream
does not support
GstVideoMeta
metadata</p></td>
</tr>
<tr class="row-odd"><td><p>enable-pipeline</p></td>
<td><p>Boolean</p></td>
<td><p>true/false</p></td>
<td><p>false</p></td>
<td><p>Enable buffer
pipelining to
improve
performance in
non zero-copy
use cases</p></td>
</tr>
<tr class="row-even"><td><p>in-mem-bank</p></td>
<td><p>Unsigned int</p></td>
<td><p>0 - 65535</p></td>
<td><p>0</p></td>
<td><p>VVAS input memory
bank to allocate
memory</p></td>
</tr>
<tr class="row-odd"><td><p>out-mem-bank</p></td>
<td><p>Unsigned int</p></td>
<td><p>0 - 65535</p></td>
<td><p>0</p></td>
<td><p>VVAS o/p memory
bank to allocate
memory</p></td>
</tr>
<tr class="row-even"><td><p>xclbin-location</p></td>
<td><p>string</p></td>
<td><p>N/A</p></td>
<td><p>./binary_container_1
xclbin</p></td>
<td><p>The
location of
xclbin.</p></td>
</tr>
<tr class="row-odd"><td><p>kernel-name</p></td>
<td><p>string</p></td>
<td><p>N/A</p></td>
<td><p>v_multi_scaler:
multi_scaler_1</p></td>
<td><p>Kernel name
and
instance
separated
by a colon.</p></td>
</tr>
<tr class="row-even"><td><p>dev-idx</p></td>
<td><p>integer</p></td>
<td><p>0 to 31</p></td>
<td><p>0</p></td>
<td><p>Device index
This is valid
only in PCIe/
Data Center
platforms.</p></td>
</tr>
<tr class="row-odd"><td><p>ppc</p></td>
<td><p>integer</p></td>
<td><p>1, 2, 4</p></td>
<td><p>2</p></td>
<td><p>Pixel per
clock
supported
by a multi-
scaler
kernel</p></td>
</tr>
<tr class="row-even"><td><p>scale-mode</p></td>
<td><p>integer</p></td>
<td><p>0, 1, 2</p></td>
<td><p>0</p></td>
<td><p>Scale algorithm
to use:
0:BILINEAR
1:BICUBIC
2:POLYPHASE</p></td>
</tr>
<tr class="row-odd"><td><p>coef-load-type</p></td>
<td><p>integer</p></td>
<td><p>0 =&gt; Fixed
1 =&gt; Auto</p></td>
<td><p>1</p></td>
<td><p>Type of filter
Coefficients to
be used: Fixed
or Auto
generated</p></td>
</tr>
<tr class="row-even"><td><p>num-taps</p></td>
<td><p>integer</p></td>
<td><p>6=&gt;6 taps
8=&gt;8 taps
10=&gt;10 taps
12=&gt;12 taps</p></td>
<td><p>1</p></td>
<td><p>Number of filter
taps to be used
for scaling</p></td>
</tr>
<tr class="row-odd"><td><p>alpha-b</p></td>
<td><p>float</p></td>
<td><p>0 to 128</p></td>
<td><p>0</p></td>
<td><p>Mean subtraction
for blue channel
, needed only if
PPE is required</p></td>
</tr>
<tr class="row-even"><td><p>alpha-g</p></td>
<td><p>float</p></td>
<td><p>0 to 128</p></td>
<td><p>0</p></td>
<td><p>Mean subtraction
for green channel
, needed only if
PPE is required</p></td>
</tr>
<tr class="row-odd"><td><p>alpha-r</p></td>
<td><p>float</p></td>
<td><p>0 to 128</p></td>
<td><p>0</p></td>
<td><p>Mean subtraction
for red  channel
, needed only if
PPE is required</p></td>
</tr>
<tr class="row-even"><td><p>beta-b</p></td>
<td><p>float</p></td>
<td><p>0 to 1</p></td>
<td><p>1</p></td>
<td><p>Scaling for blue
channel, needed
only if PPE is
required</p></td>
</tr>
<tr class="row-odd"><td><p>beta-g</p></td>
<td><p>float</p></td>
<td><p>0 to 1</p></td>
<td><p>1</p></td>
<td><p>scaling for green
channel, needed
only if PPE is
required</p></td>
</tr>
<tr class="row-even"><td><p>beta-r</p></td>
<td><p>float</p></td>
<td><p>0 to 1</p></td>
<td><p>1</p></td>
<td><p>scaling for red
channel, needed
only if PPE is
required</p></td>
</tr>
<tr class="row-odd"><td><p>s-crop-x</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Crop X coordinate
for static
cropping</p></td>
</tr>
<tr class="row-even"><td><p>s-crop-y</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Crop Y coordinate
for static
cropping</p></td>
</tr>
<tr class="row-odd"><td><p>s-crop-width</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Crop width for
static cropping
(minimum: 64),
when this is 0
or not set, it
will be
calculated as
input width -
<cite>s-crop-x</cite></p></td>
</tr>
<tr class="row-even"><td><p>s-crop-height</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Crop height for
static cropping
(minimum: 64),
when this is 0
or not set, it
will be
calculated as
input height -
<cite>s-crop-y</cite></p></td>
</tr>
<tr class="row-odd"><td><p>d-width</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Width of
dynamically
cropped buffers</p></td>
</tr>
<tr class="row-even"><td><p>d-height</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Height of
dynamically
cropped buffers</p></td>
</tr>
<tr class="row-odd"><td><p>d-format</p></td>
<td><p>integer</p></td>
<td><p>0,2,4,5,7,8,
11,12,15,16,
23,25,41,45,
48,51,78,79,
83</p></td>
<td><p>0</p></td>
<td><p>Format of
dynamically
cropped buffers</p></td>
</tr>
<tr class="row-even"><td><p>ppe-on-main-buffer</p></td>
<td><p>boolean</p></td>
<td><p>true/false</p></td>
<td><p>0</p></td>
<td><p>Apply pre-
processing on
main buffer also</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MultiScaler IP has some alignment requirement, hence user given parameters for crop are aligned as per the IP requirement, alignment ensures that it covers the region of crop specified by user, hence final cropped image may have extra pixels cropped. Crop width and height must be at least 64.</p>
</div>
</section>
<section id="id33">
<h4>Example Pipelines<a class="headerlink" href="#id33" title="Permalink to this heading">¶</a></h4>
<p>The pipeline mentioned below is for PCIe/Data Center platform. In case you want to execute this pipeline on Embedded platform, then remove <strong>dev-idx</strong> property in the pipelines mentioned below.</p>
<ul class="simple">
<li><p>Below pipeline converts NV12 to RGB and performs scaling from 1920x1080 to 640x480. The pipeline mentioned below is for PCIe/Data Center platform.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 -v \
videotestsrc num-buffers=10 ! video/x-raw,format=NV12,width=1920,height=1080 \
! vvas_xmulticrop dev-idx=0 \
! video/x-raw,format=RGB,width=640,height=480 ! filesink location=out.yuv
</pre></div>
</div>
<ul class="simple">
<li><p>Below pipeline performs pre-processing along with color space conversion and scaling on output buffers</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 -v \
videotestsrc num-buffers=10 ! video/x-raw,format=NV12,width=1920,height=1080 \
! vvas_xmulticrop dev-idx=0 ppe-on-main-buffer=true alpha-r=124 alpha-g=116 alpha-b=104 beta-r=0.547 beta-g=0.56 beta-b=0.557 \
! video/x-raw,format=RGB,width=640,height=480 ! filesink location=out.yuv
</pre></div>
</div>
<ul class="simple">
<li><p>Below pipeline performs static cropping at (x,y) = (100,80) and (width,height)= (1280,720), this cropped buffers gets scaled to 640x480 and converted to RGB.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 -v \
videotestsrc num-buffers=10 ! video/x-raw,format=NV12,width=1920,height=1080 \
! vvas_xmulticrop dev-idx=0 s-crop-x=100 s-crop-y=80 s-crop-width=1280 s-crop-height=720 \
! video/x-raw,format=RGB,width=640,height=480 ! filesink location=out.yuv
</pre></div>
</div>
<ul class="simple">
<li><p>Below code shows how to add GstVideoRegionOfInterestMeta for dynamic cropping.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GstVideoRegionOfInterestMeta</span> <span class="o">*</span><span class="n">meta</span><span class="p">;</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">gst_buffer_add_video_region_of_interest_meta</span> <span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s2">&quot;roi-crop-meta&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">meta</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">p_id</span><span class="p">;</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span>  <span class="n">x</span><span class="p">;</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span>  <span class="n">y</span><span class="p">;</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;meta: x:</span><span class="si">%u</span><span class="s2"> y:</span><span class="si">%u</span><span class="s2">, w:</span><span class="si">%u</span><span class="s2"> h:</span><span class="si">%u</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span> <span class="n">meta</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">,</span> <span class="n">meta</span><span class="o">-&gt;</span><span class="n">w</span><span class="p">,</span> <span class="n">meta</span><span class="o">-&gt;</span><span class="n">h</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Below code shows how to read GstVideoRegionOfInterestMeta and how to extract dynamically cropped buffer/object</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">read_crop_meta</span> <span class="p">(</span><span class="n">GstBuffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">gpointer</span> <span class="n">state</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
  <span class="n">GstMeta</span> <span class="o">*</span><span class="n">_meta</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">((</span><span class="n">_meta</span> <span class="o">=</span> <span class="n">gst_buffer_iterate_meta_filtered</span> <span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="p">,</span>
              <span class="n">GST_VIDEO_REGION_OF_INTEREST_META_API_TYPE</span><span class="p">)))</span> <span class="p">{</span>
    <span class="n">GstStructure</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
    <span class="n">GstVideoRegionOfInterestMeta</span> <span class="o">*</span><span class="n">roi_meta</span> <span class="o">=</span>
                          <span class="p">(</span><span class="n">GstVideoRegionOfInterestMeta</span>  <span class="o">*</span><span class="p">)</span> <span class="n">_meta</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g_strcmp0</span><span class="p">(</span><span class="s2">&quot;roi-crop-meta&quot;</span><span class="p">,</span> <span class="n">g_quark_to_string</span> <span class="p">(</span><span class="n">roi_meta</span><span class="o">-&gt;</span><span class="n">roi_type</span><span class="p">)))</span> <span class="p">{</span>
      <span class="o">//</span><span class="n">This</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">the</span> <span class="n">metadata</span> <span class="n">we</span> <span class="n">are</span> <span class="n">looking</span> <span class="k">for</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">//</span><span class="n">Got</span> <span class="n">the</span> <span class="n">ROI</span> <span class="n">crop</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">prepare</span> <span class="n">output</span> <span class="n">buffer</span>
    <span class="o">//</span><span class="n">Extract</span> <span class="n">dynamically</span> <span class="n">cropped</span> <span class="n">buffer</span> <span class="kn">from</span> <span class="nn">this</span> <span class="n">meta</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">gst_video_region_of_interest_meta_get_param</span> <span class="p">(</span><span class="n">roi_meta</span><span class="p">,</span> <span class="s2">&quot;roi-buffer&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">GstBuffer</span> <span class="o">*</span><span class="n">sub_buffer</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
      <span class="n">gst_structure_get</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;sub-buffer&quot;</span><span class="p">,</span> <span class="n">GST_TYPE_BUFFER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sub_buffer</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sub_buffer</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span><span class="n">use</span> <span class="n">sub_buffer</span> <span class="ow">and</span> <span class="n">unref</span> <span class="n">it</span>
        <span class="n">dump_dynamically_cropped_buffer</span> <span class="p">(</span><span class="n">sub_buffer</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;couldn&#39;t get sub buffer&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;couldn&#39;t get expected struct&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Below code shows how to read/dump dynamically cropped buffers</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dump_dynamically_cropped_buffer (GstBuffer *sub_buffer) {
  /* Read GstVideoMeta from the buffer, dump the buffer to file */
  GstVideoMeta *vmeta = NULL;
  FILE *fp;
  GstMapInfo map = {0};
  gchar name[256] = {0};
  GstBuffer *new_outbuf;
  GstVideoFrame new_frame = { 0 }, out_frame = { 0 };
  GstVideoInfo *vinfo;

  if (!sub_buffer) {
    return FALSE;
  }

  vmeta = gst_buffer_get_video_meta (sub_buffer);
  if (!vmeta) {
    printf&quot;couldn&#39;t get video meta&quot;);
  }

  sprintf (name, &quot;dynbuf_%ux%u_%s.yuv&quot;, vmeta-&gt;width, vmeta-&gt;height,
                        gst_video_format_to_string (vmeta-&gt;format));
  fp = fopen (name, &quot;wb&quot;);
  if (!fp) {
    return FALSE;
  }

  vinfo = gst_video_info_new ();
  gst_video_info_set_format (vinfo, vmeta-&gt;format, vmeta-&gt;width, vmeta-&gt;height);

  new_outbuf = gst_buffer_new_and_alloc (GST_VIDEO_INFO_SIZE (vinfo));
  if (!new_outbuf) {
    printf(&quot;couldn&#39;t allocate buffer&quot;);
    gst_video_info_free (vinfo);
    fclose (fp);
    return FALSE;
  }

  gst_video_frame_map (&amp;out_frame, vinfo, sub_buffer, GST_MAP_READ);
  gst_video_frame_map (&amp;new_frame, vinfo, new_outbuf, GST_MAP_WRITE);
  gst_video_frame_copy (&amp;new_frame, &amp;out_frame);
  gst_video_frame_unmap (&amp;out_frame);
  gst_video_frame_unmap (&amp;new_frame);
  gst_video_info_free (vinfo);

  if (gst_buffer_map ( new_outbuf, &amp;map, GST_MAP_READ)) {
    fwrite (map.data, map.size, 1, fp);
  }
  gst_buffer_unmap (new_outbuf, &amp;map);
  gst_buffer_unref (new_outbuf);
  fclose (fp);
  gst_buffer_unref (sub_buffer);
  return TRUE;
}
</pre></div>
</div>
</section>
</section>
<section id="vvas-xcompositor">
<span id="id34"></span><h3>vvas_xcompositor<a class="headerlink" href="#vvas-xcompositor" title="Permalink to this heading">¶</a></h3>
<p>vvas_xcompositor is a hardware accelerated N input, 1 output Gstreamer plugin that combines two or more video frames into a single frame.
It can accept the below mentioned video formats. For each of the requested sink pads it will compare the incoming geometry and framerate to define the output parameters. Indeed, output video frames will have the geometry of the biggest incoming video stream and the framerate of the fastest incoming one.</p>
<p>In case input and output formats are different, then the color space conversion will be hardware accelerated by vvas_xcompositor.
For implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/sys/compositor">vvas_xcompositor source code</a></p>
<section id="id35">
<h4>Input and Output<a class="headerlink" href="#id35" title="Permalink to this heading">¶</a></h4>
<p>This plug-in accepts buffers with the following color format standards:</p>
<ul class="simple">
<li><p>RGBx</p></li>
<li><p>YUY2</p></li>
<li><p>r210</p></li>
<li><p>Y410</p></li>
<li><p>NV16</p></li>
<li><p>NV12</p></li>
<li><p>RGB</p></li>
<li><p>v308</p></li>
<li><p>I422_10LE</p></li>
<li><p>GRAY8</p></li>
<li><p>NV12_10LE32</p></li>
<li><p>BGRx</p></li>
<li><p>GRAY10_LE32</p></li>
<li><p>BGRx</p></li>
<li><p>UYVY</p></li>
<li><p>BGR</p></li>
<li><p>RGBA</p></li>
<li><p>BGRA</p></li>
<li><p>I420</p></li>
<li><p>GBR</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure that the color formats needed for your application are supported by the multi-scaler hardware kernel.</p>
</div>
<p>As a reference, multi-scaler configuration for <code class="docutils literal notranslate"><span class="pre">smart</span> <span class="pre">model</span> <span class="pre">select</span></code> example design can be found in <a class="reference external" href="https://github.com/Xilinx/VVAS/blob/master/vvas-examples/Embedded/smart_model_select/v_multi_scaler_user_config.h">multi-scaler configuration</a></p>
</section>
<section id="individual-parameters-for-each-input-stream-can-be-configured-on-the-gstcompositorpad">
<h4>Individual parameters for each input stream can be configured on the GstCompositorPad:<a class="headerlink" href="#individual-parameters-for-each-input-stream-can-be-configured-on-the-gstcompositorpad" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>“xpos”: The x-co-ordinate position of the top-left corner of the current frame in output buffer.</p></li>
<li><p>“ypos”: The y-co-ordinate position of the top-left corner of the current frame in output buffer.</p></li>
<li><p>“width”: The width of the current picture in the output buffer; If the input width and the width in output buffer are different, then hardware accelerated resize operation will be performed.</p></li>
<li><p>“height”: The height of the current picture in the output buffer; If the input height and the height in output buffer are different, then hardware accelerated resize operation will be performed.</p></li>
<li><p>“zorder”: The z-order position of the picture in the composition.</p></li>
</ul>
<figure class="align-default">
<img alt="../../_images/compositor.png" src="../../_images/compositor.png" />
</figure>
</section>
<section id="plugin-properties">
<h4>Plugin properties<a class="headerlink" href="#plugin-properties" title="Permalink to this heading">¶</a></h4>
<p>Table 13: vvas_xcompositor Plug-in Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 23%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>avoid-output-copy</p></td>
<td><p>Boolean</p></td>
<td><p>true or false</p></td>
<td><p>false</p></td>
<td><p>Avoid output frames
copy on all source
pads even when
downstream does not
support GstVideoMeta
metadata</p></td>
</tr>
<tr class="row-odd"><td><p>best-fit</p></td>
<td><p>Boolean</p></td>
<td><p>true or false</p></td>
<td><p>false</p></td>
<td><p>downscale/upscale
the input video to
best-fit in each
window</p></td>
</tr>
<tr class="row-even"><td><p>dev-idx</p></td>
<td><p>Integer</p></td>
<td><p>-1 to 31</p></td>
<td><p>-1</p></td>
<td><blockquote>
<div><p>Device index</p>
</div></blockquote>
<p>Valid only for PCIe/
ta Center platforms</p>
</td>
</tr>
<tr class="row-odd"><td><p>enable-pipeline</p></td>
<td><p>Boolean</p></td>
<td><p>true or false</p></td>
<td><p>false</p></td>
<td><p>Enable buffer
pipelining to
improve performance
in non zero-copy use
cases</p></td>
</tr>
<tr class="row-even"><td><p>in-mem-bank</p></td>
<td><p>Unsigned
Integer</p></td>
<td><p>0 - 65535</p></td>
<td><p>0</p></td>
<td><p>VVAS input memory
bank to allocate
memory</p></td>
</tr>
<tr class="row-odd"><td><p>out-mem-bank</p></td>
<td><p>Unsigned
Integer</p></td>
<td><p>0 - 65535</p></td>
<td><p>0</p></td>
<td><p>VVAS output memory
bank to allocate
memory</p></td>
</tr>
<tr class="row-even"><td><p>ppc</p></td>
<td><p>Integer</p></td>
<td><p>1, 2, 4</p></td>
<td><p>2</p></td>
<td><p>Pixel per clock
supported by a
multi-scaler kernel</p></td>
</tr>
<tr class="row-odd"><td><p>scale-mode</p></td>
<td><p>Integer</p></td>
<td><p>0, 1, 2</p></td>
<td><p>0</p></td>
<td><p>Scale algorithm
to use:
0:BILINEAR
1:BICUBIC
2:POLYPHASE</p></td>
</tr>
<tr class="row-even"><td><p>coef-load-type</p></td>
<td><p>Integer</p></td>
<td><p>0 =&gt; Fixed
1 =&gt; Auto</p></td>
<td><p>1</p></td>
<td><p>Type of filter
Coefficients to be
used: Fixed or Auto
generated</p></td>
</tr>
<tr class="row-odd"><td><p>num-taps</p></td>
<td><p>Integer</p></td>
<td><p>6=&gt;6 taps
8=&gt;8 taps
10=&gt;10 taps
12=&gt;12 taps</p></td>
<td><p>1</p></td>
<td><p>Number of filter
taps to be used for
scaling</p></td>
</tr>
<tr class="row-even"><td><p>kernel-name</p></td>
<td><p>String</p></td>
<td><p>NA</p></td>
<td><p>v_multi_scaler
:{v_multi_scaler_1}</p></td>
<td><p>String defining the
kernel name and
instance as
mentioned in xclbin</p></td>
</tr>
<tr class="row-odd"><td><p>xclbin-location</p></td>
<td><p>String</p></td>
<td><p>NA</p></td>
<td><p>NULL</p></td>
<td><p>Location of the
xclbin to program
devices</p></td>
</tr>
</tbody>
</table>
</section>
<section id="vvas-xcompositor-pad-properties">
<h4>vvas_xcompositor pad properties<a class="headerlink" href="#vvas-xcompositor-pad-properties" title="Permalink to this heading">¶</a></h4>
<p>Table 14: vvas_xcompositor Pad Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 23%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xpos</p></td>
<td><p>Unsigned
Integer</p></td>
<td><p>0 to
2147483647</p></td>
<td><p>0</p></td>
<td><p>The x-co-ordinate
position of the
top-left corner of
the current farme in
output buffer.</p></td>
</tr>
<tr class="row-odd"><td><p>ypos</p></td>
<td><p>Unsigned
Integer</p></td>
<td><p>0 to
2147483647</p></td>
<td><p>0</p></td>
<td><p>The y-co-ordinate
position of the
top-left corner of
the current farme in
output buffer.</p></td>
</tr>
<tr class="row-even"><td><p>height</p></td>
<td><p>Integer</p></td>
<td><p>-1 to
2147483647</p></td>
<td><p>-1</p></td>
<td><p>The height of the
current picture in
the output buffer;
If the input height
and the height in
output buffer are
different, then
hardware accelerated
resize operation
will be performed.
Setting default/-1
treats o/p height as
input height</p></td>
</tr>
<tr class="row-odd"><td><p>width</p></td>
<td><p>Integer</p></td>
<td><p>-1 to
2147483647</p></td>
<td><p>-1</p></td>
<td><p>The width of the
current picture in
the output buffer;
If the input width
and the width in
output buffer are
different, then
hardware accelerated
resize operation
will be performed.
Setting default/-1
treats o/p width  as
input width</p></td>
</tr>
<tr class="row-even"><td><p>zorder</p></td>
<td><p>Unsigned
Integer</p></td>
<td><p>-1 to 16</p></td>
<td><p>-1</p></td>
<td><p>The z-order positon
of the picture in
the composition.</p></td>
</tr>
</tbody>
</table>
<p>The example pipeline with vvas_xcompositor plug-in is as mentioned below.</p>
<p>The pipeline mentioned below is using <code class="docutils literal notranslate"><span class="pre">omxh264dec</span></code> plug-in and this plug-in is supported on embedded platforms only. For PCIe/Data center platform, use <code class="docutils literal notranslate"><span class="pre">vvas_xvcudec</span></code> plug-in.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#! /bin/bash

PAD_PROPERTIES=&quot;\
sink_0::xpos=0 sink_0::ypos=0 \
sink_1::xpos=1920 sink_1::ypos=0 \
sink_2::xpos=0 sink_2::ypos=1080 \
sink_3::xpos=1920 sink_3::ypos=1080 \
&quot;

gst-launch-1.0 -v  filesrc location=$1 !\
h264parse !\
omxh264dec !\
comp.sink_0 \
vvas_xcompositor xclbin-location=/usr/lib/dpu.xclbin $PAD_PROPERTIES name=comp !\
video/x-raw , width=3840, height=2160 , format=NV12  !\
queue !\
fpsdisplaysink video-sink=&quot;kmssink  bus-id=a0130000.v_mix async=true&quot; text-overlay=false sync=false \
filesrc location=$2 !\
h264parse !\
omxh264dec name=decoder_1 !\
queue !\
comp.sink_1 \
filesrc location=$3 !\
h264parse !\
omxh264dec !\
queue !\
comp.sink_2 \
filesrc location=$4 !\
h264parse !\
omxh264dec !\
queue !\
comp.sink_3
</pre></div>
</div>
</section>
</section>
</section>
<section id="infrastructure-plug-ins-and-acceleration-software-libraries">
<span id="infra-plugins-label"></span><h2>Infrastructure Plug-ins and Acceleration Software Libraries<a class="headerlink" href="#infrastructure-plug-ins-and-acceleration-software-libraries" title="Permalink to this heading">¶</a></h2>
<p>Infrastructure plug-ins are generic plug-ins that interact with the acceleration kernel through a set of APIs exposed by an acceleration software library corresponding to that kernel. Infrastructure plug-ins abstract the core/common functionality of the GStreamer framework (for example: caps negotiation and buffer management).</p>
<p>Table 15: Infrastructure Plug-ins</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 54%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Infrastructure Plug-ins</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>vvas_xfilter</p></td>
<td><p>Plug-in has one input, one output
Support Transform, passthrough
and inplace transform operations</p></td>
</tr>
<tr class="row-odd"><td><p>vvas_xmultisrc</p></td>
<td><p>Plug-in support one input and
multiple output pads.
Support transform operation</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Though one input and one output kernel can be integrated using any of the two infrastructure plug-ins, we recommend using vvas_xfilter plugin for one input and one output kernels.</p>
</div>
<p>Acceleration software libraries control the acceleration kernel, like register programming, or any other core logic required to implement the functions. Acceleration software libraries expose a simplified interface that is called by the GStreamer infrastructure plug-ins to interact with the acceleration kernel. The following table lists the acceleration software libraries developed to implement specific functionality. These libraries are used with one of the infrastructure plug-ins to use the functionality a GStreamer-based application. Example pipelines with GStreamer infrastructure plug-ins and acceleration software libraries are covered later in this section.</p>
<p>Table 16: Acceleration Software Libraries</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 54%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Acceleration Software Library</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>vvas_xdpuinfer</p></td>
<td><p>Library based on Vitis AI to
control DPU kernels for
machine learning.</p></td>
</tr>
<tr class="row-odd"><td><p>vvas_xboundingbox</p></td>
<td><p>Library to draw a bounding
box and labels on the frame
using OpenCV.</p></td>
</tr>
</tbody>
</table>
<p>GStreamer infrastructure plug-ins are available in the <code class="docutils literal notranslate"><span class="pre">vvas-gst-plugins</span></code> folder in the vvas source code tree. The following section describes each infrastructure plug-in.</p>
<section id="vvas-xfilter">
<span id="id37"></span><h3>vvas_xfilter<a class="headerlink" href="#vvas-xfilter" title="Permalink to this heading">¶</a></h3>
<p>The GStreamer vvas_xfilter is an infrastructure plug-in that is derived from GstBaseTransform. It supports one input pad and one output pad. The vvas_xfilter efficiently works with hard-kernel/soft-kernel/software (user-space) acceleration software library types as shown in the following figure.</p>
<figure class="align-default">
<img alt="../../_images/image8.png" src="../../_images/image8.png" />
</figure>
<p>This plug-in can operate in the following three modes.</p>
<ul class="simple">
<li><p><strong>Passthrough:</strong> Useful when the acceleration software library does not need to alter the input buffer.</p></li>
<li><p><strong>In-place:</strong> Useful when the acceleration software library needs to alter the input buffer.</p></li>
<li><p><strong>Transform:</strong> In this mode, for each input buffer, a new output buffer is produced.</p></li>
</ul>
<p>You must set the mode using the JSON file. Refer to <a class="reference internal" href="JSON-File-Schema.html"><span class="doc">JSON File Schema</span></a> for information related to the kernels-config property.</p>
<figure class="align-default">
<img alt="../../_images/image9.png" src="../../_images/image9.png" />
</figure>
<p>The vvas_xfilter plug-in takes configuration file as one of the input properties, kernels- config. This configuration file is in JSON format and contains information required by the kernel. During initialization, the vvas_xfilter parses the JSON file and performs the following tasks:</p>
<ul class="simple">
<li><p>Finds the VVAS acceleration software library in the path and loads the shared library.</p></li>
<li><p>Understands the acceleration software library type and prepares the acceleration software library handle (VVASKernel) to be passed to the core APIs.</p></li>
</ul>
<section id="id38">
<h4>Input and Output<a class="headerlink" href="#id38" title="Permalink to this heading">¶</a></h4>
<p>The vvas_xfilter accepts the buffers with the following color formats on input GstPad and output GstPad.</p>
<ul class="simple">
<li><p>GRAY8</p></li>
<li><p>NV12</p></li>
<li><p>BGR</p></li>
<li><p>RGB</p></li>
<li><p>YUY2</p></li>
<li><p>r210</p></li>
<li><p>v308</p></li>
<li><p>GRAY10_LE32</p></li>
<li><p>ABGR</p></li>
<li><p>ARGB</p></li>
</ul>
<p>The formats listed are the Xilinx IP supported color formats. To add other color formats, update the vvas_kernel.h and vvas_xfilter plug-ins.</p>
</section>
<section id="id39">
<h4>Control Parameters and Plug-in Properties<a class="headerlink" href="#id39" title="Permalink to this heading">¶</a></h4>
<p>The following table lists the GObject properties exposed by the vvas_xfilter. Most of them are only available in PCIe based platforms.</p>
<p>Table 17: GObject Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 22%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 10%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Platforms Supported</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>dynamic-config</p></td>
<td><p>PCIe and Embedded</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>Null</p></td>
<td><p>JSON formatted string contains kernel
specific configuration for run time changes</p></td>
</tr>
<tr class="row-odd"><td><p>dev-idx</p></td>
<td><p>PCIe only</p></td>
<td><p>Integer</p></td>
<td><p>0 to 31</p></td>
<td><p>0</p></td>
<td><p>Device used for kernel processing,
xclbin download.</p></td>
</tr>
<tr class="row-even"><td><p>kernels-config</p></td>
<td><p>PCIe and Embedded</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>NULL</p></td>
<td><p>JSON configuration file path based on VVAS
acceleration software library requirements.
Refer to the <a class="reference internal" href="JSON-File-Schema.html"><span class="doc">JSON File Schema</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>sk-cur-idx</p></td>
<td><p>PCIe only</p></td>
<td><p>Integer</p></td>
<td><p>0 to 31</p></td>
<td><p>0</p></td>
<td><p>Softkernel current index to be used for
executing job on device.</p></td>
</tr>
<tr class="row-even"><td><p>reservation-id</p></td>
<td><p>PCIe only</p></td>
<td><p>Integer</p></td>
<td><p>0 to 1024</p></td>
<td><p>0</p></td>
<td><p>Reservation ID provided by the Xilinx
resource manager (XRM).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="json-format-for-vvas-xfilter-plug-in">
<h4>JSON Format for vvas_xfilter Plug-in<a class="headerlink" href="#json-format-for-vvas-xfilter-plug-in" title="Permalink to this heading">¶</a></h4>
<p>The following table provides the JSON keys accepted by the GStreamer vvas_xfilter plug-in.</p>
<p>Table 18: Root JSON Object Members</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 28%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>JSON Key</strong></p></th>
<th class="head"><p><strong>Item</strong></p></th>
<th class="head"><p><strong>Item Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xclbin-location</p></td>
<td><p>Description</p></td>
<td><p>The location of
the xclbin that
is used to
program the FPGA
device.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Mandatory or
optional</p></td>
<td><p>Conditionally
mandatory:</p>
<ul class="simple">
<li><p>If the VVAS
acceleration
software
library is
developed for
hard-kernel IP
and
soft-kernel,
then the
xclbin-location
is mandatory.</p></li>
<li><p>If the VVAS
acceleration
software
library is
developed for
a software
library (e.g.,
OpenCV), then
the xclbin-location
is not required</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Default value</p></td>
<td><p>NULL</p></td>
</tr>
<tr class="row-even"><td><p>vvas-library-repo</p></td>
<td><p>Description</p></td>
<td><p>This is the VVAS
libraries repository
path to look for
acceleration
software libraries
by the VVAS
GStreamer plug-in.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Mandatory or
optional</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Default value</p></td>
<td><p>/usr/lib</p></td>
</tr>
<tr class="row-even"><td><p>element-mode</p></td>
<td><p>Description</p></td>
<td><p>GStreamer element
mode to operate.
Based on your
requirement, choose
one of the following
modes:</p>
<ol class="arabic simple">
<li><p>Passthrough: In
this mode,
element does
not want to
alter the
input buffer.</p></li>
<li><p>Inplace: In this
mode, element
wants to alter
the input
buffer itself
instead of
producing new
output
buffers.</p></li>
<li><p>Transform: In
this mode,
element
produces a
output buffer
for each input
buffer.</p></li>
</ol>
</td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Value type</p></td>
<td><p>Enum</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Mandatory or
optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-odd"><td><p>kernels</p></td>
<td><p>Description</p></td>
<td><p>This is the array of
kernel objects. Each
kernel object
provides information
about an VVAS
acceleration
software library
configuration. The
vvas_xfilter only
takes the first
kernel object in the
kernel array.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Value type</p></td>
<td><p>Array of objects</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Mandatory or
optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Default value</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Minimum value</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Maximum value</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Object members</p></td>
<td><p>Refer to <a class="reference internal" href="#kernel-json-object"><span class="std std-ref">Kernel JSON Object</span></a></p></td>
</tr>
</tbody>
</table>
<p>The information in the following table is specific to the kernel chosen.</p>
<p id="kernel-json-object">Table 19: Kernel JSON Object Members</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>JSON Key</strong></p></th>
<th class="head"><p><strong>Item</strong></p></th>
<th class="head"><p><strong>Item Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>library-name</p></td>
<td><p>Description</p></td>
<td><p>The name of the VVAS
acceleration
software library to
be loaded by the
VVAS GStreamer
plug-ins. The
absolute path of the
kernel library is
formed by the
pre-pending
vvas-library-repo
path.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Mandatory or
optional</p></td>
<td><p>Mandatory</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Default value</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>kernel-name</p></td>
<td><p>Description</p></td>
<td><p>The name of the
IP/kernel in the
form of &lt;kernel
name&gt;:&lt;instance
name&gt;</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Mandatory or
optional</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Default value</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>kernel-access-mode</p></td>
<td><p>Description</p></td>
<td><p>Mode in which IP/Kernel
is to be accessed.
“shared” or “exclusive”</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Value type</p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Mandatory or
optional</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Default value</p></td>
<td><p>“shared”</p></td>
</tr>
<tr class="row-even"><td><p>config</p></td>
<td><p>Description</p></td>
<td><p>Holds the
configuration
specific to the VVAS
acceleration
software library.
VVAS GStreamer
plug-ins do not
parse this JSON
object, instead it
is sent to the
acceleration
software library.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Value type</p></td>
<td><p>Object</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Mandatory or
optional</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Default value</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>softkernel</p></td>
<td><p>Description</p></td>
<td><p>Contains the
information specific
to the soft-kernel.
This JSON object is
valid only for the
PCIe based
platforms.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Value type</p></td>
<td><p>Object</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Mandatory or
optional</p></td>
<td><p>Mandatory if kernel
library is written
for soft-kernel.</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Default value</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Members</p></td>
<td><p>Not required for
embedded platforms.</p></td>
</tr>
</tbody>
</table>
<p>For <code class="docutils literal notranslate"><span class="pre">vvas_xfilter</span></code> implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/sys/filter">vvas_xfilter source code</a></p>
</section>
<section id="example-json-configuration-files">
<h4>Example JSON Configuration Files<a class="headerlink" href="#example-json-configuration-files" title="Permalink to this heading">¶</a></h4>
<section id="json-file-for-vvas-xdpuinfer-library">
<h5>JSON File for vvas_xdpuinfer library<a class="headerlink" href="#json-file-for-vvas-xdpuinfer-library" title="Permalink to this heading">¶</a></h5>
<p>The following JSON file is for pure software-based acceleration, it does not involve any kernel for acceleration. However, the Vitis AI API based DPU is a special case, where the DPU hardware kernel is controlled by Vitis AI. The acceleration software library calls the Vitis AI API calls and it is implemented as a pure software acceleration software library. There is no need to provide the path of the xclbin in the JSON file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;vvas-library-repo&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/lib/&quot;</span><span class="p">,</span>
   <span class="s2">&quot;element-mode&quot;</span><span class="p">:</span><span class="s2">&quot;inplace&quot;</span><span class="p">,</span>
   <span class="s2">&quot;kernels&quot;</span> <span class="p">:[</span>
      <span class="p">{</span>
         <span class="s2">&quot;library-name&quot;</span><span class="p">:</span><span class="s2">&quot;libvvas_xdpuinfer.so&quot;</span><span class="p">,</span>
         <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model-name&quot;</span> <span class="p">:</span> <span class="s2">&quot;densebox_320_320&quot;</span><span class="p">,</span>
            <span class="s2">&quot;model-class&quot;</span> <span class="p">:</span> <span class="s2">&quot;FACEDETECT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;model-format&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="n">BGR</span><span class="s2">&quot;,</span>
            <span class="s2">&quot;model-path&quot;</span> <span class="p">:</span> <span class="s2">&quot;/usr/share/vitis_ai_library/models/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;run_time_model&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;need_preprocess&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;performance_test&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;max_num&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;prob_cutoff&quot;</span> <span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;debug_level&quot;</span> <span class="p">:</span> <span class="mi">1</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="json-file-for-a-hard-kernel">
<h5>JSON File for a Hard Kernel<a class="headerlink" href="#json-file-for-a-hard-kernel" title="Permalink to this heading">¶</a></h5>
<p>The following JSON file uses vvas_xfilter to control multi-scaler IP (hard-kernel). The acceleration software library accessing the register map is libvvas_xcrop.so.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;xclbin-location&quot;</span><span class="p">:</span><span class="s2">&quot;/usr/lib/dpu.xclbin&quot;</span><span class="p">,</span>
   <span class="s2">&quot;vvas-library-repo&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/lib/&quot;</span><span class="p">,</span>
   <span class="s2">&quot;element-mode&quot;</span><span class="p">:</span><span class="s2">&quot;passthrough&quot;</span><span class="p">,</span>
   <span class="s2">&quot;kernels&quot;</span> <span class="p">:[</span>
       <span class="p">{</span>
          <span class="s2">&quot;kernel-name&quot;</span><span class="p">:</span><span class="s2">&quot;v_multi_scaler:</span><span class="si">{v_multi_scaler_1}</span><span class="s2">&quot;</span><span class="p">,</span>
          <span class="s2">&quot;library-name&quot;</span><span class="p">:</span><span class="s2">&quot;libvvas_xcrop.so&quot;</span><span class="p">,</span>
          <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="p">}</span>
       <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id40">
<h4>Example Pipelines<a class="headerlink" href="#id40" title="Permalink to this heading">¶</a></h4>
<p>This section covers the GStreamer example pipelines using the <code class="docutils literal notranslate"><span class="pre">vvas_xfilter</span></code> infrastructure plug-in and several acceleration software libraries. This section covers the bounding box functionality and the machine learning functions using the vvas_xfilter plug-in.</p>
<ul class="simple">
<li><p>The bounding box functionality is implemented in the <code class="docutils literal notranslate"><span class="pre">vvas_xboundingbox</span></code> acceleration software library that is controlled by the <code class="docutils literal notranslate"><span class="pre">vvas_xfilter</span></code> plug-in.</p></li>
<li><p>Machine learning using the DPU is implemented by the <code class="docutils literal notranslate"><span class="pre">vvas_xdpuinfer</span></code> acceleration software library that is called by the <code class="docutils literal notranslate"><span class="pre">vvas_xfilter</span></code> plug-in.</p></li>
</ul>
<section id="bounding-box-example">
<span id="vvas-xboundingbox"></span><h5>Bounding Box Example<a class="headerlink" href="#bounding-box-example" title="Permalink to this heading">¶</a></h5>
<p>This section describes how to draw a bounding box and label information using the VVAS infrastructure plug-in <code class="docutils literal notranslate"><span class="pre">vvas_xfilter</span></code> and the <code class="docutils literal notranslate"><span class="pre">vvas_xboundingbox</span></code> acceleration software library. The vvas_xboundingbox interprets machine learning inference results from the vvas_xdpuinfer acceleration software library and uses an OpenCV library to draw the bounding box and label on the identified objects.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">vvas_xboundingbox</span></code> implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-accel-sw-libs/vvas_xboundingbox">vvas_xboundingbox source code</a></p>
<figure class="align-default">
<img alt="../../_images/X24998-vvas-xboundingbox.png" src="../../_images/X24998-vvas-xboundingbox.png" />
</figure>
<section id="prerequisites">
<h6>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h6>
<p>There are a few requirements before start running bounding box examples. Make sure these prerequisites are met.</p>
<ul class="simple">
<li><p>Installation of OpenCV: The vvas_xboundingbox uses OpenCV for the graphics back-end library to draw the boxes and labels. Install the libopencv-core-dev package (the preferred version is 3.2.0 or later).</p></li>
</ul>
</section>
<section id="json-file-for-vvas-xboundingbox">
<span id="json-vvas-xboundingbox"></span><h6>JSON File for vvas_xboundingbox<a class="headerlink" href="#json-file-for-vvas-xboundingbox" title="Permalink to this heading">¶</a></h6>
<p>This section describes the JSON file format and configuration parameters for the bounding box acceleration software library. The GStreamer vvas_xfilter plug-in used in the in-place mode. Bounding box and labels are drawn on identified objects on the incoming frame. Bounding box functionality is implemented in the libvvas_xboundingbox.so acceleration software library.</p>
<p>The following example is of a JSON file to pass to the vvas_xfilter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;xclbin-location&quot;</span><span class="p">:</span><span class="s2">&quot;/usr/lib/dpu.xclbin&quot;</span><span class="p">,</span>
   <span class="s2">&quot;vvas-library-repo&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/local/lib/vvas&quot;</span><span class="p">,</span>
   <span class="s2">&quot;element-mode&quot;</span><span class="p">:</span><span class="s2">&quot;inplace&quot;</span><span class="p">,</span>
   <span class="s2">&quot;kernels&quot;</span> <span class="p">:[</span>
      <span class="p">{</span>
         <span class="s2">&quot;library-name&quot;</span><span class="p">:</span><span class="s2">&quot;libvvas_xboundingbox.so&quot;</span><span class="p">,</span>
         <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;font_size&quot;</span> <span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;font&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">&quot;thickness&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;debug_level&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;label_color&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;blue&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">},</span>
            <span class="s2">&quot;label_filter&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;probability&quot;</span> <span class="p">],</span>
            <span class="s2">&quot;classes&quot;</span> <span class="p">:</span> <span class="p">[</span>
               <span class="p">{</span>
                  <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;blue&quot;</span> <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
                  <span class="s2">&quot;green&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="s2">&quot;red&quot;</span> <span class="p">:</span> <span class="mi">0</span>
               <span class="p">},</span>
               <span class="p">{</span>
                  <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;person&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;blue&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="s2">&quot;green&quot;</span> <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
                  <span class="s2">&quot;red&quot;</span> <span class="p">:</span> <span class="mi">0</span>
               <span class="p">},</span>
               <span class="p">{</span>
                  <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;blue&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="s2">&quot;green&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="s2">&quot;red&quot;</span> <span class="p">:</span> <span class="mi">255</span>
               <span class="p">}</span>
            <span class="p">]</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Various configuration parameters of the bounding box acceleration software library are described in the following table.</p>
<p>Table 20: vvas_xboundingbox Parameters</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Expected Values</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>debug_level</p></td>
<td><p>0:
LOG_LEVEL_ERROR</p>
<p>1:
LOG_LEVEL_WARNING</p>
<p>2: LOG_LEVEL_INFO</p>
<p>3:
LOG_LEVEL_DEBUG</p>
</td>
<td><p>Enables the log
levels. There are
four log levels
listed in the
expected values
column.</p></td>
</tr>
<tr class="row-odd"><td><p>font</p></td>
<td><p>0 to 7</p></td>
<td><p>Font for the
label text. 0:
Hershey Simplex</p>
<p>1: Hershey Plain</p>
<p>2: Hershey Duplex</p>
<p>3: Hershey
Complex</p>
<p>4: Hershey
Triplex</p>
<p>5: Hershey
Complex Small 6:
Hershey Script
Simplex 7:
Hershey Script
Complex</p>
</td>
</tr>
<tr class="row-even"><td><p>font_size</p></td>
<td><p>0.5 to 1</p></td>
<td><p>Font fraction
scale factor that
is multiplied by
the font-specific
base size.</p></td>
</tr>
<tr class="row-odd"><td><p>thickness</p></td>
<td><p>Integer 1 to 3</p></td>
<td><p>The thickness of the
line that makes up
the rectangle.
Negative values,
like -1, signify
that the function
draws a filled
rectangle.</p>
<p>The recommended
value is between 1
and 3.</p>
</td>
</tr>
<tr class="row-even"><td><p>label_color</p></td>
<td><p>{ “blue” : 0,
“green” : 0,
“red” : 0 }</p></td>
<td><p>The color of the
label is specified.</p></td>
</tr>
<tr class="row-odd"><td><p>label_filter</p></td>
<td><p>[ “class”,
“probability” ]</p></td>
<td><p>This field indicates
that all information
printed is the label
string. Using
“class” alone adds
the ML
classification name.
For example, car,
person, etc.</p>
<p>The addition of
“probability” in the
array adds the
probability of a
positive object
identification.</p>
</td>
</tr>
<tr class="row-even"><td><p>classes</p></td>
<td><p>{ “name” : “car”,</p>
<p>“blue” : 255,
“green” :</p>
<p>0, “red” : 0 }</p>
</td>
<td><p>This is a filtering
option when using
the
vvas_xboundingbox.
The bounding box is
only drawn for the
classes that are
listed in this
configuration. Other
classes are ignored.
For instance, if
“car”, “person”,
“bicycle” is
entered under
“classes”, then the
bounding box is only
drawn for these
three classes, and
other classes like
horse, motorbike,
etc. are ignored.</p>
<p>The expected value
columns show an
example of how each
class should be
described. All
objects in this
example, by class,
are drawn using the
color combination
listed.</p>
<p>The class names in
this list matches the
class names assigned
by the
vvas_xdpuinfer.
Otherwise, the
bounding box is not
drawn.</p>
<p>For face detect,
keep the “classes”
array empty.</p>
</td>
</tr>
<tr class="row-odd"><td><p>display_level</p></td>
<td><p>Integer 0 to N
0 =&gt; all levels
N =&gt; specific level</p></td>
<td><p>display bounding box
of one particular
level or all levels</p></td>
</tr>
</tbody>
</table>
<p>An example of using a bounding box along with the machine learning plug-in is shown in the <a class="reference internal" href="../Embedded/Tutorials/MultiChannelML.html"><span class="doc">Multi Channel ML</span></a> Tutorial.</p>
</section>
</section>
<section id="machine-learning-example">
<span id="vvas-xdpuinfer"></span><h5>Machine Learning Example<a class="headerlink" href="#machine-learning-example" title="Permalink to this heading">¶</a></h5>
<p>This section discusses how machine learning solutions can be implemented using the VVAS infrastructure <code class="docutils literal notranslate"><span class="pre">vvas_xfilter</span></code> plug-in and the <code class="docutils literal notranslate"><span class="pre">vvas_xdpuinfer</span></code> acceleration software library. Please follow vvas_xinfer to run vvas_xdpuinfer with inference plug-in.</p>
<figure class="align-default">
<img alt="../../_images/image11.png" src="../../_images/image11.png" />
</figure>
<p>The vvas_xdpuinfer is the acceleration software library that controls the DPU through the Vitis AI interface. The vvas_xdpuinfer does not modify the contents of the input buffer. The input buffer is passed to the Vitis AI model library that generates the inference data. This inference data is then mapped into the VVAS meta data structure and attached to the input buffer. The same input buffer is then pushed to the downstream plug-in.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">vvas_xdpuinfer</span></code> implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-accel-sw-libs/vvas_xdpuinfer">vvas_xdpuinfer source code</a></p>
<section id="id41">
<h6>Prerequisites<a class="headerlink" href="#id41" title="Permalink to this heading">¶</a></h6>
<p>There are a few requirements to be met before you can start running the machine learning examples.</p>
</section>
<section id="model-information">
<h6>Model Information<a class="headerlink" href="#model-information" title="Permalink to this heading">¶</a></h6>
<p>The model directory name must match with the ELF and prototxt files inside the model directory. The model directory should contain:</p>
<ul class="simple">
<li><p>model-name.elf/model-name.xmodel and model-name.prototxt file.</p></li>
<li><p>label.json file containing the label information, if the models generate labels.</p></li>
</ul>
<p>The following is an example of the model directory (yolov2_voc), which contains the yolov2_voc.xmodel and yolov2_voc.prototxt files along with the label.json file.</p>
<figure class="align-default">
<img alt="../../_images/model-directory.png" src="../../_images/model-directory.png" />
</figure>
</section>
<section id="xclbin-location">
<h6>xclbin Location<a class="headerlink" href="#xclbin-location" title="Permalink to this heading">¶</a></h6>
<p>By default, the Vitis AI interface expects <code class="docutils literal notranslate"><span class="pre">xclbin</span></code> to be located at <strong>/usr/lib/</strong> and the xclbin is called <strong>dpu.xclbin</strong>. Another option is to use the environment variable <strong>XLNX_VART_FIRMWARE</strong> to specify the path of xclbin using export XLNX_VART_FIRMWARE=/where/your/dpu.xclbin.</p>
</section>
<section id="input-image">
<h6>Input Image<a class="headerlink" href="#input-image" title="Permalink to this heading">¶</a></h6>
<p>The vvas_xdpuinfer works with raw BGR and RGB images as required by the model. Make sure you have specified correct color format in model-format field in json file. The exact resolution of the image to vvas_xdpuinfer must be provided, it is expected by the model. There is a performance loss if a different resolution of the BGR image is provided to the vvas_xdpuinfer because resizing is done on the CPU inside the Vitis AI library.</p>
</section>
<section id="json-file-for-vvas-xdpuinfer">
<span id="json-vvas-dpuinfer"></span><h6>JSON File for vvas_xdpuinfer<a class="headerlink" href="#json-file-for-vvas-xdpuinfer" title="Permalink to this heading">¶</a></h6>
<p>The following table shows the JSON file format and configuration parameters for vvas_xdpuinfer.</p>
<p>Table 21: JSON File for vvas_xdpuinfer</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 4%" />
<col style="width: 2%" />
<col style="width: 9%" />
<col style="width: 3%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Expected Values</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xclbin-location</p></td>
<td><p>string</p></td>
<td><p>This field is not needed for dpuinfer</p></td>
<td><p>NULL</p></td>
<td><p>By default, Vitis AI expects xclbin to be located at /usr/lib/ and xclbin is called “dpu.xclbin”.</p>
<p>The environment variable XLNX_VART_FIRMWARE could also be used to change the path. For example, export XLNX_VART_FIRMWARE=/where/your/dpu.xclbin. Alternatively, you may also provide the xclbin path in <code class="docutils literal notranslate"><span class="pre">/etc/vart.conf</span></code>. In this release, <code class="docutils literal notranslate"><span class="pre">/etc/vart.conf</span></code> has “/media/sd-mmcblk0p1/dpu.xclbin”</p>
</td>
</tr>
<tr class="row-odd"><td><p>vvas-library-repo</p></td>
<td><p>string</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/local/lib/vvas/</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">usr/lib/</span></code></p></td>
<td><p>This is the path where the vvas_xfilter will search the acceleration software library. The kernel name is specified in the library-name parameter of the JSON file.</p></td>
</tr>
<tr class="row-even"><td><p>element-mode</p></td>
<td><p>string</p></td>
<td><p>inplace</p></td>
<td><p>None</p></td>
<td><p>Because the input buffer is not modified by the ML operation, but the metadata generated out of an inference operation needs to be added/appended to the input buffer, the GstBuffer is writable. The vvas_xfilter is configured in inplace mode</p></td>
</tr>
<tr class="row-odd"><td><p>kernels</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>The JSON tag for starting the kernel specific configurations.</p></td>
</tr>
<tr class="row-even"><td><p>kernel-name</p></td>
<td><p>string</p></td>
<td><p>N/A</p></td>
<td><p>NULL</p></td>
<td><p>The name and instance of a kernel separated by “:”</p></td>
</tr>
<tr class="row-odd"><td><p>library-name</p></td>
<td><p>string</p></td>
<td><p>N/A</p></td>
<td><p>NULL</p></td>
<td><p>Acceleration software library name for the kernel. It is appended to the vvas-l ibrary-repo for an absolute path.</p></td>
</tr>
<tr class="row-even"><td><p>config</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>The JSON tag for kernel-specific configurations depending on the acceleration software library.</p></td>
</tr>
<tr class="row-odd"><td><p>model-name</p></td>
<td><p>string</p></td>
<td><p>resnet50</p></td>
<td><p>N/A</p></td>
<td><p>Name string of the machine learning model to be executed. The name string should be same as the name of the directory available in model -path parameter file. If the name of the model ELF file is resnet50.elf, then the model-name is resnet50 in the JSON file. The ELF file present in the specified path model-path of the JSON file.</p></td>
</tr>
<tr class="row-even"><td><p>model-class</p></td>
<td><p>string</p></td>
<td><p>YOLOV3</p>
<p>FACEDETECT</p>
<p>CLASSIFICATION</p>
<p>SSD</p>
<p>REFINEDET</p>
<p>TFSSD</p>
<p>YOLOV2</p>
</td>
<td><p>N/A</p></td>
<td><p>Class of some model corresponding to model. Some examples are shown below:</p>
<ul class="simple">
<li><p><strong>YOLOV3</strong>: yolov3_adas_pruned_0_9, yolov3_voc, yolov3_voc_tf</p></li>
<li><p><strong>FACEDETECT</strong>: densebox_320_320, densebox_640_360</p></li>
<li><p><strong>CLASSIFICATION</strong>: resnet18, resnet50, resnet_v1_50_tf</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>model-format</p></td>
<td><p>string</p></td>
<td><p>RGB/BGR</p></td>
<td><p>N/A</p></td>
<td><p>Image color format required by model.</p></td>
</tr>
<tr class="row-even"><td><p>model-path</p></td>
<td><p>string</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/usr/share/vitis_ai_library/models/</span></code></p></td>
<td><p>N/A</p></td>
<td><p>Path of the folder where the model to be executed is stored.</p></td>
</tr>
<tr class="row-odd"><td><p>need_preprocess</p></td>
<td><p>Boolean</p></td>
<td><p>True/False</p></td>
<td><p>True</p></td>
<td><p>If need_preprocess = true: Normalize with mean/scale through the Vitis AI Library If need_preprocess = false: Normalize with mean/scale is performed before feeding the frame to vvas_xdpuinfer. The Vitis AI library does not perform these operations.</p></td>
</tr>
<tr class="row-even"><td><p>performance_test</p></td>
<td><p>Boolean</p></td>
<td><p>True/False</p></td>
<td><p>False</p></td>
<td><p>Enable performance test and corresponding flops per second (f/s) display logs. Calculates and displays the f/s of the standalone DPU after every second.</p></td>
</tr>
<tr class="row-odd"><td><p>debug_level</p></td>
<td><p>integer</p></td>
<td><p>0 to 3</p></td>
<td><p>1</p></td>
<td><p>Used to enable log levels.</p>
<p>There are four log levels for a message sent by the kernel library code, starting from level 0 and decreasing in severity till level 3 the lowest log-level identifier. When a log level is set, it acts as a filter, where only messages with a log-level lower than it, (therefore messages with an higher severity) are displayed.</p>
<p>0: This is the highest level in order of severity: it is used for messages about critical errors, both hardware and software related.</p>
<p>1: This level is used in situations where you attention is immediately required.</p>
<p>2: This is the log level used for information messages about the action performed by the kernel and output of model.</p>
<p>3: This level is used for debugging.</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="model-parameters">
<h6>Model Parameters<a class="headerlink" href="#model-parameters" title="Permalink to this heading">¶</a></h6>
<p>The Vitis AI library provides a way to read model parameters by reading the configuration file. It facilitates uniform configuration management of model parameters. The configuration file is located in the model-path of the JSON file with [model_name].prototxt. These parameters are model specific. For more information on model parameters, refer to the Vitis AI Library User Guide (<a class="reference external" href="http://www.xilinx.com/cgi-bin/docs/rdoc?t=vitis_ai%3Bv%3Dlatest%3Bd%3Dug1354-xilinx-ai-sdk.pdf">UG1354</a>).</p>
</section>
<section id="example-gstreamer-pipelines">
<h6>Example GStreamer Pipelines<a class="headerlink" href="#example-gstreamer-pipelines" title="Permalink to this heading">¶</a></h6>
<p>This section describes a few example GStreamer pipelines.</p>
</section>
</section>
<section id="classification-example-using-resnet50">
<h5>Classification Example Using Resnet50<a class="headerlink" href="#classification-example-using-resnet50" title="Permalink to this heading">¶</a></h5>
<p>The following pipeline performs ML using a Resnet50 model. DPU configuration uses kernels- config = ./json_files/kernel_resnet50.json for the vvas_xdpuinfer. The output of the vvas_xfilter is passed to fakesink along with the metadata.</p>
<figure class="align-default">
<img alt="../../_images/example-using-resnet50-model.png" src="../../_images/example-using-resnet50-model.png" />
</figure>
<p>The GStreamer command for the example pipeline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=&quot;&lt;PATH&gt;/001.bgr&quot; blocksize=150528 numbuffers=1
! videoparse width=224 height=224 framerate=30/1 format=16
! vvas_xfilter name=&quot;kernel1&quot; kernels-config=&quot;&lt;PATH&gt;/kernel_resnet50.json&quot;
! fakesink
</pre></div>
</div>
<p>The JSON file for the vvas_xdpuinfer to execute <code class="docutils literal notranslate"><span class="pre">resnet50</span></code> model-based classification pipeline is described below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;vvas-library-repo&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/local/lib/vvas/&quot;</span><span class="p">,</span>
   <span class="s2">&quot;element-mode&quot;</span><span class="p">:</span><span class="s2">&quot;inplace&quot;</span><span class="p">,</span>
   <span class="s2">&quot;kernels&quot;</span> <span class="p">:[</span>
      <span class="p">{</span>
         <span class="s2">&quot;library-name&quot;</span><span class="p">:</span><span class="s2">&quot;libvvas_xdpuinfer.so&quot;</span><span class="p">,</span>
         <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model-name&quot;</span> <span class="p">:</span> <span class="s2">&quot;resnet50&quot;</span><span class="p">,</span>
            <span class="s2">&quot;model-class&quot;</span> <span class="p">:</span> <span class="s2">&quot;CLASSIFICATION&quot;</span><span class="p">,</span>
            <span class="s2">&quot;model-format : &quot;</span><span class="n">BGR</span><span class="s2">&quot;</span>
            <span class="s2">&quot;model-path&quot;</span> <span class="p">:</span> <span class="s2">&quot;/usr/share/vitis_ai_library/models/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;run_time_model&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;need_preprocess&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;performance_test&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;debug_level&quot;</span> <span class="p">:</span> <span class="mi">2</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If “need_preprocess” = false, then pre-processing operations like, Normalization, scaling must be
performed on the frame before feeding to vvas_xfilter/vvas_xdpuinfer otherwise results may not be as expected.</p>
</div>
</section>
</section>
</section>
<section id="vvas-xmultisrc">
<span id="id42"></span><h3>vvas_xmultisrc<a class="headerlink" href="#vvas-xmultisrc" title="Permalink to this heading">¶</a></h3>
<p>The GStreamer <code class="docutils literal notranslate"><span class="pre">vvas_xmultisrc</span></code> plug-in can have one input pad and multiple-output pads. This single plug-in supports multiple acceleration kernels, each controlled by a separate acceleration software library.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">vvas_xmultisrc</span></code> implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/sys/multisrc">vvas_xmultisrc source code</a></p>
<figure class="align-default">
<img alt="../../_images/vvas_xmultisrc.png" src="../../_images/vvas_xmultisrc.png" />
</figure>
<section id="id43">
<h4>Input and Output<a class="headerlink" href="#id43" title="Permalink to this heading">¶</a></h4>
<p>Input and output accept buffers with the following color formats on input GstPad and output GstPad.</p>
<ul class="simple">
<li><p>GRAY8</p></li>
<li><p>NV12</p></li>
<li><p>BGR</p></li>
<li><p>RGB</p></li>
<li><p>YUY2</p></li>
<li><p>r210</p></li>
<li><p>v308</p></li>
<li><p>GRAY10_LE32</p></li>
<li><p>ABGR</p></li>
<li><p>ARGB</p></li>
</ul>
<p>The formats listed are the Xilinx IP supported color formats. To add other color formats, update the vvas_kernel.h and vvas_xfilter plug-ins.</p>
</section>
<section id="id44">
<h4>Control Parameters and Plug-in Properties<a class="headerlink" href="#id44" title="Permalink to this heading">¶</a></h4>
<p>Table 22: Plug-in Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>kconfig</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>NULL</p></td>
<td><p>Path of the JSON configuration file based
on the VVAS acceleration software library
requirements. For further information,
refer to <a class="reference internal" href="JSON-File-Schema.html"><span class="doc">JSON File Schema</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>dynamic-config</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>NULL</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="json-format-for-vvas-xmultisrc">
<h4>JSON format for vvas_xmultisrc<a class="headerlink" href="#json-format-for-vvas-xmultisrc" title="Permalink to this heading">¶</a></h4>
<p>This section covers the format of JSON file/string to be passed to the vvas_xmultisrc plug-in.</p>
<section id="example-json-file">
<h5>Example JSON File<a class="headerlink" href="#example-json-file" title="Permalink to this heading">¶</a></h5>
<p>The following example file describes how to specify two kernels that are being controlled by the single instance of the vvas_xmultisrc plug-in. Modify this json file as per your kernels and acceleration software library. The next section describes each field in this example file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;xclbin-location&quot;</span><span class="p">:</span><span class="s2">&quot;/usr/lib/binary_1.xclbin&quot;</span><span class="p">,</span>
   <span class="s2">&quot;vvas-library-repo&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/lib/&quot;</span><span class="p">,</span>
   <span class="s2">&quot;kernels&quot;</span> <span class="p">:[</span>
      <span class="p">{</span>
         <span class="s2">&quot;kernel-name&quot;</span><span class="p">:</span><span class="s2">&quot;resize:resize_1&quot;</span><span class="p">,</span> <span class="o">&lt;------------------</span> <span class="n">kernel</span> <span class="mi">1</span>
         <span class="s2">&quot;library-name&quot;</span><span class="p">:</span><span class="s2">&quot;libvvas_xresize.so&quot;</span><span class="p">,</span>
         <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">x</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="n">y</span> <span class="p">:</span> <span class="mi">7</span>
         <span class="p">}</span>
      <span class="p">}</span>
      <span class="p">{</span>
         <span class="s2">&quot;kernel-name&quot;</span><span class="p">:</span><span class="s2">&quot;cvt_rgb:cvt_rgb_1&quot;</span><span class="p">,</span> <span class="o">&lt;--------------</span> <span class="n">kernel</span> <span class="mi">2</span>
         <span class="s2">&quot;library-name&quot;</span><span class="p">:</span><span class="s2">&quot;libcvt_bgr.so&quot;</span><span class="p">,</span>
         <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;xilinx&quot;</span><span class="p">,</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mf">98.34</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Table 23: JSON Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xclbin-location</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>NULL</p></td>
<td><p>The path of xclbin including the xclbin
name. The plug-in downloads this xclbin
and creates an XRT handle for memory
allocation and programming kernels.</p></td>
</tr>
<tr class="row-odd"><td><p>vvas-library-repo</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>/usr/lib</p></td>
<td><p>The library path for the VVAS repository
for all the acceleration software
libraries.</p></td>
</tr>
<tr class="row-even"><td><p>kernels</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>The JSON tag for starting the kernel
specific configurations.</p></td>
</tr>
<tr class="row-odd"><td><p>kernel-name</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>NULL</p></td>
<td><p>Name and instance of a kernel separated
by “:” as mentioned in xclbin.</p></td>
</tr>
<tr class="row-even"><td><p>library-name</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>NULL</p></td>
<td><p>The acceleration software library name
for the kernel. This is appended to
vvas-library-repo for an absolute path.</p></td>
</tr>
<tr class="row-odd"><td><p>kernel-access-mode</p></td>
<td><p>String</p></td>
<td><p>N/A</p></td>
<td><p>“shared”</p></td>
<td><p>Mode in which IP/Kernel is to be
accessed.
“shared or “exclusive”</p></td>
</tr>
<tr class="row-even"><td><p>config</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>N/A</p></td>
<td><p>The JSON tag for kernel specific
configurations that depends on the
acceleration software library.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="source-pad-naming-syntax">
<h5>Source Pad Naming Syntax<a class="headerlink" href="#source-pad-naming-syntax" title="Permalink to this heading">¶</a></h5>
<p>For single output pad naming is optional. For multiple pads, the source pads names shall be as mentioned below, assuming the name of the plug-in as <cite>sc</cite>.</p>
<p>sc.src_0, sc.src_1 …..sc.src_n</p>
</section>
</section>
<section id="id45">
<h4>Example Pipelines<a class="headerlink" href="#id45" title="Permalink to this heading">¶</a></h4>
<section id="single-output-pad">
<h5>Single Output Pad<a class="headerlink" href="#single-output-pad" title="Permalink to this heading">¶</a></h5>
<p>The following example demonstrates the vvas_xmultisrc plug-in configured for one input and one output. A test video pattern is generated by the videotestrc plug-in and passed to the vvas_xmultisrc plug-in. Depending on the kernel being used, vvas_xmultisrc uses kernel.json to configure the kernel for processing the input frame before passing it to the fakesink.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 videotestsrc
! &quot;video/x-raw, width=1280, height=720, format=BGR&quot;
! vvas_xmultisrc kconfig=&quot;/root/jsons/&lt;kernel.json&gt;&quot;
! &quot;video/x-raw, width=640, height=360, format=BGR&quot;
! fakesink -v
</pre></div>
</div>
<p>The following is an example kernel.json file having <cite>mean_value</cite> and <cite>use_mean</cite> as kernel configuration parameters. Modify this as per your kernel requirements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;xclbin-location&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/lib/dpu.xclbin&quot;</span><span class="p">,</span>
   <span class="s2">&quot;vvas-library-repo&quot;</span><span class="p">:</span> <span class="s2">&quot;/usr/lib/vvas&quot;</span><span class="p">,</span>
   <span class="s2">&quot;kernels&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;kernel-name&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;kernel-name&gt;&quot;</span><span class="p">,</span>
         <span class="s2">&quot;library-name&quot;</span><span class="p">:</span> <span class="s2">&quot;libvvas_xresize_bgr.so&quot;</span><span class="p">,</span>
         <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s2">&quot;use_mean&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s2">&quot;mean_value&quot;</span><span class="p">:</span> <span class="mi">128</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="gstvvasbufferpool">
<h3>GstVvasBufferPool<a class="headerlink" href="#gstvvasbufferpool" title="Permalink to this heading">¶</a></h3>
<p>The GStreamer VVAS buffer pool holds the pool of video frames allocated using the GStreamer allocator object. It is derived from the GStreamer base video buffer pool object (GstVideoBufferPool).</p>
<p>The VVAS buffer pool:</p>
<ul class="simple">
<li><p>Allocates buffers with stride and height alignment requirements. (e.g., the video codec unit (VCU) requires the stride to be aligned with 256 bytes and the height aligned with 64 bytes)</p></li>
<li><p>Provides a callback to the GStreamer plug-in when the buffer comes back to the pool after it is used.</p></li>
</ul>
<p>The following API is used to create the buffer pool.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GstBufferPool</span> <span class="o">*</span><span class="n">gst_vvas_buffer_pool_new</span> <span class="p">(</span><span class="n">guint</span> <span class="n">stride_align</span><span class="p">,</span> <span class="n">guint</span>
<span class="n">elevation_align</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">stride_align</span> <span class="o">-</span> <span class="n">stride</span> <span class="n">alignment</span> <span class="n">required</span>
   <span class="n">elevation_align</span> <span class="o">-</span> <span class="n">height</span> <span class="n">alignment</span> <span class="n">required</span>

<span class="n">Return</span><span class="p">:</span>
   <span class="n">GstBufferPool</span> <span class="nb">object</span> <span class="n">handle</span>
</pre></div>
</div>
<p>Plug-ins can use the following API to set the callback function on the VVAS buffer pool and the callback function is called when the buffer arrives back to the pool after it is used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Buffer</span> <span class="n">release</span> <span class="n">callback</span> <span class="n">function</span> <span class="n">pointer</span> <span class="n">declaration</span><span class="p">:</span>
<span class="n">typedef</span> <span class="n">void</span> <span class="p">(</span><span class="o">*</span><span class="n">ReleaseBufferCallback</span><span class="p">)(</span><span class="n">GstBuffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">);</span>

<span class="n">void</span> <span class="n">gst_vvas_buffer_pool_set_release_buffer_cb</span> <span class="p">(</span><span class="n">GstVvasBufferPool</span> <span class="o">*</span><span class="n">xpool</span><span class="p">,</span>
<span class="n">ReleaseBufferCallback</span> <span class="n">release_buf_cb</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">xpool</span> <span class="o">-</span> <span class="n">VVAS</span> <span class="n">buffer</span> <span class="n">pool</span> <span class="n">created</span> <span class="n">using</span> <span class="n">gst_vvas_buffer_pool_new</span>
   <span class="n">release_buf_cb</span> <span class="o">-</span> <span class="n">function</span> <span class="n">pointer</span> <span class="n">of</span> <span class="n">callback</span>
   <span class="n">user_data</span> <span class="o">-</span> <span class="n">user</span> <span class="n">provided</span> <span class="n">handle</span> <span class="n">to</span> <span class="n">be</span> <span class="n">sent</span> <span class="k">as</span> <span class="n">function</span> <span class="n">argument</span> <span class="k">while</span>
<span class="n">calling</span> <span class="n">release_buf_cb</span><span class="p">()</span>

<span class="n">Return</span><span class="p">:</span>
    <span class="kc">None</span>
</pre></div>
</div>
</section>
<section id="gstvvasallocator">
<h3>GstVvasAllocator<a class="headerlink" href="#gstvvasallocator" title="Permalink to this heading">¶</a></h3>
<p>The GStreamer VVAS allocator object is derived from an open source GstAllocator object designed for allocating memory using XRT APIs. The VVAS allocator is the backbone to the VVAS framework achieving zero-copy (wherever possible).</p>
<section id="allocator-apis">
<h4>Allocator APIs<a class="headerlink" href="#allocator-apis" title="Permalink to this heading">¶</a></h4>
<p>GStreamer plug-in developers can use the following APIs to interact with the VVAS allocator. To allocate memory using XRT, the GStreamer plug-ins and buffer pools require the GstAllocator object provided by the following API.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GstAllocator</span><span class="o">*</span> <span class="n">gst_vvas_allocator_new</span> <span class="p">(</span><span class="n">guint</span> <span class="n">dev_idx</span><span class="p">,</span> <span class="n">gboolean</span> <span class="n">need_dma</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">dev_idx</span> <span class="o">-</span> <span class="n">FPGA</span> <span class="n">Device</span> <span class="n">index</span> <span class="n">on</span> <span class="n">which</span> <span class="n">memory</span> <span class="ow">is</span> <span class="n">going</span> <span class="n">to</span> <span class="n">allocated</span>
   <span class="n">need_dma</span> <span class="o">-</span> <span class="n">will</span> <span class="n">decide</span> <span class="n">memory</span> <span class="n">allocated</span> <span class="ow">is</span> <span class="n">dmabuf</span> <span class="ow">or</span> <span class="ow">not</span>

<span class="n">Return</span><span class="p">:</span>
   <span class="n">GstAllocator</span> <span class="n">handle</span> <span class="n">on</span> <span class="n">success</span> <span class="ow">or</span> <span class="n">NULL</span> <span class="n">on</span> <span class="n">failure</span>
</pre></div>
</div>
<p>..note:: In PCIe platforms, the DMA buffer allocation support is not available. This means that the need_dma argument to gst_vvas_allocator_new() API must be false.</p>
<p>Use the following API to check if a particular GstMemory object is allocated using GstVvasAlloctor.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gboolean</span> <span class="n">gst_is_vvas_memory</span> <span class="p">(</span><span class="n">GstMemory</span> <span class="o">*</span><span class="n">mem</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">mem</span> <span class="o">-</span> <span class="n">memory</span> <span class="n">to</span> <span class="n">be</span> <span class="n">validated</span>

<span class="n">Return</span><span class="p">:</span>
   <span class="n">true</span> <span class="k">if</span> <span class="n">memory</span> <span class="ow">is</span> <span class="n">allocated</span> <span class="n">using</span> <span class="n">VVAS</span> <span class="n">Allocator</span> <span class="ow">or</span> <span class="n">false</span>
</pre></div>
</div>
<p>When GStreamer plug-ins are interacting with hard-kernel/IP or soft-kernel, the plug-ins need physical memory addresses on an FPGA using the following API.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">guint64</span> <span class="n">gst_vvas_allocator_get_paddr</span> <span class="p">(</span><span class="n">GstMemory</span> <span class="o">*</span><span class="n">mem</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">mem</span> <span class="o">-</span> <span class="n">memory</span> <span class="n">to</span> <span class="n">get</span> <span class="n">physical</span> <span class="n">address</span>

<span class="n">Return</span><span class="p">:</span>
   <span class="n">valid</span> <span class="n">physical</span> <span class="n">address</span> <span class="n">on</span> <span class="n">FPGA</span> <span class="n">device</span> <span class="ow">or</span> <span class="mi">0</span> <span class="n">on</span> <span class="n">failure</span>

<span class="n">Use</span> <span class="n">the</span> <span class="n">following</span> <span class="n">API</span> <span class="n">when</span> <span class="n">plug</span><span class="o">-</span><span class="n">ins</span> <span class="n">need</span> <span class="n">an</span> <span class="n">XRT</span> <span class="n">buffer</span> <span class="nb">object</span> <span class="p">(</span><span class="n">BO</span><span class="p">)</span> <span class="n">corresponding</span> <span class="n">to</span> <span class="n">an</span> <span class="n">VVAS</span> <span class="n">memory</span> <span class="nb">object</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">guint</span> <span class="n">gst_vvas_allocator_get_bo</span> <span class="p">(</span><span class="n">GstMemory</span> <span class="o">*</span><span class="n">mem</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">mem</span> <span class="o">-</span> <span class="n">memory</span> <span class="n">to</span> <span class="n">get</span> <span class="n">XRT</span> <span class="n">BO</span>

<span class="n">Return</span><span class="p">:</span>
   <span class="n">valid</span> <span class="n">XRT</span> <span class="n">BO</span> <span class="n">on</span> <span class="n">success</span> <span class="ow">or</span> <span class="mi">0</span> <span class="n">on</span> <span class="n">failure</span>
</pre></div>
</div>
</section>
</section>
<section id="json-schema">
<h3>JSON Schema<a class="headerlink" href="#json-schema" title="Permalink to this heading">¶</a></h3>
<p>This section covers the JSON schema for the configuration files used by the infrastructure plug-ins. For more details, refer to <a class="reference internal" href="JSON-File-Schema.html"><span class="doc">JSON Schema</span></a></p>
</section>
<section id="vvas-inference-meta-data">
<h3>VVAS Inference Meta Data<a class="headerlink" href="#vvas-inference-meta-data" title="Permalink to this heading">¶</a></h3>
<p>This section covers details about inference meta data structure used to store meta data. For more details, refer to <a class="reference internal" href="vvas_meta_data_structures.html#vvas-inference-metadata"><span class="std std-ref">VVAS Inference Metadata</span></a></p>
</section>
<section id="overlay-meta-data">
<h3>Overlay Meta Data<a class="headerlink" href="#overlay-meta-data" title="Permalink to this heading">¶</a></h3>
<p>vvas_xoverlay plug-in understand GstOverlayMetaData structure. Details about this structure can be referred at <a class="reference internal" href="vvas_meta_data_structures.html#vvas-overlay-metadata"><span class="std std-ref">VVAS Overlay Metadata</span></a>.</p>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="vvas_meta_data_structures.html" class="btn btn-neutral float-right" title="VVAS Meta Data Structures" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../release_notes.html" class="btn btn-neutral float-left" title="Vitis Video Analytics SDK Release V2.0" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on June 22, 2022.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
														
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<div class="lang-select dropup hidden-md hidden-lg">
		<button data-toggle="dropdown">
			<span class="fas fa-globe" aria-hidden="true"></span>
			<span>
				
					English
				</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a target="_blank" href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
																	<div class="lang-select dropup hidden-xs hidden-sm">
	<button data-toggle="dropdown">
		<span class="fas fa-globe" aria-hidden="true"></span>
		<span>
			
				English
			</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
															</div>
														</div>
														<div class="col-md-pull-5 col-lg-pull-5 col-md-5 col-lg-5">
															<span class="copyright">©2022 Advanced Micro Devices, Inc</span>
														</div>

													</div>
													                    <div class="movethisrowtoleft row">
                        <div class="col-xs-24">
                            <ul class="sub-menu">
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a></li>
								<li><a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a></li>
                                <li><a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></li>
                            </ul>
                        </div>
                    </div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
<div class="backToTop parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><noindex>
    <span data-component="backToTopButton" class="backToTopButton loaded">
        <ul>
            <li>
                <a href="https://www.author.xilinx.com/xx/rebrand/amd/en-amd-xilinx-header-footer.html#top" class="btn top">
                    <span class="fas fa-angle-up" aria-hidden="true"></span>
                </a>
            </li>
        </ul>
    </span>
</noindex></div>
			</div>
		</div>


		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>