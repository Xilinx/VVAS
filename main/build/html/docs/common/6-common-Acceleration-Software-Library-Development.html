


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

	<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="37701bd4-e5c0-4ee3-9329-e7475d0b13a7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
		<!-- Google Tag Manager -->
	<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
	<!-- End Google Tag Manager -->
	
        <!-- Google Tag Manager -->
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
        <!-- End Google Tag Manager -->	

  
  
  
  

  
      <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../_static/js/Searchbox.min.js"></script>
    <script type="text/javascript" src="../../_static/js/header-footer.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Acceleration Hardware" href="Acceleration-Hardware.html" />
    <link rel="prev" title="Development Guide" href="for_developers.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
 <div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">

    
    

    



<div class="xf-content-height">
    

<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
    
    <div class="header parbase aem-GridColumn aem-GridColumn--default--12"><noindex>
	<header data-component="header" class="site-header">
		<nav class="navbar navbar-default">
			<div class="container-fluid main-nav">
				<div class="row">
					<div class="navbar-column col-xs-4 col-sm-5">
						<ul class="nav navbar-nav hidden-xs">
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
								</li>
							</ul>
							
						<ul class="nav navbar-nav hidden-sm hidden-md hidden-lg">
							<li>
									<button data-target="#header-container-0" data-function="toggle">Solutions</button>
								</li>
							<li>
									<button data-target="#header-container-1" data-function="toggle">Products</button>
								</li>
							<li>
									<button data-target="#header-container-2" data-function="toggle">Company</button>
								</li>
							</ul>
							
						<div id="header-container-0" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-1" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-2" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							</div>
					<div class="logo-column col-xs-4 col-sm-2">
						<div class="logo">
							<a target="_blank" href="https://www.xilinx.com/">
								<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
							</a>
						</div>
					</div>

				</div>
			</div>
			</nav></header></noindex></div>
		
	
</div>

    
</div>
</div>

<div class="calloutBanner parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><div class="callout-banner">
    Xilinx is now a part of <a target="_blank" href="https://www.amd.com/en/corporate/xilinx-acquisition">AMD</a> |  <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Learn More</a>
</div>
</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis™ Video Analytics SDK
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Base Infrastructure</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common_plugins.html">Plugins</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="for_developers.html">For Advanced Developers</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Acceleration s/w Library Developement Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#types-of-kernels">Types of Kernels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hard-kernel">Hard Kernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#softkernel">Softkernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#software-kernel">Software Kernel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#interfaces-for-acceleration-software-libraries">Interfaces for Acceleration Software Libraries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vvas-utils">vvas-utils</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vvas-data-structures">VVAS Data structures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vvaskernel">VVASKernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vvasvideoformat">VVASVideoFormat</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vvasframe">VVASFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-vvas-declarations">Other VVAS Declarations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#core-api">Core API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initialization-api">Initialization API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#process-api">Process API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#de-initialization-api">De-Initialization API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#utility-apis">Utility APIs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#memory-management-api">Memory Management API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#register-access-apis">Register Access APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#execution-apis">Execution APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#acceleration-software-library-for-hard-kernels">Acceleration Software Library for Hard Kernels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#memory-allocation">Memory Allocation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controlling-kernel">Controlling Kernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#acceleration-software-library-for-the-software-kernel">Acceleration Software Library for the Software Kernel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#capability-negotiation-support-in-the-acceleration-software-library">Capability Negotiation Support in the Acceleration Software Library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Acceleration-Hardware.html">Acceleration H/W Kernels</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Embedded</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Embedded/platforms_and_applications.html">Platforms &amp; Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Embedded/6-embedded-plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Embedded/Tutorials/Tutorials.html">Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Center</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../DC/platforms_and_applications.html">Platforms &amp; Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DC/6-DC-plugins.html">Plugins</a></li>
</ul>
<p class="caption"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../freq_asked_questions.html">Frequently Asked Questions</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../_sources/docs/common/6-common-Acceleration-Software-Library-Development.rst.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Vitis™ Video Analytics SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="for_developers.html">Development Guide</a> &raquo;</li>
        
      <li>Acceleration Software Library Development Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/docs/common/6-common-Acceleration-Software-Library-Development.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="acceleration-software-library-development-guide">
<h1>Acceleration Software Library Development Guide<a class="headerlink" href="#acceleration-software-library-development-guide" title="Permalink to this headline">¶</a></h1>
<p>One of the objectives of VVAS is to define a methodology for advanced developers to develop their own kernel and integrate it into GStreamer-based applications. This section defines the steps required to develop an acceleration software library to control the kernel from the GStreamer application. The acceleration software library manages the kernel state machine as well as provide hooks to control the kernel from the GStreamer plug-ins or an application. There are three types of kernels.</p>
<div class="figure align-center">
<img alt="../../_images/image15.png" src="../../_images/image15.png" />
</div>
<div class="section" id="types-of-kernels">
<h2>Types of Kernels<a class="headerlink" href="#types-of-kernels" title="Permalink to this headline">¶</a></h2>
<p>There are three types of kernels as mentioned below.</p>
<div class="section" id="hard-kernel">
<h3>Hard Kernel<a class="headerlink" href="#hard-kernel" title="Permalink to this headline">¶</a></h3>
<p>A hard kernel is made up of HLS and RTL kernels.</p>
</div>
<div class="section" id="softkernel">
<h3>Softkernel<a class="headerlink" href="#softkernel" title="Permalink to this headline">¶</a></h3>
<p>These are special kernels that executes on the application Processor of the device and are controlled over PCIe interface from the Server. These kernels are not for Embedded platforms.</p>
</div>
<div class="section" id="software-kernel">
<h3>Software Kernel<a class="headerlink" href="#software-kernel" title="Permalink to this headline">¶</a></h3>
<p>Software kernels are software processing modules that execute fully on the host CPU. Exposing software kernel through the acceleration software library interface allows them to integrate into the GStreamer framework without an in-depth knowledge of the GStreamer framework.</p>
</div>
</div>
<div class="section" id="interfaces-for-acceleration-software-libraries">
<h2>Interfaces for Acceleration Software Libraries<a class="headerlink" href="#interfaces-for-acceleration-software-libraries" title="Permalink to this headline">¶</a></h2>
<p>To be able to be controlled from an application or GStreamer plug-ins, each acceleration software library must expose three core API functions.</p>
<div class="figure align-default">
<img alt="../../_images/core-API-functions.png" src="../../_images/core-API-functions.png" />
</div>
<p>To interact with the kernel, a set of utility APIs are provided.</p>
<div class="section" id="vvas-utils">
<h3>vvas-utils<a class="headerlink" href="#vvas-utils" title="Permalink to this headline">¶</a></h3>
<p>This section covers details about the utility infrastructure required to develop the kernel libraries for a new kernel and to integrate these acceleration software libraries into the GStreamer framework.</p>
<p>The VVAS acceleration software library APIs are C-based APIs designed for ease of use. A developer does not need knowledge of the GStreamer plug-ins. The acceleration software libraries are developed using the following APIs and can be used by the GStreamer VVAS infrastructure plug-ins to realize plug and play functionality of various processing blocks and filters.</p>
<p>The utility sources are hosted in the vvas-utils repository/folder.</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/image24.png"><img alt="../../_images/image24.png" src="../../_images/image24.png" style="width: 400px;" /></a>
</div>
</div>
</div>
<div class="section" id="vvas-data-structures">
<h2>VVAS Data structures<a class="headerlink" href="#vvas-data-structures" title="Permalink to this headline">¶</a></h2>
<p>The following sections list the core structures and enumerations.</p>
<div class="section" id="vvaskernel">
<h3>VVASKernel<a class="headerlink" href="#vvaskernel" title="Permalink to this headline">¶</a></h3>
<p>The VVASKernel is handle to kernel context and is created and passed to the core APIs by the GStreamer infrastructure plug-ins (for example: the vvas_xfilter).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> \<span class="n">_vvas_kernel</span> <span class="n">VVASKernel</span><span class="p">;</span>

<span class="n">struct</span> \<span class="n">_vvas_kernel</span> <span class="p">{</span>

<span class="n">void</span> \<span class="o">*</span><span class="n">xcl_handle</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">XRT</span> <span class="n">handle</span> <span class="n">provided</span> <span class="n">by</span> <span class="n">GStreamer</span>

<span class="n">infrastructure</span> <span class="n">plug</span><span class="o">-</span><span class="ow">in</span> \<span class="o">*/</span>

<span class="n">uint32_t</span> <span class="n">cu_idx</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">compute</span> <span class="n">unit</span> <span class="n">index</span> <span class="n">of</span> <span class="n">IP</span><span class="o">/</span><span class="n">soft</span><span class="o">-</span> <span class="n">kernel</span> \<span class="o">*/</span>

<span class="n">json_t</span> \<span class="o">*</span><span class="n">kernel_config</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">kernel</span> <span class="n">specific</span> <span class="n">config</span> <span class="kn">from</span> <span class="nn">app</span> \<span class="o">*/</span> <span class="n">void</span>
\<span class="o">*</span><span class="n">kernel_priv</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">to</span> <span class="n">store</span> <span class="n">kernel</span> <span class="n">specific</span>

<span class="n">structures</span> \<span class="o">*/</span>
<span class="n">json_t</span> \<span class="o">*</span><span class="n">kernel_dyn_config</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">Dynamically</span> <span class="n">changed</span> <span class="n">kernel</span> <span class="n">configuration</span> \<span class="o">*/</span>
<span class="n">xrt_buffer</span> \<span class="o">*</span><span class="n">ert_cmd_buf</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">ERT</span> <span class="n">command</span> <span class="n">buffer</span> <span class="n">used</span> <span class="n">to</span> <span class="n">submit</span>

<span class="n">execution</span> <span class="n">commands</span> <span class="n">to</span> <span class="n">XRT</span> \<span class="o">*/</span>

<span class="n">size_t</span> <span class="n">min_offset</span><span class="p">;</span> <span class="n">size_t</span> <span class="n">max_offset</span><span class="p">;</span>

<span class="n">VVASBufAllocCBFunc</span> <span class="n">alloc_func</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">callback</span> <span class="n">function</span> <span class="n">to</span> <span class="n">allocate</span>

<span class="n">memory</span> <span class="kn">from</span> <span class="nn">GstBufferPool</span> <span class="n">by</span> <span class="n">GStreamer</span> <span class="n">infrastructure</span> <span class="n">plug</span><span class="o">-</span><span class="ow">in</span> \<span class="o">*/</span>

<span class="n">VVASBufFreeCBFunc</span> <span class="n">free_func</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">callback</span> <span class="n">function</span> <span class="n">to</span> <span class="n">free</span> <span class="n">memory</span>

<span class="n">allocated</span> <span class="n">by</span> <span class="n">alloc_func</span> \<span class="o">*/</span> <span class="n">void</span> \<span class="o">*</span><span class="n">cb_user_data</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">handle</span> <span class="n">to</span> <span class="n">be</span>
<span class="n">passed</span> <span class="n">along</span> <span class="k">with</span>

<span class="n">alloc_func</span> <span class="o">&amp;</span> <span class="n">free_func</span> <span class="n">callback</span> \<span class="o">*/</span>

<span class="n">vvaspads</span> \<span class="o">*</span><span class="n">padinfo</span><span class="p">;</span> <span class="c1">#ifdef XLNX_PCIe_PLATFORM</span>

<span class="n">uint32_t</span> <span class="n">is_softkernel</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">true</span> <span class="n">when</span> <span class="n">acceleration</span> <span class="n">s</span><span class="o">/</span><span class="n">w</span> <span class="n">library</span> <span class="ow">is</span> <span class="k">for</span>

<span class="c1">#endif</span>

<span class="n">soft</span><span class="o">-</span><span class="n">kernel</span> <span class="ow">in</span> <span class="n">PCIe</span> <span class="n">platforms</span> <span class="n">only</span>

\<span class="o">*/</span>

<span class="n">uint8_t</span> <span class="n">is_multiprocess</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="k">if</span> <span class="n">true</span><span class="p">,</span> <span class="n">ERT</span> <span class="n">command</span> <span class="n">buffer</span> <span class="n">will</span>

<span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">start</span> <span class="n">kernel</span><span class="o">.</span> <span class="k">else</span><span class="p">,</span> <span class="n">direct</span> <span class="n">register</span> <span class="n">programming</span> <span class="n">will</span> <span class="n">be</span>
<span class="n">used</span> \<span class="o">*/</span>

<span class="n">uint8_t</span>  \<span class="o">*</span><span class="n">name</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">TBD</span> \<span class="o">*/</span>

<span class="n">uint16_t</span> <span class="n">in_mem_bank</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">Memory</span> <span class="n">bank</span> <span class="n">to</span> <span class="n">which</span> <span class="nb">input</span> <span class="n">port</span> <span class="n">of</span> <span class="n">kernel</span> <span class="ow">is</span> <span class="n">attached</span> <span class="n">to</span> \<span class="o">*/</span>
<span class="n">uint16_t</span> <span class="n">out_mem_bank</span><span class="p">;</span> <span class="o">/</span>\<span class="o">*</span> <span class="n">Memory</span> <span class="n">bank</span> <span class="n">to</span> <span class="n">which</span> <span class="n">output</span> <span class="n">port</span> <span class="n">of</span> <span class="n">kernel</span> <span class="ow">is</span> <span class="n">attached</span> <span class="n">to</span>

<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="vvasvideoformat">
<h3>VVASVideoFormat<a class="headerlink" href="#vvasvideoformat" title="Permalink to this headline">¶</a></h3>
<p>The VVASVideoFormat represents the video color formats supported by the VVAS framework. The GStreamer infrastructure plug-ins supports the mapping of the following formats and corresponding GStreamer color formats.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">enum</span> <span class="p">{</span>
<span class="n">VVAS_VMFT_UNKNOWN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="n">VVAS_VFMT_RGBX8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_YUVX8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_YUYV8</span><span class="p">,</span> <span class="o">//</span> <span class="n">YUYV</span>
<span class="n">VVAS_VFMT_ABGR8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_RGBX10</span><span class="p">,</span>
<span class="n">VVAS_VFMT_YUVX10</span><span class="p">,</span>
<span class="n">VVAS_VFMT_Y_UV8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_Y_UV8_420</span><span class="p">,</span> <span class="o">//</span> <span class="n">NV12</span>
<span class="n">VVAS_VFMT_RGB8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_YUVA8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_YUV8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_Y_UV10</span><span class="p">,</span>
<span class="n">VVAS_VFMT_Y_UV10_420</span><span class="p">,</span>
<span class="n">VVAS_VFMT_Y8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_Y10</span><span class="p">,</span>
<span class="n">VVAS_VFMT_ARGB8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_BGRX8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_UYVY8</span><span class="p">,</span>
<span class="n">VVAS_VFMT_BGR8</span><span class="p">,</span> <span class="o">//</span> <span class="n">BGR</span>
<span class="n">VVAS_VFMT_RGBX12</span><span class="p">,</span>
<span class="n">VVAS_VFMT_RGB16</span><span class="p">,</span>
<span class="n">VVAS_VFMT_I420</span>
<span class="p">}</span>  <span class="n">VVASVideoFormat</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="vvasframe">
<h3>VVASFrame<a class="headerlink" href="#vvasframe" title="Permalink to this headline">¶</a></h3>
<p>The VVASFrame stores information related to a video frame. The GStreamer infrastructure plug- ins allocate the VVASFrame handle for input and output video frames and sends them to the VVAS kernel processing APIs. Also, the VVASFrame can be allocated by kernel libraries for internal memory requirements (i.e., memory for filter coefficients).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="n">_vvas_frame_props</span> <span class="n">VVASFrameProps</span><span class="p">;</span>
<span class="n">typedef</span> <span class="n">struct</span> <span class="n">_vvas_frame</span> <span class="n">VVASFrame</span><span class="p">;</span>

<span class="o">//</span> <span class="n">frame</span> <span class="n">properties</span> <span class="n">hold</span> <span class="n">information</span> <span class="n">about</span> <span class="n">video</span> <span class="n">frame</span>
<span class="n">struct</span> <span class="n">_vvas_frame_props</span> <span class="p">{</span>
<span class="n">uint32_t</span> <span class="n">width</span><span class="p">;</span>
<span class="n">uint32_t</span> <span class="n">height</span><span class="p">;</span>
<span class="n">uint32_t</span> <span class="n">stride</span><span class="p">;</span>
<span class="n">VVASVideoFormat</span> <span class="n">fmt</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">struct</span> <span class="n">_vvas_frame</span> <span class="p">{</span>
<span class="n">uint32_t</span> <span class="n">bo</span><span class="p">[</span><span class="n">VIDEO_MAX_PLANES</span><span class="p">];</span> <span class="o">//</span> <span class="n">ignore</span><span class="p">:</span> <span class="n">currently</span> <span class="ow">not</span> <span class="n">used</span>
<span class="n">void</span> \<span class="o">*</span><span class="n">vaddr</span><span class="p">[</span><span class="n">VIDEO_MAX_PLANES</span><span class="p">];</span> <span class="o">//</span> <span class="n">virtual</span><span class="o">/</span><span class="n">user</span> <span class="n">space</span> <span class="n">address</span> <span class="n">of</span>
                               <span class="o">//</span><span class="n">video</span> <span class="n">frame</span> <span class="n">memory</span>
<span class="n">uint64_t</span> <span class="n">paddr</span><span class="p">[</span><span class="n">VIDEO_MAX_PLANES</span><span class="p">];</span> <span class="o">//</span> <span class="n">physical</span> <span class="n">address</span> <span class="n">of</span> <span class="n">video</span> <span class="n">frame</span>
<span class="n">uint32_t</span> <span class="n">size</span><span class="p">[</span><span class="n">VIDEO_MAX_PLANES</span><span class="p">];</span>
<span class="n">void</span> \<span class="o">*</span><span class="n">meta_data</span><span class="p">;</span>
<span class="n">VVASFrameProps</span> <span class="n">props</span><span class="p">;</span> <span class="o">/*</span> <span class="n">properties</span> <span class="n">of</span> <span class="n">video</span> <span class="n">frame</span> \<span class="o">*/</span>
<span class="o">/</span>\<span class="o">*</span> <span class="n">application</span><span class="s1">&#39;s private data \*/</span>
<span class="n">void</span> \<span class="o">*</span><span class="n">app_priv</span><span class="p">;</span> <span class="o">/*</span> <span class="n">assigned</span> <span class="n">to</span> <span class="n">GstBuffer</span> <span class="n">by</span> <span class="n">GStreamer</span> <span class="n">infrastructure</span> <span class="n">plugin</span> \<span class="o">*/</span>
<span class="n">VVASMemoryType</span> <span class="n">mem_type</span><span class="p">;</span>
<span class="o">/</span>\<span class="o">*</span><span class="n">number</span> <span class="n">of</span> <span class="n">planes</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">fmt</span> \<span class="o">*/</span>
<span class="n">uint32_t</span> <span class="n">n_planes</span><span class="p">;</span> <span class="o">//</span> <span class="n">number</span> <span class="n">of</span> <span class="n">planes</span> <span class="n">based</span> <span class="n">on</span> <span class="n">color</span> <span class="nb">format</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="other-vvas-declarations">
<h3>Other VVAS Declarations<a class="headerlink" href="#other-vvas-declarations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define MAX_NUM_OBJECT 512 /* max number of video frames/objects</span>
<span class="n">handled</span> <span class="n">by</span> <span class="n">VVAS</span> \<span class="o">*/</span>
<span class="c1">#define MAX_EXEC_WAIT_RETRY_CNT 10 /* retry count on xclExecWait failure \*/</span>
<span class="c1">#define VIDEO_MAX_PLANES 4</span>
<span class="c1">#define DEFAULT_MEM_BANK 0</span>

<span class="n">typedef</span> <span class="n">enum</span> <span class="p">{</span>
<span class="n">VVAS_UNKNOWN_MEMORY</span><span class="p">,</span>
<span class="n">VVAS_FRAME_MEMORY</span><span class="p">,</span> <span class="o">/*</span> <span class="n">use</span> <span class="k">for</span> <span class="nb">input</span> <span class="ow">and</span> <span class="n">output</span> <span class="n">buffers</span> \<span class="o">*/</span>
<span class="n">VVAS_INTERNAL_MEMORY</span><span class="p">,</span> <span class="o">/*</span> <span class="n">use</span> <span class="k">for</span> <span class="n">internal</span> <span class="n">memory</span> <span class="n">of</span> <span class="n">IP</span> \<span class="o">*/</span>
<span class="p">}</span> <span class="n">VVASMemoryType</span><span class="p">;</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="n">buffer</span> <span class="p">{</span>
<span class="n">unsigned</span> <span class="nb">int</span> <span class="n">bo</span><span class="p">;</span> <span class="o">/*</span> <span class="n">XRT</span> <span class="n">Buffer</span> <span class="nb">object</span> \<span class="o">*/</span>
<span class="n">void</span><span class="o">*</span> <span class="n">user_ptr</span><span class="p">;</span> <span class="o">/*</span> <span class="n">userspace</span><span class="o">/</span><span class="n">virtual</span> <span class="n">pointer</span> \<span class="o">*/</span>
<span class="n">uint64_t</span> <span class="n">phy_addr</span><span class="p">;</span> <span class="o">/*</span> <span class="n">physical</span> <span class="n">address</span> \<span class="o">*/</span>
<span class="n">unsigned</span> <span class="nb">int</span> <span class="n">size</span><span class="p">;</span> <span class="o">/*</span> <span class="n">size</span> <span class="n">of</span> <span class="n">XRT</span> <span class="n">memory</span> \<span class="o">*/</span>
<span class="p">}</span> <span class="n">xrt_buffer</span><span class="p">;</span>
</pre></div>
</div>
<p>VVAS acceleration software libraries APIs are broadly categorized into two API types, <a class="reference external" href="#_bookmark17">Core API</a> and <a class="reference external" href="#utility-api">Utility API</a>.</p>
</div>
</div>
<div class="section" id="core-api">
<h2>Core API<a class="headerlink" href="#core-api" title="Permalink to this headline">¶</a></h2>
<p>Core APIs are exposed by the VVAS acceleration software library developer through a shared library. The GStreamer VVAS infrastructure plug-ins (vvas_xfilter and vvas_xmultisrc) call the APIs to perform operations on the kernel. The following is a list of core APIs.</p>
<div class="section" id="initialization-api">
<h3>Initialization API<a class="headerlink" href="#initialization-api" title="Permalink to this headline">¶</a></h3>
<p>The acceleration software library must perform one-time initialization tasks, such as private handles and internal memory allocations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int32_t</span> <span class="n">xlnx_kernel_init</span> <span class="p">(</span><span class="n">VVASKernel</span> <span class="o">*</span> <span class="n">handle</span><span class="p">)</span>
<span class="n">Parameters</span><span class="p">:</span>
    <span class="n">handle</span> <span class="o">-</span> <span class="n">VVAS</span> <span class="n">kernel</span> <span class="n">handle</span> <span class="n">which</span> <span class="n">has</span> <span class="n">kernel</span> <span class="n">context</span>
<span class="n">Return</span><span class="p">:</span>
    <span class="mi">0</span> <span class="n">on</span> <span class="n">success</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span> <span class="n">on</span> <span class="n">failure</span>
</pre></div>
</div>
</div>
<div class="section" id="process-api">
<h3>Process API<a class="headerlink" href="#process-api" title="Permalink to this headline">¶</a></h3>
<p>The acceleration software library must perform per frame operations such as updating IP registers or calling the processing function of the user space library. If a acceleration software library is developed for IP (HardKernel), then this API must call the vvas_kernel_start() utility API to issue a command to process the registers using XRT.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>int32_t xlnx_kernel_start (VVASKernel * handle, int start, VVASFrame *
input[MAX_NUM_OBJECT], VVASFrame * output[MAX_NUM_OBJECT])

Parameters:
    handle - VVAS kernel handle which has kernel context
    start – flag to indicate start of the kernel. Mainly useful in
streaming kernel mode
    input[MAX_NUM_OBJECT] – Array of input frames populated in VVASFrame
handle
    output[MAX_NUM_OBJECT] – Array of output frames populated in VVASFrame
handle
Return:
    0 on success or -1 on failure

Note:
    1. MAX_NUM_OBJECT is 512 and same is assigned in vvas_kernel.h
    2. Input and output of array is NULL terminated to know number of input
&amp; output frames received to start function
</pre></div>
</div>
<p>The acceleration software library can use the following API to wait for completion of the task that was started using the xlnx_kernel_start() API. In the case of a memory-memory IP acceleration software library, this API can leverage the vvas_kernel_done() API to check whether an issued command to XRT is completed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int32_t</span> <span class="n">vvas_kernel_done</span> <span class="p">(</span><span class="n">VVASKernel</span> <span class="o">*</span> <span class="n">handle</span><span class="p">,</span> <span class="n">int32_t</span> <span class="n">timeout</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
    <span class="n">handle</span> <span class="o">-</span> <span class="n">VVAS</span> <span class="n">kernel</span> <span class="n">handle</span> <span class="n">which</span> <span class="n">has</span> <span class="n">kernel</span> <span class="n">context</span>
    <span class="n">timeout</span> <span class="o">-</span> <span class="nb">max</span><span class="o">.</span> <span class="n">time</span> <span class="n">to</span> <span class="n">wait</span> <span class="k">for</span> <span class="s2">&quot;kernel done&quot;</span> <span class="n">notification</span> <span class="kn">from</span> <span class="nn">the</span>
<span class="n">kernel</span><span class="o">.</span>
<span class="n">Return</span><span class="p">:</span>
    <span class="mi">0</span> <span class="n">on</span> <span class="n">success</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span> <span class="n">on</span> <span class="n">failure</span>
</pre></div>
</div>
</div>
<div class="section" id="de-initialization-api">
<h3>De-Initialization API<a class="headerlink" href="#de-initialization-api" title="Permalink to this headline">¶</a></h3>
<p>The acceleration software library must perform de-initialization tasks such as freeing private handles and internal memory allocation as part of the library initialization process.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int32_t</span> <span class="n">xlnx_kernel_deinit</span> <span class="p">(</span><span class="n">VVASKernel</span> <span class="o">*</span> <span class="n">handle</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
    <span class="n">handle</span> <span class="o">-</span> <span class="n">VVAS</span> <span class="n">kernel</span> <span class="n">handle</span> <span class="n">which</span> <span class="n">has</span> <span class="n">kernel</span> <span class="n">context</span>
<span class="n">Return</span><span class="p">:</span>
    <span class="mi">0</span> <span class="n">on</span> <span class="n">success</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span> <span class="n">on</span> <span class="n">failure</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="utility-apis">
<h2>Utility APIs<a class="headerlink" href="#utility-apis" title="Permalink to this headline">¶</a></h2>
<p>For ease of use, the utility APIs are abstracted from the XRT APIs. The following is the list of utility APIs.</p>
<div class="section" id="memory-management-api">
<h3>Memory Management API<a class="headerlink" href="#memory-management-api" title="Permalink to this headline">¶</a></h3>
<p>The following API must be used to allocate XRT memory for video frames as well as for internal memory requirements (i.e., memory for filter coefficients to be sent to IP). If video frames are requested using VVAS_FRAME_MEMORY, then the callback function invoked to the GStreamer VVAS infrastructure plug-ins, like the vvas_xfilter, will allocate frames from GstVideoBufferPool and GstVvasAllocator to avoid memory fragmentation or the memory will be allocated using direct XRT APIs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>VVASFrame* vvas_alloc_buffer (VVASKernel *handle, uint32_t size,
VVASMemoryType mem_type, VVASFrameProps *props)

Parameters:
    handle - VVAS kernel handle which has kernel context
    size - memory size to be allocated
    mem_type - memory can be VVAS_FRAME_MEMORY or VVAS_INTERNAL_MEMORY
    props – required when requesting VVAS_FRAME_MEMORY

Return:
    VVASFrame handle on success or NULL on failure
</pre></div>
</div>
<p>The following API is to free the memory that is allocated using the vvas_alloc_buffer() API.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>void vvas_free_buffer (VVASKernel * handle, VVASFrame *vvas_frame)

Parameters:
    handle - VVAS kernel handle which has kernel context
    vvas_frame – VVASFrame handle allocated using vvas_alloc_buffer() API

Return:
    None
</pre></div>
</div>
</div>
</div>
<div class="section" id="register-access-apis">
<h2>Register Access APIs<a class="headerlink" href="#register-access-apis" title="Permalink to this headline">¶</a></h2>
<p>The register access APIs are used to directly set or get registers of an IP or ERT command buffer that is sent to XRT. The following API is used write into the registers of an IP or to write into the ERT command buffer that is sent to XRT while starting the kernel execution.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>void vvas_register_write (VVASKernel *handle, void *src, size_t size,
size_t offset)
Parameters:
    handle - VVAS kernel handle which has kernel context
    src – pointer to data to be written at offset in ERT command buffer or
register at offset from base address of IP
    size – size of the data pointer src
    offset – offset at which data to be written

Return:
    None
</pre></div>
</div>
<p>The following API used to read from the registers of an IP. This API is not required when is_multiprocess enabled in the VVASKernel handle.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>void vvas_register_read (VVASKernel *handle, void *src, size_t size, size_t
offset)

Parameters:
    handle - VVAS kernel handle which has kernel context
    src – pointer to data which will be updated after read
    size – size of the data pointer src
    offset – offset from base address of an IP

Return:
    None
</pre></div>
</div>
</div>
<div class="section" id="execution-apis">
<h2>Execution APIs<a class="headerlink" href="#execution-apis" title="Permalink to this headline">¶</a></h2>
<p>Execution APIs are used to start kernel execution and wait for the completion of the kernel. These APIs are only used when is_multiprocess is enabled in the VVASKernel handle. Use the following API o start IP/kernel execution.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int32_t</span> <span class="n">vvas_kernel_start</span> <span class="p">(</span><span class="n">VVASKernel</span> <span class="o">*</span><span class="n">handle</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
    <span class="n">handle</span> <span class="o">-</span> <span class="n">VVAS</span> <span class="n">kernel</span> <span class="n">handle</span> <span class="n">which</span> <span class="n">has</span> <span class="n">kernel</span> <span class="n">context</span>

<span class="n">Return</span><span class="p">:</span>
    <span class="mi">0</span> <span class="n">on</span> <span class="n">success</span> <span class="o">-</span><span class="mi">1</span> <span class="n">on</span> <span class="n">failure</span>
</pre></div>
</div>
<p>Use the following API to check whether the IP or kernel has finished execution. This function internally loops for MAX_EXEC_WAIT_RETRY_CNT times until a timeout before returning an error.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int32_t</span> <span class="n">vvas_kernel_start</span> <span class="p">(</span><span class="n">VVASKernel</span> <span class="o">*</span><span class="n">handle</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
    <span class="n">handle</span> <span class="o">-</span> <span class="n">VVAS</span> <span class="n">kernel</span> <span class="n">handle</span> <span class="n">which</span> <span class="n">has</span> <span class="n">kernel</span> <span class="n">context</span>

<span class="n">Return</span><span class="p">:</span>
    <span class="mi">0</span> <span class="n">on</span> <span class="n">success</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span> <span class="n">on</span> <span class="n">failure</span>
<span class="n">int32_t</span> <span class="n">xlnx_kernel_init</span> <span class="p">(</span><span class="n">VVASKernel</span> <span class="o">*</span> <span class="n">handle</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
    <span class="n">handle</span> <span class="o">-</span> <span class="n">VVAS</span> <span class="n">kernel</span> <span class="n">handle</span> <span class="n">which</span> <span class="n">has</span> <span class="n">kernel</span> <span class="n">context</span>

<span class="n">Return</span><span class="p">:</span>
    <span class="mi">0</span> <span class="n">on</span> <span class="n">success</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span> <span class="n">on</span> <span class="n">failure</span>
</pre></div>
</div>
</div>
<div class="section" id="acceleration-software-library-for-hard-kernels">
<h2>Acceleration Software Library for Hard Kernels<a class="headerlink" href="#acceleration-software-library-for-hard-kernels" title="Permalink to this headline">¶</a></h2>
<p>This section covers the steps to develop an acceleration software library for hard kernels.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is assumed that hard kernel work only on physical address. Hence Infrastructure plugins will only provide physical address for the input/output buffers. If for any reason one wants to access the input/output buffers in s/w accel lib, then need to map the buffer and get the virtual address.</p>
</div>
<p>Virtual address is populated by infrastructure plugins only in case of s/w accel lib for “software only” kernels.</p>
<div class="section" id="memory-allocation">
<h3>Memory Allocation<a class="headerlink" href="#memory-allocation" title="Permalink to this headline">¶</a></h3>
<p>A hard kernel works on the physically contiguous memory. Use the vvas_alloc_buffer API to allocate physically contiguous memory on the device (FPGA).</p>
</div>
<div class="section" id="controlling-kernel">
<h3>Controlling Kernel<a class="headerlink" href="#controlling-kernel" title="Permalink to this headline">¶</a></h3>
<p>There are two ways to control a kernel, manual mode and automatic mode.</p>
<div class="section" id="automatic-control-mode">
<h4>Automatic Control Mode<a class="headerlink" href="#automatic-control-mode" title="Permalink to this headline">¶</a></h4>
<p>In this mode, VVAS is relying on the underlying XRT framework to write to the kernel registers to start the kernel. The underlying XRT framework ensures that the kernel is not accessed simultaneously by multiple users at any time. This is the recommended mode of operation for kernels that operate on memory buffers. However, there is one limitation. This mode is not suitable for streaming kernels, where kernels need to be started in auto-restart mode. For starting kernels in auto-restart mode, you must use the manual mode.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To operate an acceleration software library in automatic mode, set the is_multiprocess flag to True in the kernel initialization API (xlnx_kernel_init).</p>
</div>
<ul class="simple">
<li><dl class="simple">
<dt>Programming Registers</dt><dd><p>Use the vvas_register_write APIs to program the kernel register. In this mode, the registers are not immediately written to. The register value is updated in an internal buffer. The actual registers are updated in response to the kernel start request, described in the following section.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Starting Kernel</dt><dd><p>When all the register values are programed, the acceleration software library calls the vvas_kernel_start API. The kernel registers are programed and the kernel is started using the XRT command internally by the vvas_kernel_start API implementation.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Check Kernel Done Status</dt><dd><p>The acceleration software library calls the vvas_kernel_done API. The acceleration software library can specify the time_out value before returning from this API.</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="manual-control-mode">
<h4>Manual Control Mode<a class="headerlink" href="#manual-control-mode" title="Permalink to this headline">¶</a></h4>
<p>The manual control mode is used when you need to start the kernel in auto-restart mode, for example, in streaming kernels. The XRT framework does not support this mode. This is achieved by directly writing into the control registers of the kernel. In this mode, you must ensure that the acceleration software library (GStreamer plug-in or application) does not allow the kernel to be accessed simultaneously by more than one thread or process at any time. It can cause unpredictable results.</p>
<ul class="simple">
<li><dl class="simple">
<dt>Programming Registers</dt><dd><p>In the manual control mode, use the vvas_register_read/vvas_register_write APIs to read from or write to the kernel register. The register is accessed immediately for reading and writing.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Starting Kernel</dt><dd><p>Start the kernel by directly writing the appropriate value in the kernel control register.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Check Kernel Done Status</dt><dd><p>In this mode, the acceleration software library must either continuously poll the kernel status register using vvas_register_read, or to wait on an interrupt to know if the kernel is finished processing.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="acceleration-software-library-for-the-software-kernel">
<h3>Acceleration Software Library for the Software Kernel<a class="headerlink" href="#acceleration-software-library-for-the-software-kernel" title="Permalink to this headline">¶</a></h3>
<p>Software kernels are software modules that run on the application processor. The acceleration software library for these processing modules do not interact with the XRT interface. The interface APIs that abstract the XRT interface are not needed. You must implement the core API in the acceleration software library for use in the GStreamer application through VVAS infrastructure plug-ins.</p>
</div>
</div>
<div class="section" id="capability-negotiation-support-in-the-acceleration-software-library">
<h2>Capability Negotiation Support in the Acceleration Software Library<a class="headerlink" href="#capability-negotiation-support-in-the-acceleration-software-library" title="Permalink to this headline">¶</a></h2>
<p>Kernel capability negotiation is an important functionality that should be accepted between the upstream element and infrastructure plug-ins to achieve an optimal solution. Because the infrastructure plug-ins are generic, the acceleration software library is responsible to populate the required kernel capability during xlnx_kernel_init(), which is negotiated between the infrastructure plug-ins and the upstream element. The infrastructure plug-in suggests a format on its sink pad and arranges the recommendation in priority order as per the kernel capability in the result from the CAPS query that is performed on the sink pad. Only the vvas_xfilter plug-in is currently supporting the kernel specific capability negotiation.</p>
<p>The following section explains the data structures exchange between acceleration software libraries and the infrastructure plug-ins for capability negotiation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="n">caps</span>
<span class="p">{</span>
<span class="n">uint8_t</span> <span class="n">range_height</span><span class="p">;</span> <span class="o">/*</span> <span class="n">true</span><span class="o">/</span><span class="n">false</span> <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="n">specified</span> <span class="ow">in</span> <span class="nb">range</span> <span class="o">*/</span>
<span class="n">uint32_t</span> <span class="n">lower_height</span><span class="p">;</span> <span class="o">/*</span> <span class="n">lower</span> <span class="nb">range</span> <span class="n">of</span> <span class="n">height</span> <span class="n">supported</span><span class="p">,</span>
<span class="n">range_height</span><span class="o">=</span><span class="n">false</span> <span class="n">then</span> <span class="n">this</span> <span class="n">value</span> <span class="n">specified</span> <span class="n">the</span> <span class="n">fixed</span> <span class="n">height</span> <span class="n">supported</span>
<span class="o">*/</span>
<span class="n">uint32_t</span> <span class="n">upper_height</span><span class="p">;</span> <span class="o">/*</span> <span class="n">upper</span> <span class="nb">range</span> <span class="n">of</span> <span class="n">height</span> <span class="n">supported</span> <span class="o">*/</span>
<span class="n">uint8_t</span> <span class="n">range_width</span><span class="p">;</span> <span class="o">/*</span> <span class="n">true</span><span class="o">/</span><span class="n">false</span> <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="n">specified</span> <span class="ow">in</span> <span class="nb">range</span> <span class="o">*/</span>
<span class="n">uint32_t</span> <span class="n">lower_width</span><span class="p">;</span> <span class="o">/*</span> <span class="n">lower</span> <span class="nb">range</span> <span class="n">of</span> <span class="n">width</span> <span class="n">supported</span><span class="p">,</span>
<span class="n">range_width</span><span class="o">=</span><span class="n">false</span> <span class="n">then</span> <span class="n">this</span> <span class="n">value</span> <span class="n">specified</span> <span class="n">the</span> <span class="n">fixed</span> <span class="n">width</span> <span class="n">supported</span> <span class="o">*/</span>
<span class="n">uint32_t</span> <span class="n">upper_width</span><span class="p">;</span> <span class="o">/*</span> <span class="n">upper</span> <span class="nb">range</span> <span class="n">of</span> <span class="n">width</span> <span class="n">supported</span> <span class="o">*/</span>
<span class="n">uint8_t</span> <span class="n">num_fmt</span><span class="p">;</span> <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="nb">format</span> <span class="n">support</span> <span class="n">by</span> <span class="n">kernel</span> <span class="o">*/</span>
<span class="n">VVASVideoFormat</span> <span class="o">*</span><span class="n">fmt</span><span class="p">;</span> <span class="o">/*</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">formats</span> <span class="o">*/</span>
<span class="p">}</span> <span class="n">kernelcaps</span><span class="p">;</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="n">kernelpad</span>
<span class="p">{</span>
<span class="n">uint8_t</span> <span class="n">nu_caps</span><span class="p">;</span> <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">different</span> <span class="n">caps</span> <span class="n">supported</span> <span class="o">*/</span>
<span class="n">kernelcaps</span> <span class="o">**</span><span class="n">kcaps</span><span class="p">;</span> <span class="o">/*</span> <span class="n">lsit</span> <span class="n">of</span> <span class="n">caps</span> <span class="o">*/</span>
<span class="p">}</span> <span class="n">kernelpads</span><span class="p">;</span>
</pre></div>
</div>
<p>Below mentioned user friendly APIs are provided for kernel to set the above mentioned capabilities.</p>
<p>API to create new caps with input parameters</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vvas_caps_new</span><span class="p">()</span> <span class="o">-</span> <span class="n">Create</span> <span class="n">new</span> <span class="n">caps</span> <span class="k">with</span> <span class="nb">input</span> <span class="n">parameters</span>
<span class="n">range_height</span>
     <span class="o">-</span> <span class="n">true</span>  <span class="p">:</span> <span class="k">if</span> <span class="n">kernel</span> <span class="n">support</span> <span class="nb">range</span> <span class="n">of</span> <span class="n">height</span>
     <span class="o">-</span> <span class="n">false</span> <span class="p">:</span> <span class="k">if</span> <span class="n">kernel</span> <span class="n">support</span> <span class="n">fixed</span> <span class="n">height</span>
<span class="n">lower_height</span> <span class="p">:</span> <span class="n">lower</span> <span class="n">value</span> <span class="n">of</span> <span class="n">height</span> <span class="n">supported</span> <span class="n">by</span> <span class="n">kernel</span>
               <span class="k">if</span> <span class="n">range_height</span> <span class="ow">is</span> <span class="n">false</span><span class="p">,</span> <span class="n">this</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">fixed</span> <span class="n">value</span>
<span class="n">upper_height</span> <span class="p">:</span> <span class="n">higher</span> <span class="n">value</span> <span class="n">of</span> <span class="n">hight</span> <span class="n">supported</span> <span class="n">by</span> <span class="n">kernel</span>
               <span class="k">if</span> <span class="n">range_height</span> <span class="ow">is</span> <span class="n">false</span><span class="p">,</span> <span class="n">this</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">0</span>
<span class="n">range_width</span> <span class="p">:</span> <span class="n">same</span> <span class="k">as</span> <span class="n">above</span>
<span class="n">lower_width</span> <span class="p">:</span>
<span class="n">upper_width</span> <span class="p">:</span>

            <span class="p">:</span> <span class="n">variable</span> <span class="nb">range</span> <span class="n">of</span> <span class="nb">format</span> <span class="n">supported</span> <span class="n">terminated</span> <span class="n">by</span> <span class="mi">0</span>
              <span class="n">make</span> <span class="n">sure</span> <span class="n">to</span> <span class="n">add</span> <span class="mi">0</span> <span class="n">at</span> <span class="n">end</span> <span class="n">otherwise</span> <span class="n">it</span>
              <span class="n">code</span> <span class="n">will</span> <span class="n">take</span> <span class="nb">format</span> <span class="n">till</span> <span class="n">it</span> <span class="n">get</span> <span class="mi">0</span>

<span class="n">kernelcaps</span> <span class="o">*</span> <span class="n">vvas_caps_new</span> <span class="p">(</span><span class="n">uint8_t</span> <span class="n">range_height</span><span class="p">,</span>
                            <span class="n">uint32_t</span> <span class="n">lower_height</span><span class="p">,</span>
                            <span class="n">uint32_t</span> <span class="n">upper_height</span><span class="p">,</span>
                            <span class="n">uint8_t</span> <span class="n">range_width</span><span class="p">,</span>
                            <span class="n">uint32_t</span> <span class="n">lower_width</span><span class="p">,</span>
                            <span class="n">uint32_t</span> <span class="n">upper_width</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>API to  add new caps to sink pad. Only one pad is supported in this release.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bool</span> <span class="n">vvas_caps_add_to_sink</span> <span class="p">(</span><span class="n">VVASKernel</span> <span class="o">*</span> <span class="n">handle</span><span class="p">,</span> <span class="n">kernelcaps</span> <span class="o">*</span> <span class="n">kcaps</span><span class="p">,</span> <span class="nb">int</span> <span class="n">sinkpad_num</span><span class="p">)</span>
</pre></div>
</div>
<p>API to add new caps to src pad. Only one pad is supported as on today.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bool</span> <span class="n">vvas_caps_add_to_src</span> <span class="p">(</span><span class="n">VVASKernel</span> <span class="o">*</span> <span class="n">handle</span><span class="p">,</span> <span class="n">kernelcaps</span> <span class="o">*</span> <span class="n">kcaps</span><span class="p">,</span> <span class="nb">int</span> <span class="n">sinkpad_num</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Acceleration-Hardware.html" class="btn btn-neutral float-right" title="Acceleration Hardware" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="for_developers.html" class="btn btn-neutral float-left" title="Development Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on February 16, 2022.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
														
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<div class="lang-select dropup hidden-md hidden-lg">
		<button data-toggle="dropdown">
			<span class="fas fa-globe" aria-hidden="true"></span>
			<span>
				
					English
				</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a target="_blank" href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
																	<div class="lang-select dropup hidden-xs hidden-sm">
	<button data-toggle="dropdown">
		<span class="fas fa-globe" aria-hidden="true"></span>
		<span>
			
				English
			</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
															</div>
														</div>
														<div class="col-md-pull-5 col-lg-pull-5 col-md-5 col-lg-5">
															<span class="copyright">©2022 Advanced Micro Devices, Inc</span>
														</div>

													</div>
													                    <div class="movethisrowtoleft row">
                        <div class="col-xs-24">
                            <ul class="sub-menu">
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a></li>
								<li><a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a></li>
                                <li><a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></li>
                            </ul>
                        </div>
                    </div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
<div class="backToTop parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><noindex>
    <span data-component="backToTopButton" class="backToTopButton loaded">
        <ul>
            <li>
                <a href="https://www.author.xilinx.com/xx/rebrand/amd/en-amd-xilinx-header-footer.html#top" class="btn top">
                    <span class="fas fa-angle-up" aria-hidden="true"></span>
                </a>
            </li>
        </ul>
    </span>
</noindex></div>
			</div>
		</div>


		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>